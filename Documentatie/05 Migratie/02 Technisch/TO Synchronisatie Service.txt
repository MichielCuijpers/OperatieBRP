Technisch ontwerp BRP Synchronisatie Service

2.13

Datum
Status

30-06-2017
Definitief

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Inhoudsopgave

INHOUDSOPGAVE..........................................................................................................................................2
VERSIEHISTORIE ...........................................................................................................................................6
REVIEWHISTORIE .........................................................................................................................................7
1

INLEIDING ................................................................................................................................................8
1.1
1.2
1.3

2

BEKNOPTE OMSCHRIJVING............................................................................................................8
REFERENTIES .....................................................................................................................................8
LEESWIJZER .......................................................................................................................................8

CONTEXT ................................................................................................................................................10
2.1 ONTWERPBESLISSINGEN ..............................................................................................................10
2.1.1
Communicatie...............................................................................................................................10
2.1.2
Modus ...........................................................................................................................................11
2.1.3
Maven Structuur ...........................................................................................................................11
2.1.4
Services ........................................................................................................................................12
2.1.5
Blokkering ....................................................................................................................................13
2.1.6
Technische fouten .........................................................................................................................13

3

ARCHITECTUURBESCHRIJVING .....................................................................................................14
3.1 COMPONENTEN ...............................................................................................................................14
3.1.1
Runtime ........................................................................................................................................14
3.1.2
DAL ..............................................................................................................................................14
3.2 TOTAALOVERZICHT ......................................................................................................................15
3.2.1
Verzoeken tot schrijven van gegevens ..........................................................................................16
3.2.2
Verzoeken tot lezen van gegevens.................................................................................................16
3.3 DETAILOVERZICHT ........................................................................................................................16
3.3.1
Verzoeken tot schrijven van gegevens ..........................................................................................16
3.3.2
Verzoek tot lezen van gegevens ....................................................................................................18
3.3.3
Variaties per service .....................................................................................................................18

4

DATA TOEGANGSLAAG (DAL) SERVICES .....................................................................................19
4.1
4.2

5

MAPPERS ...........................................................................................................................................19
DELTA ................................................................................................................................................19

SERVICES (INITIÃ‹LE VULLING MODUS) .......................................................................................20
5.1 CONVERTEER EN PERSISTEER PERSOONSLIJST .....................................................................20
5.1.1
Service ..........................................................................................................................................20
5.1.2
Preconditie ...................................................................................................................................20
5.1.3
Postconditie ..................................................................................................................................20
5.1.4
Structuur .......................................................................................................................................20
5.1.5
Implementatie ...............................................................................................................................20
5.1.6
Ontwerpbeslissingen ....................................................................................................................21
5.2 OPHALEN EN CONVERTEREN PERSOONSLIJST .......................................................................22
5.2.1
Service ..........................................................................................................................................22
5.2.2
Preconditie ...................................................................................................................................22
5.2.3
Postconditie ..................................................................................................................................22
5.2.4
Implementatie ...............................................................................................................................22
5.2.5
Ontwerpbeslissingen ....................................................................................................................22
5.3 CONVERTEER EN PERSISTEER AFNEMERSINDICATIES ........................................................23
5.3.1
Service ..........................................................................................................................................23
5.3.2
Preconditie ...................................................................................................................................23
5.3.3
Postconditie ..................................................................................................................................23
5.3.4
Implementatie ...............................................................................................................................23

Operatie BRP

Pagina 2 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

5.3.5
Ontwerpbeslissingen ....................................................................................................................23
5.4 CONVERTEER EN PERSISTEER AUTORISATIES .......................................................................24
5.4.1
Service ..........................................................................................................................................24
5.4.2
Preconditie ...................................................................................................................................24
5.4.3
Postconditie ..................................................................................................................................24
5.4.4
Implementatie ...............................................................................................................................24
5.4.5
Ontwerpbeslissingen ....................................................................................................................25
5.5 CONVERTEER EN PERSISTEER PROTOCOLLERING DATA ....................................................26
5.5.1
Service ..........................................................................................................................................26
5.5.2
Preconditie ...................................................................................................................................26
5.5.3
Postconditie ..................................................................................................................................26
5.5.4
Implementatie ...............................................................................................................................26
5.5.5
Ontwerpbeslissingen ....................................................................................................................26
6

SERVICES (SYNCHRONISATIE MODUS).........................................................................................27
6.1 CONVERTEER EN PERSISTEER PERSOONSLIJST .....................................................................27
6.1.1
Proces ...........................................................................................................................................27
6.1.2
Preconditie ...................................................................................................................................27
6.1.3
Postconditie ..................................................................................................................................27
6.1.4
Structuur .......................................................................................................................................27
6.1.5
Implementatie ...............................................................................................................................27
6.1.6
Ontwerpbeslissingen ....................................................................................................................29
6.2 OPHALEN EN CONVERTEREN PERSOONSLIJST .......................................................................30
6.2.1
Service ..........................................................................................................................................30
6.2.2
Preconditie ...................................................................................................................................30
6.2.3
Postconditie ..................................................................................................................................30
6.2.4
Implementatie ...............................................................................................................................30
6.2.5
Ontwerpbeslissingen ....................................................................................................................30
6.3 ZOEK PERSOON (OP ACTUELE OF HISTORISCHE GEGEVENS) .............................................31
6.3.1
Proces ...........................................................................................................................................31
6.3.2
Preconditie ...................................................................................................................................31
6.3.3
Postconditie ..................................................................................................................................31
6.3.4
Structuur .......................................................................................................................................31
6.3.5
Implementatie ...............................................................................................................................31
6.3.6
Ontwerpbeslissingen ....................................................................................................................32
6.4 AD HOC ZOEK PERSOONSVRAAG (NETWERK) ........................................................................33
6.4.1
Proces ...........................................................................................................................................33
6.4.2
Preconditie ...................................................................................................................................33
6.4.3
Postconditie ..................................................................................................................................33
6.4.4
Structuur .......................................................................................................................................33
6.4.5
Implementatie ...............................................................................................................................33
6.4.6
Ontwerpbeslissingen ....................................................................................................................34
6.5 AD HOC ZOEK PERSOONSVRAAG ANTWOORD (NETWERK)................................................35
6.5.1
Proces ...........................................................................................................................................35
6.5.2
Preconditie ...................................................................................................................................35
6.5.3
Postconditie ..................................................................................................................................35
6.5.4
Structuur .......................................................................................................................................35
6.5.5
Implementatie ...............................................................................................................................35
6.5.6
Ontwerpbeslissingen ....................................................................................................................35
6.6 AD HOC ZOEK PERSOON OP ADRESVRAAG (NETWERK) ......................................................36
6.6.1
Proces ...........................................................................................................................................36
6.6.2
Preconditie ...................................................................................................................................36
6.6.3
Postconditie ..................................................................................................................................36
6.6.4
Structuur .......................................................................................................................................36
6.6.5
Implementatie ...............................................................................................................................36
6.6.6
Ontwerpbeslissingen ....................................................................................................................37
6.7 AD HOC ZOEK PERSOON OP ADRESVRAAG ANTWOORD (NETWERK) ..............................38
6.7.1
Proces ...........................................................................................................................................38

Operatie BRP

Pagina 3 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.7.2
Preconditie ...................................................................................................................................38
6.7.3
Postconditie ..................................................................................................................................38
6.7.4
Structuur .......................................................................................................................................38
6.7.5
Implementatie ...............................................................................................................................38
6.7.6
Ontwerpbeslissingen ....................................................................................................................38
6.8 PERSISTEER BLOKKERING ...........................................................................................................39
6.8.1
Service ..........................................................................................................................................39
6.8.2
Preconditie ...................................................................................................................................39
6.8.3
Postconditie ..................................................................................................................................39
6.8.4
Structuur .......................................................................................................................................39
6.8.5
Implementatie ...............................................................................................................................39
6.8.6
Ontwerpbeslissingen ....................................................................................................................39
6.9 PERSISTEER DEBLOKKERING ......................................................................................................40
6.9.1
Service ..........................................................................................................................................40
6.9.2
Preconditie ...................................................................................................................................40
6.9.3
Postconditie ..................................................................................................................................40
6.9.4
Structuur .......................................................................................................................................40
6.9.5
Implementatie ...............................................................................................................................40
6.9.6
Ontwerpbeslissingen ....................................................................................................................40
6.10
OPHALEN BLOKKERINGSINFORMATIE .................................................................................41
6.10.1
Service ......................................................................................................................................41
6.10.2
Preconditie................................................................................................................................41
6.10.3
Postconditie ..............................................................................................................................41
6.10.4
Structuur ...................................................................................................................................41
6.10.5
Implementatie ...........................................................................................................................41
6.10.6
Ontwerpbeslissingen .................................................................................................................41
6.11
PLAATSEN AFNEMERSINDICATIE ...........................................................................................42
6.11.1
Proces .......................................................................................................................................42
6.11.2
Preconditie................................................................................................................................42
6.11.3
Postconditie ..............................................................................................................................42
6.11.4
Structuur ...................................................................................................................................42
6.11.5
Implementatie ...........................................................................................................................42
6.11.6
Ontwerpbeslissingen .................................................................................................................42
6.12
VERWIJDEREN AFNEMERSINDICATIE ...................................................................................43
6.12.1
Proces .......................................................................................................................................43
6.12.2
Preconditie................................................................................................................................43
6.12.3
Postconditie ..............................................................................................................................43
6.12.4
Structuur ...................................................................................................................................43
6.12.5
Implementatie ...........................................................................................................................43
6.12.6
Ontwerpbeslissingen .................................................................................................................43
6.13
VERWERK AFNEMERSINDICATIE ANTWOORD ...................................................................44
6.13.1
Proces .......................................................................................................................................44
6.13.2
Preconditie................................................................................................................................44
6.13.3
Postconditie ..............................................................................................................................44
6.13.4
Structuur ...................................................................................................................................44
6.13.5
Implementatie ...........................................................................................................................44
6.13.6
Ontwerpbeslissingen .................................................................................................................44
6.14
VERWERK TOEVALLIGE GEBEURTENIS................................................................................45
6.14.1
Proces .......................................................................................................................................45
6.14.2
Preconditie................................................................................................................................45
6.14.3
Postconditie ..............................................................................................................................45
6.14.4
Structuur ...................................................................................................................................45
6.14.5
Implementatie ...........................................................................................................................45
6.14.6
Ontwerpbeslissingen .................................................................................................................46
6.15
VERWERK TOEVALLIGE GEBEURTENIS ANTWOORD .......................................................47
6.15.1
Proces .......................................................................................................................................47
6.15.2
Preconditie................................................................................................................................47
6.15.3
Postconditie ..............................................................................................................................47
Operatie BRP

Pagina 4 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.15.4
Structuur ...................................................................................................................................47
6.15.5
Implementatie ...........................................................................................................................47
6.15.6
Ontwerpbeslissingen .................................................................................................................48
6.16
VERWERK LEVERING .................................................................................................................49
6.16.1
Proces .......................................................................................................................................49
6.16.2
Preconditie................................................................................................................................49
6.16.3
Postconditie ..............................................................................................................................49
6.16.4
Structuur ...................................................................................................................................49
6.16.5
Implementatie ...........................................................................................................................49
6.16.6
Ontwerpbeslissingen .................................................................................................................49
6.17
VERWERK VRIJBERICHT VAN GBA NAAR BRP ....................................................................50
6.17.1
Proces .......................................................................................................................................50
6.17.2
Preconditie................................................................................................................................50
6.17.3
Postconditie ..............................................................................................................................50
6.17.4
Structuur ...................................................................................................................................50
6.17.5
Implementatie ...........................................................................................................................50
6.17.6
Ontwerpbeslissingen .................................................................................................................51
6.18
VERWERK NOTIFICATIES VAN BRP NAAR GBA ..................................................................52
6.18.1
Proces .......................................................................................................................................52
6.18.2
Preconditie................................................................................................................................52
6.18.3
Postconditie ..............................................................................................................................52
6.18.4
Structuur ...................................................................................................................................52
6.18.5
Implementatie ...........................................................................................................................52
6.18.6
Ontwerpbeslissingen .................................................................................................................52
7

REGISTER SERVICES (SYNCHRONISATIE MODUS) ...................................................................53
7.1 OPHALEN GEMEENTEREGISTER .................................................................................................53
7.1.1
Proces ...........................................................................................................................................53
7.1.2
Preconditie ...................................................................................................................................53
7.1.3
Postconditie ..................................................................................................................................53
7.1.4
Structuur .......................................................................................................................................53
7.1.5
Implementatie ...............................................................................................................................53
7.1.6
Ontwerpbeslissingen ....................................................................................................................54

8

ARCHIEF SERVICES (SYNCHRONISATIE MODUS) .....................................................................55
8.1 VERWERK ARCHIEF VERZOEK ....................................................................................................55
8.1.1
Service ..........................................................................................................................................55
8.1.2
Preconditie ...................................................................................................................................55
8.1.3
Postconditie ..................................................................................................................................55
8.1.4
Structuur .......................................................................................................................................55
8.1.5
Implementatie ...............................................................................................................................55
8.1.6
Ontwerpbeslissingen ....................................................................................................................56

9

BIJLAGE A: BESLISSINGEN PERSISTEREN PERSOONSLIJST .................................................57

10

BIJLAGE B: JMX INTERFACE ........................................................................................................58

10.1
10.2
11

SYNCHRONISATIE .......................................................................................................................58
CACHING .......................................................................................................................................59
BIJLAGE C: CONFIGURATIE .........................................................................................................60

Operatie BRP

Pagina 5 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Versiehistorie
Datum

Versie

Omschrijving

Auteur

18-03-2014
19-03-2014
11-04-2014

0.1
0.2
0.2

Operatie BRP
Operatie BRP
Operatie BRP

15-04-2014
28-04-2014
13-05-2014
10-06-2014

1.0
1.1
1.2
1.3

16-06-2014
21-07-2014

1.4
1.5

30-07-2014
26-08-2014

1.6
1.7

04-09-2014
26-09-2014
18-03-2015
22-07-2015
28-07-2015
28-09-2015
03-12-2015
14-12-2015

1.8
1.9
1.10
1.11
2.0
2.1
2.2
2.3

22-12-2015
22-01-2016

2.4
2.5

07-04-2016

2.6

10-05-2016

2.7

16-09-2016

2.8

InitiÃ«le versie
Tekstuele aanpassingen & toevoegingen
Omgevormd naar technisch ontwerp
template
Opmerkingen review verwerkt
Opmerkingen review verwerkt
Architectuurbeschrijving toegevoegd
Kruimelpad toegevoegd en aanpassingen
versienummers referenties
Aanpassen module- en packagenamen
Toevoegen services ten behoeve van
onderhoud afnemersindicaties
Toevoegen service ten behoeve van zoeken
Nieuwe paden toegevoegd aan bijlage en
pad blokkeringinformatie toegevoegd
Definitief gemaakt voor release 2.2
Verwerken nieuwe logica vanuit UC220
Aanpassingen t.b.v. release 3.1
Bijgewerkt n.a.v. TO Delta en release 3.1
Versie aangemaakt voor release 3.1
Referenties bijgewerkt
Archief service toegevoegd
Toevallige gebeurtenis verwerking
toegevoegd
Leveringen verwerking toegevoegd
Nalopen tbv release; bijwerken kleine
fouten; toevoegen JMX bijlage; toevoegen
configuratie bijlage
Bijwerken nav refactor UC309 (Verwerk
Toevallige Gebeurtenis Verzoek)
Bijwerken naar aanleiding van refactor
beslisboom
Bijwerken naar aanleiding van toevoegen
UC104

27-09-2016

2.9

GbaBijhoudingen queueÅ› verwijderd

Operatie BRP

15-03-2017

2.10

Nalopen voor release; bijwerken nav
documentatie richtlijnen

Operatie BRP

29-03-2017

2.11

Verwerken review I&T

Operatie BRP

24-05-2017

2.12

Operatie BRP

30-06-2017

2.13

Beschrijving ad hoc zoek persoon en ad hoc
zoek persoon op adres opgenomen n.a.v.
uc1004
Bijwerken archivering

Operatie BRP

Operatie
Operatie
Operatie
Operatie

BRP
BRP
BRP
BRP

Operatie BRP
Operatie BRP
Operatie BRP
Operatie BRP
Operatie
Operatie
Operatie
Operatie
Operatie
Operatie
Operatie
Operatie

BRP
BRP
BRP
BRP
BRP
BRP
BRP
BRP

Operatie BRP
Operatie BRP

Operatie BRP
Operatie BRP
Operatie BRP

Operatie BRP

Pagina 6 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Reviewhistorie
Datum

Versie

Omschrijving

Reviewers

19-03-2014

0.1

Review initiÃ«le versie

Operatie BRP

15-04-2014

0.2

Inhoudelijke review

Operatie BRP

24-04-2014

1.0

Inhoudelijke review cross-team

Operatie BRP

13-05-2014

1.2

Inhoudelijke review architectuurbeschrijving

Operatie BRP

14-12-2015

2.3

Review

Operatie BRP

29-03-2017

2.10

Review

Operatie BRP

Operatie BRP

Pagina 7 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

1

1.1

Inleiding

Beknopte omschrijving
Dit technisch ontwerp beschrijft de BRP synchronisatie service.

1.2

Referenties
#
[LO]

Document
Logisch Ontwerp GBA

Organisatie
RvIG

[UC101]

MV UC101 Vul persoonsgegevens in BRP
initieel
MV UC102 Vul autorisatietabelregels in
BRP initieel

OperatieBRP

MV UC103 Vul afnemersindicaties in BRP
initieel
MV UC104 Vul protocollering in BRP
initieel

OperatieBRP

MV UC202 Verwerken synchronisatiecyclus
MV UC309 Verwerk toevallige gebeurtenis
in GBA
MV UC220 Bepalen verwerking
persoonslijst
MV UC1003 Verwerken handmatig
plaatsen en verwijderen afnemersindicatie
MV UC1004 Verwerken zoekvraag
Software Architecture Document
Migratiesoftware BRP
TO Deltabepaling
TO Routering

OperatieBRP

[UC102]
[UC103]
[UC104]
[UC202]
[UC309]
[UC220]
[UC1003]
[UC1004]
[SAD]

Versie
3.9

Datum
31-012015

OperatieBRP

OperatieBRP

OperatieBRP
OperatieBRP
OperatieBRP
OperatieBRP
OperatieBRP

[DELTA]
OperatieBRP
[ROUTERING
OperatieBRP
]
Nota: versienummers van â€˜interneâ€™ documenten worden niet opgenomen. Deze dienen consistent
te zijn.
1.3

Leeswijzer
De opzet is dusdanig dat eerst de context, overkoepelende en algemene zaken worden
besproken (hoofdstuk 2). Dan wordt er een beschrijving gegeven van de algemene opzet
(hoofdstuk 3). Vervolgens wordt er stilgestaan bij alle implementaties van de services die in
SYNC voorkomen (hoofdstuk 4 en hoofdstuk 5). Voor het bespreken van de services is gekozen
om de opzet per service hetzelfde te houden. Dit houdt in dat er per service gesproken wordt
over:

âž¢
âž¢
âž¢
âž¢
âž¢

De service; een beschrijving van wat de service inhoudt.
Preconditie; indien van toepassing de geldende preconditie.
Postconditie; indien van toepassing de geldende postconditie.
De structuur; een beschrijving van het package/de packages waar de implementatie staat.
De implementatie; een beschrijving van belangrijke implementatie specifieke zaken en
klassen.
âž¢ Ontwerpbeslissingen; een beschrijving van de ontwerpbeslissingen die ten grondslag
liggen van de gekozen implementatie.
Operatie BRP

Pagina 8 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Eventueel nog uit te zoeken punten of onduidelijkheden zullen worden besproken in het laatste
hoofdstuk (hoofdstuk 6).

Operatie BRP

Pagina 9 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

2

Context

Vanwege de technische architectuur is gekozen om slechts 1 component uit de migratie
componenten direct toegang te laten hebben tot BRP. Hierdoor komen sommige scheidslijnen
tijdens de realisatie anders te liggen dan bij het ontwerp (use cases) wordt gesuggereerd. In
[SAD] is aangegeven in welke omgeving de BRP synchronisatie service opereert.
In de hier onderstaande afbeelding is ter illustratie de omgeving weergegeven, in de paragraaf
â€˜4.1.6 View-deel 4: BRP Synchronisatie Serviceâ€™ van het [SAD] kan meer detailinformatie
hieromtrent worden gevonden.

Dit document richt zich alleen op de zaken binnen de BRP synchronisatie service.

2.1

Ontwerpbeslissingen

2.1.1

Communicatie
De BRP synchronisatie service maakt gebruik van JMS-queues om berichten te versturen of te
ontvangen.
Queue
sync.verzoek
sync.antwoord
archivering
levering
gemeente.verzoek
autorisatie.verzoek

Operatie BRP

Doel
Het ontvangen van berichten van de BRP Synchronisatie Service
Het verzenden van berichten aan de BRP Synchronisatie Service
Het ontvangen van archief verzoeken
Het versturen van leveringen
Het ontvangen van gemeente register verzoeken
Het ontvangen van autorisatie register verzoeken

Pagina 10 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Hiernaast maakt de BRP Synchronisatie service gebruik van twee topics om berichten te
versturen.
Topic
gemeente.register
autorisatie.register

Doel
Het versturen van het gemeente register
Het versturen van het autorisatie register

De BRP synchronisatie service maakt ook gebruik van JMS-queues van de BRP message broker
om berichten te versturen en te ontvangen
Queue
ArchiveringQueue
GbaAdhocAdresvraagVerzoek
GbaAdhocAdresvraagAntwoord
GbaAdhocPersoonsvraagVerzoek
GbaAdhocPersoonsvraagAntwoord
GbaAfnemerindicaties
GbaAfnemerindicatiesAntwoorden

GbaLeveringen
GbaToevalligeGebeurtenissen

GbaToevalligeGebeurtenissenAntwoorden

2.1.2

Doel
Het versturen van archivering verzoeken
Het versturen van ad hoc adres vragen
Het ontvangen van antwoorden voor ad hoc
adres vragen
Het versturen van ad hoc persoonsvragen
Het ontvangen van antwoorden voor ad hoc
persoonsvragen
Het versturen van opdrachten voor het plaatsen
of verwijderen van afnemersindicaties
Het ontvangen van directe antwoorden over het
plaatsen of verwijderen van afnemersindicaties
(indirect wordt een levering verstuurd na het
plaatsen van een afnemersindicatie)
Het ontvangen van leveringen
Het versturen van toevallige gebeurtenissen
waarbij het feit heeft plaatsgevonden in een
GBA gemeente
Het ontvangen van antwoorden over een
toevallige gebeurtenis

Modus
De BRP synchronisatie service kan geconfigureerd worden om in verschillende modi te worden
uitgevoerd. Binnen de realisatie worden twee modi onderkend:
âž¢
âž¢

InitiÃ«le vulling modus
Synchronisatie modus

De modus bepaalt welke berichten kunnen worden verwerkt, welke controles van toepassing zijn
en welke onderliggende services worden uitgevoerd. Services kunnen naast elkaar en concurrent
draaien, al is het niet wenselijk om initiÃ«le vulling en synchronisatie modus tegelijkertijd als
proces te starten. De reden hiervoor is dat de initiÃ«le vulling eenmalig wordt gedraaid en de BRP
database vult met persoonslijsten vanuit GBA-V, terwijl de synchronisatie gebruikt wordt om
wijzigingen in de persoonslijsten vanuit LO3/GBA-V naar BRP te synchroniseren.

2.1.3

Maven Structuur
Het onderstaande overzicht toont de Maven structuur en geeft aan wat er voor de verschillende
modi wordt gebruikt.
Project
migr-synchronisatie

Operatie BRP

Subproject

Beschrijving

migr-synchronisatie-dal

Zie paragraaf 4.1.6.2.1 Data Access
Layer (DAL) [SAD].

Pagina 11 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

migr-synchronisatie-runtime

2.1.4

Dit wordt door â€˜Synchronisatieâ€™ slechts
beperkt gebruikt om te zoeken op een
persoonslijst. een persoonslijst op te
slaan en/of op te halen. Voor de â€˜initiÃ«le
vullingâ€˜ wordt deze component volledig
gebruikt.
Zie paragraaf 4.1.6.2.1 Data Access
Layer (DAL) [SAD].
Dit wordt door â€˜InitiÃ«le vullingâ€™ slechts
beperkt gebruikt als service ingang.
Voor de â€˜synchronisatieâ€˜ wordt deze
component volledig gebruikt.

Services
Het ontvangen en verwerken van berichten is geÃ¯mplementeerd met Spring JMS Listeners. Per
ontvangen bericht wordt bepaald welke service uitgevoerd wordt. De volgende services zijn
beschikbaar:
InitiÃ«le vulling modus:
Service
Lees en converteer persoonslijst
Converteer en persisteer persoonslijst
Converteer en persisteer autorisaties
Converteer en persisteer afnemersindicaties
Converteer en persisteer protocollering data

Gebruik
UC101
UC101
UC102
UC103
UC104

Synchronisatie modus:
Service
Gebruik
Lees en converteer persoonslijst
UC301, UC311
Converteer en persisteer persoonslijst
UC202, UC811
Zoek persoon op actuele gegevens
UC301, UC1003
Zoek persoon op historische gegevens
UC1003
Persisteer blokkering
UC301
Persisteer deblokkering
UC202, UC811
Ophalen blokkeringsinformatie
UC202, UC301, UC811
Verwerk plaatsen afnemersindicatie
UC1003
Verwerk verwijderen afnemersindicatie
UC1003
Verwerk toevallige gebeurtenis
UC309
Verwerk ad hoc persoonsvraag
UC1004
Verwerk ad hoc adresvraag
UC1004
Let op: het persisteren van een persoonslijst heeft verschillende invullingen (bedrijfsregels) voor
de synchronisatie en initiÃ«le vulling modus.
Service (register)
Lees gemeenteregister
Lees autorisatieregister
Het lezen en versturen van registers is afgesplitst zodat dit
afnemende systeem hier niet â€˜langâ€™ op hoeft te wachten.

Gebruik
UC2xx, UC3xx, UC8xx
UC1003
direct verwerkt kan worden en het

Service (archivering)
Gebruik
Verwerk archief verzoek
Vanuit VOISC voor alle berichten
Het verwerken van archief verzoeken is afgesplitst zodat dit los van â€˜functioneleâ€™ verzoeken
verwerkt kan worden.
Operatie BRP

Pagina 12 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Service
Verwerk
Verwerk
Verwerk
Verwerk

2.1.5

(BRP notificatie)
afnemersindicatie antwoord
toevallige gebeurtenis antwoord
ad hoc persoonsvraag antwoord
ad hoc adresvraag antwoord

Gebruik
UC1003
UC309
UC1004
UC1004

Blokkering
Omdat bij het verhuizen van een persoonslijst nog niet meteen de juiste bijhoudingsgemeente
op de persoonslijst staat, wordt een persoonslijst tot dat moment geblokkeerd. Dit is bedoeld om
tussentijdse wijzigingen aan de persoonslijst, voordat deze is geactualiseerd, te voorkomen.
Het blokkeren van een persoonslijst betekent dat er in de BRP database in de tabel
â€˜mig_blokkeringâ€™ een rij wordt opgenomen met daarin het a-nummer van de persoonslijst.
Tevens worden de oorspronkelijke gemeente, nieuwe gemeente en een indicatie of er wordt
verhuisd van BRP naar LO3 of BRP naar RNI opgenomen. Verhuizing van LO3 naar BRP is geen
geldige optie.
Indien een persoonslijst is geblokkeerd, dan zal het synchronisatieproces ([UC202]) de
persoonslijst niet bijwerken indien de gemeente niet overeenkomt met de registratiegemeente.

2.1.6

Technische fouten
Indien er technische fouten optreden in een service, dan wordt het bericht niet verwerkt en
wordt de standaard afhandeling gebruikt zoals die door de Routering (zie TO Routering
[ROUTERING]) wordt ondersteund. De verwerking van een bericht wordt opnieuw geprobeerd en
na een aantal keer gefaald te zijn zal het berichten op een Dead Letter Queue (DLQ) worden
geplaatst. Deze DLQ berichten kunnen handmatig opnieuw worden aangeboden door
functionaliteit in de Routering.

Operatie BRP

Pagina 13 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

3

3.1

Architectuurbeschrijving

Componenten
Zoals af te leiden uit de module view, aangehaald in het voorgaande hoofdstuk, bestaat deze
module uit een Runtime en een database-verwerkingslaag (Data Access Layer, DAL) en maakt
het gebruik van de Conversie-module. Omdat dit schema uitsluitend de technische
afhankelijkheden tussen modules toont, en deze om praktische redenen nogal afwijken van de
logische opzet, volgt de eigenlijke logische opzet hieronder.

Dankzij dit overzicht wordt duidelijker dat de Runtime een meer overkoepelende rol heeft, te
weten het ontsluiten als service van zowel de Conversie-module als van de DAL; terwijl de DAL
net zoals de Conversie-module vooraleerst een afgebakend stuk functionaliteit implementeert,
namelijk die van persistentie-laag richting de BRP-database. De ISC-module is in dit overzicht
opgenomen omdat het de primaire aanroeper is van de Runtime, en heeft als zodanig sterke
invloed gehad op het ontwerp van laatstgenoemde. De InitiÃ«le Vulling (IV) module (hier niet
opgenomen) maakt tijdens de initiÃ«le vulling gebruik van de Synchronisatie Service.
3.1.1

Runtime
De Runtime ondersteunt de interstelselcommunicatie (ISC), waarbij de communicatie met de
buitenwereld plaatsvindt door middel van Lo3-berichten, maar de opslag dient plaats te vinden in
de centrale BRP-database. Zowel de vertaling tussen de Lo3 en BRP gegevensmodellen als het
opslaan en uitlezen van de laatste wordt door ISC direct gedelegeerd naar de Synchronisatie
Service. Om deze twee taken te kunnen combineren leunt de Runtime zowel op de Conversiemodule als op de DAL.
De services die de Runtime aanbiedt worden ontsloten via een queue (HornetQ tijdens de initiÃ«le
vulling; anders wordt gebruik gemaakt van de Routering, welke is geÃ¯mplementeerd met
ActiveMQ). Berichten op deze queue worden ontvangen door de SynchronisatieMessageHandler,
welke vervolgens bepaalt welke implementatie van SynchronisatieBerichtService een bepaald
bericht kan verwerken en deze aanroept. Deze SynchronisatieBerichtServices verwerken
vervolgens het specifieke bericht met behulp van de Conversie-module en de DAL.

3.1.2

DAL
Het eerder genoemde BRP-datamodel bestaat binnen conversie feitelijk uit twee verschillende
datamodellen, te weten het Conversiemodel en het Entity-model.
Het Conversiemodel wordt gebruikt in alle conversie-software, en ook de DAL communiceert
door middel van dit model met omliggende componenten.

Operatie BRP

Pagina 14 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Het Conversiemodel is echter nog enkele stappen verwijderd van de eigenlijke BRPdatabasestructuur. Om deze database te kunnen aanspreken vanuit Java (middels JPA /
Hibernate) is het Entity-model in het leven geroepen. Binnen de DAL vindt dus opnieuw een
vertaalslag plaats; ditmaal tussen het Conversiemodel en het Entity-model.
Als representant van de BRP-database onderscheidt het Entity-model enerzijds de volledige
historie van een gegeven, en anderzijds de hieruit af te leiden actualiteit. Het Conversiemodel
wordt middels Mappers steeds zo direct mogelijk vertaald naar de historie-tabellen; daarnaast
worden de gegevens voor de actuele tabellen hier uit het Conversiemodel afgeleid. Dit gebeurt
slechts ten bate van het functioneren van de BRP; bij het terugvertalen van opgeslagen
gegevens naar het Conversiemodel worden genoemde gegevens direct gelezen uit de historietabellen, zonder raadpleging van de afgeleide actuele tabellen.
Het Entity-model wordt beheerd als onderdeel van de DAL.
Naast initieel vullen ondersteunt de DAL ook het opslaan van een delta. In deze gevallen moet
worden vastgesteld welke wijzigingen er op de persoonslijst hebben plaatsgevonden tussen de
opgeslagen en de aangeboden versies. Het bepalen van de delta en verwerking hiervan is
dermate complex dat hiervoor een apart technisch ontwerp deltabepaling [DELTA] is geschreven.

3.2

Totaaloverzicht
Voorgaande omschrijving van de Synchronisatie Service geeft reeds aan dat er verschillende
lagen zijn, waarin verschillende modellen worden gebruikt. Onderstaand blokdiagram geeft een
overzicht van de algemene opzet.

(N.B.: in de code wordt het Conversiemodel doorgaans aangeduid als 'BRP formaat'; dezelfde
nomenclatuur wordt gehandhaafd in de diagrammen in dit document. In de tekst wordt wel
steeds de volledige naam 'Conversiemodel' gebruikt, om het onderscheid met het Entity-model
te benadrukken.)
Er zijn verschillende implementaties van SynchronisatieBerichtService voor iedere aanroep die de
Runtime ondersteunt. Deze implementaties zijn op te delen in twee hoofdcategorieÃ«n, te weten:
verzoeken tot schrijven van gegevens, en verzoeken tot lezen van gegevens. Deze categorieÃ«n
doorlopen beiden een eigen pad door bovenstaand diagram.

Operatie BRP

Pagina 15 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

3.2.1

Verzoeken tot schrijven van gegevens
Nadat een VerzoekBericht is binnengekomen bij een van de concrete services (bijvoorbeeld:
SynchroniseerNaarBrpService), wordt de inhoud vertaald van een Lo3-gegeven naar een
Conversiemodel-gegeven door middel van de ConverteerLo3NaarBrpService. Het
Conversiemodel-gegeven wordt vervolgens ter opslag aangeboden aan de BrpDalService, welke
via een voor dit proces specifieke Mapper het Conversiemodel omzet naar het Entity-model. Het
Entity-gegeven wordt vervolgens ter opslag aangeboden aan de voor dit gegeven specifieke
Repository. De verwerking wordt uiteindelijk afgerond door het versturen van een
AntwoordBericht.

3.2.2

Verzoeken tot lezen van gegevens
Het verzoek dat binnenkomt bij een van de concrete services (bijvoorbeeld: LeesUitBrpService)
leidt nu eerst tot een uitvraag van gegevens bij de BrpDalService. Deze verkrijgt een Entitymodel uit een repository en laat deze vertalen door een specifieke mapper voor de 'terugweg'
(BRP naar Lo3). Het aldus verkregen Conversiemodel-gegeven wordt nu vertaald naar Lo3 door
de ConverteerBrpNaarLo3Service â€“ de omgekeerde service van op de 'heenweg'. Het
resulterende Lo3-gegeven wordt nu aangeboden in het AntwoordBericht.

3.3

Detailoverzicht
In deze paragraaf wordt in meer detail ingegaan op de zojuist geschetste overzicht. De
aanroepen zijn uitgewerkt in sequence diagrammen. Hoewel de uitwerking generiek blijft, zijn
enkele van de toegevoegde details specifiek relevant voor het verwerken van persoonslijsten,
zoals dit bijvoorbeeld gebeurt in de services SynchroniseerNaarBrpService en LeesUitBrpService.

3.3.1

Verzoeken tot schrijven van gegevens
Onderstaand deeloverzicht toont de stappen na ontvangst van een VerzoekBericht, maar nog
voor de aanroep van de BrpDalService.

Voor die implementaties van SynchronisatieBerichtService die een andere modus operandi
hebben tijdens Synchronisatie dan tijdens InitiÃ«le Vulling, wordt het verzoek vrijwel direct
gedelegeerd naar een voor die situatie specifieke SynchronisatieVerwerker. De overige
implementaties van SynchronisatieBerichtService maken geen gebruik van deze extra abstractie
en roepen dus zelf de verder naar rechts afgebeelde componenten aan. In alle gevallen zijn de
aanroepen volgens de hier beschreven hoofdlijnen gelijk.
Operatie BRP

Pagina 16 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Het ontvangen bericht wordt gevalideerd d.m.v. syntax- en preconditie-controles op de Lo3inhoud, en deze inhoud wordt vervolgens geconverteerd naar het Conversiemodel door de
ConverteerLo3NaarBrpService. Het BRP-model wordt hierna aangeboden aan een voor dit bericht
specifieke PlVerwerker.

Via een aantal dunne abstracties bereikt het verzoek zo uiteindelijk de BrpDalService.

De BrpDalService roept vervolgens een voor het te verwerken gegeven specifieke Mapper aan
om te vertalen van Conversiemodel naar Entity-model; De naamgeving van deze mappers is
*Mapper. Het betreft in dit voorbeeld een persoonslijst; de aangeroepen PersoonMapper roept op
zijn beurt voor iedere groep in de PL weer specifieke groep-mappers aan (deze implementeren
de interface MapperStrategie). Bij deze groep-mappers ligt tevens de verantwoordelijkheid om
onderzoeksgegevens te mappen op het Entity-model; dit gebeurt middels de OnderzoekMapper.
Na aldus te zijn omgezet naar het Entity-model, wordt het gegeven, indien het een persoonslijst
betreft, mogelijk ook nog verwerkt door de Deltabepaler.

Operatie BRP

Pagina 17 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Uiteindelijk wordt de Entity ter opslag aangeboden aan het voor dit gegeven specifieke
Repository, alvorens de verwerking wordt afgerond door het sturen van een AntwoordBericht (zie
eerste diagram).

3.3.2

Verzoek tot lezen van gegevens
Het uitlezen van gegevens is niet alleen volgordelijk andersom, het bevat ook een aantal stappen
minder. Zo hoeft er bij een verkregen PL bijvoorbeeld geen controle op syntax of precondities
plaats te vinden.

Het verwerken van een VerzoekBericht begint nu met het uitvragen van de voor het gewenste
gegeven relevante Repository. Het verkregen Entity-gegeven wordt vervolgens naar het
Conversiemodel gemapt via een voor dit gegeven specifieke Mapper; de naamgeving van deze
mappers is Brp*Mapper. Het betreft in dit voorbeeld een de BrpPersoonslijstMapper, welke zelf
een aantal andere detail-Mappers aan roept.
Het Conversiemodel-gegeven wordt vervolgens vertaald naar een Lo3-gegeven en meegestuurd
in het AntwoordBericht.

3.3.3

Variaties per service
Het hierboven beschreven generieke proces moet worden gezien als leidraad aan de hand
waarvan de verschillende services zijn opgezet. Omdat deze opzet niet hard wordt afgedwongen,
en bovendien de aangeboden services uiteenlopen in functionaliteit, mag de lezer enige variatie
verwachten bij het nalopen van een specifieke service.

Operatie BRP

Pagina 18 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

4

Data toegangslaag (DAL) services

Een aantal services is gedefinieerd in de data toegangslaag omdat deze services direct met de
entiteit objecten samenwerken die voor persistentie (met JPA en Hibernate) worden gebruikt.
Dit betreft met name deze twee services:
â€¢
â€¢
4.1

De mappers van het interne conversie datamodel naar de entiteiten, en terug
De delta-service om verschillen tussen twee versies van een persoonslijst te verwerken.

Mappers
De mappers zorgen ervoor dat een persoonslijst uit het BRP conversie model wordt afgebeeld op
een nieuwe set entiteit objecten, en dat uit een set entiteit objecten weer een persoonslijst in het
BRP conversie model gemaakt kan worden.
Met een nieuwe set entiteit objecten wordt bedoeld dat deze entiteit objecten worden
aangemaakt alsof de BRP database leeg is (op stamgegevens na). Er wordt dus nog geen
rekening gehouden met het al aanwezig zijn in de database van of een vorige versie van deze
persoonslijst, of gerelateerde persoonslijsten (ouders, partners, kinderen). Dit wordt ook wel een
â€˜kluizenaarâ€™ genoemd.
Door het gebruiken van mappers worden het logische conversie model en het fysieke database
model gescheiden gehouden, en kunnen variaties/optimalisaties in beiden worden opgevangen
zonder dat het andere model direct geraakt wordt.

4.2

Delta
Wanneer de synchronisatie service een bericht verwerkt is de wijze van verwerken afhankelijk
van de situatie in de database voor de betreffende persoon. Wanneer nog geen
persoonsgegevens in de BRP database bestaand voor het ontvangen synchronisatie bericht dan
wordt geen deltabepaling uitgevoerd maar wordt het resultaat van conversie en mappen direct in
de database opgeslagen. Bestaat er echter al een persoon in de BRP database voor dit
synchronisatiebericht dan wordt eerst de delta bepaalt en vervolgens wordt alleen de delta in de
BRP database toegepast. Zie hiervoor het technisch ontwerp deltabepaling [DELTA].

Operatie BRP

Pagina 19 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

5

Services (initiÃ«le vulling modus)

Dit hoofdstuk beschrijft de services die beschikbaar zijn wanneer de BRP Synchronisatie Service
in â€˜initiÃ«le vullingâ€™-modus wordt uitgevoerd.

5.1

Converteer en persisteer persoonslijst

5.1.1

Service
Converteer een LO3 persoonslijst naar een BRP persoonslijst en persisteer deze in de BRP
database in initiÃ«le vulling modus (zie MV UC101 Vul persoonsgegevens in BRP initieel [UC101]).

5.1.2

Preconditie

â€¢
5.1.3

Postconditie

â€¢
â€¢

5.1.4

Er is een LO3 persoonslijst die in BRP gepersisteerd dient te worden.

De LO3 persoonslijst is geconverteerd en gepersisteerd in BRP, of
er is een (inhoudelijke) fout opgetreden en de LO3 persoonslijst is niet gepersisteerd in
BRP.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.service

Omschrijving
Package waarin de service implementaties
staan.

nl.bzk.migratiebrp.synchronisatie.
runtime.service.synchronisatie

Package waarin specifieke implementaties voor
het synchroniseren van persoonslijsten staan.

5.1.5

Implementatie

5.1.5.1

Converteer en persisteer persoonslijst
Class

SynchroniseerNaarBrpService
InitieleVullingSynchronisatieVerwerkerImpl
Verzoek (SynchroniseerNaarBrpVerzoekType)
Element
Omschrijving
lo3BerichtAsTeletexString
Lo3 persoonslijst
opnemenAlsNieuwePl
<niet gebruikt in
aNummerTeVervangenPl
<niet gebruikt in
gezaghebbendBericht
<niet gebruikt in
anummerWijziging
<niet gebruikt in

initiÃ«le
initiÃ«le
initiÃ«le
initiÃ«le

vulling
vulling
vulling
vulling

modus>
modus>
modus>
modus>

Antwoord (SynchroniseerNaarBrpAntwoordType)
Element
Omschrijving
status
Mogelijke waarden: Toegevoegd, Afgekeurd, Fout
persoonslijsten
<niet gebruikt in initiÃ«le vulling modus>
- lo3Pl
<niet gebruikt in initiÃ«le vulling modus>
melding
Melding
logging
Logging van precondities, schoning en bijzondere situaties
Operatie BRP

Pagina 20 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

-

lo3Categorie
lo3Stapel
lo3Voorkomen
severity
code
lo3Element

Categorie
Stapelnummer
Volgnummer
Logging niveau
Logging code
Element

Voordat de persoonslijst gepersisteerd kan worden moet de persoonslijst gecontroleerd,
gevalideerd en geconverteerd worden. Indien de controle faalt (Beslissing B1, B2 of B3) zal een
antwoord worden gegeven met de status â€˜Foutâ€™. Indien de validatie faalt (Beslissing D1) zal een
antwoord worden gegeven met de status â€˜Afgekeurdâ€™. Indien de conversie faalt (Beslissing D2)
zal een antwoord worden gegeven met de status â€˜Foutâ€™.
Indien geconstateerd wordt dat de gegeven persoonslijst (voor validatie) geen synchroniciteits
gegevens bevat (Beslissing C1) worden deze toegevoegd aan de persoonslijst.
De volgende controles worden uitgevoerd:
âž¢

Er wordt geen persoonslijst in de BRP database gevonden met een actueel a-nummer dat
overeenkomt met het actuele a-nummer van de aangeboden persoonslijst.

Indien de controles slagen (Beslissing E2) wordt de persoonslijst als nieuwe persoonslijst
opgeslagen in de BRP database en wordt een antwoord met de status â€˜Toegevoegdâ€™ gegeven.
Anders (Beslissing E1) wordt een antwoord met de status â€˜Foutâ€™ gegeven.

5.1.6

Ontwerpbeslissingen
Binnen elke stap en controle wordt er een regel aan de melding toegevoegd. Het totaal aan
regels komt zodoende volledig terug in het antwoordbericht binnen â€˜meldingâ€™ en vormt een
kruimelpad (zie bijlage A) waarmee getraceerd kan worden welke stappen en/of controles zijn
uitgevoerd.
Elke persoonslijst wordt gevalideerd tegen baseline 1 pre-condities. Indien niet aan een van de
condities wordt voldaan, wordt er per overtreden baseline 1 pre-conditie een logregel aan
â€˜loggingâ€™ toegevoegd. Hiermee wordt door â€˜loggingâ€™ in het antwoordbericht duidelijk aan welke
pre-condities niet is voldaan.

Operatie BRP

Pagina 21 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

5.2

Ophalen en converteren persoonslijst

5.2.1

Service
Haal een BRP persoonslijst op uit de BRP database en converteer deze naar een LO3
persoonslijst (zie MV UC101 Vul persoonsgegevens in BRP initieel [UC101]).

5.2.2

Preconditie

â€¢
5.2.3

Er is in de BRP database een gepersisteerde BRP persoonslijst.

Postconditie

â€¢

Een naar LO3 geconverteerde persoonslijst welke in het antwoordbericht staat.

5.2.4

Implementatie

5.2.4.1

Ophalen en converteren persoonslijst
Class

LeesUitBrpService
Verzoek (LeesUitBrpVerzoekType)
Element
aNummer
technischeSleutel
antwoordFormaat
Antwoord (LeesUitBrpAntwoordType)
Element
Status
lo3Pl
lo3PlXml
brpPl

Omschrijving
A-nummer
Technische sleutel
Mogelijke waarden: Lo3, Lo3XML, Brp

Omschrijving
Mogelijke waarden: Ok
Persoonslijst in LO3 teletex formaat
Persoonslijst in LO3 XML (migratie specifiek)
formaat
Persoonslijst in BRP XML (migratie specifiek)
formaat

De gevraagde persoonslijst (op basis van a-nummer of technische sleutel) wordt opgevraagd uit
de BRP database en geconverteerd naar het gevraagde formaat.
5.2.5

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 22 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

5.3

Converteer en persisteer afnemersindicaties

5.3.1

Service
Converteer een LO3 afnemersindicatie naar een BRP afnemersindicatie en persisteer deze in de
BRP database in initiÃ«le vulling modus (zie MV UC103 Vul afnemersindicaties in BRP initieel
[UC103]).

5.3.2

Preconditie

â€¢
5.3.3

Er is een LO3 afnemersindicatie die in BRP gepersisteerd dient te worden.

Postconditie

â€¢
â€¢

De LO3 afnemersindicatie is geconverteerd en gepersisteerd in BRP, of
er is een (inhoudelijke) fout opgetreden en de LO3 afnemersindicatie is niet gepersisteerd
in BRP.

5.3.4

Implementatie

5.3.4.1

Converteren en persisteren afnemersindicaties
Class

AfnemersindicatieService
Verzoek (AfnemersindicatiesType)
Element
aNummer
afnemersindicatie
-

stapelNummer
volgNummer
afnemerCode
geldigheidStartDatum

Omschrijving
A-nummer
Een lijst van alle afnemersindicatie records voor de
gegeven persoon.
Stapelnummer
Volgnummer
Afnemer partij code
Startdatum geldigheid

Antwoord (AfnemersindicatiesAntwoordType)
Element
Omschrijving
afnemersindicatie
Lijst van resultaten per afnemersindicatie
- stapelNummer
Stapelnummer
- status
Mogelijke waarden: Toegevoegd, Fout
- foutmelding
Foutmelding (of waarschuwing)
De verwerking van de LO3 afnemersindicatie begint met een kwaliteitscontrole. Hierbij wordt
getoetst of de data aan alle precondities voldoet. Overtredingen op precondities worden
toegevoegd aan de lijst van resultaten. Bepaalde overtredingen worden wel gedeeltelijk verwerkt
waardoor de uiteindelijke status van een afnemersindicatie â€˜Toegevoegdâ€™ kan zijn met daarbij wel
een â€™foutmeldingâ€™.
Wanneer de afnemersindicatie verwerkt kan worden, wordt de LO3 afnemersindicatie
geconverteerd naar een BRP afnemerindicatie. De conversie vindt plaats in vier stappen. Als
eerste worden afnemerindicatie stapels die betrekking hebben op dezelfde partij samengevoegd.
Vervolgens worden inhoudelijk gegevens geconverteerd. In de derde stap vindt historieconversie
plaats. Ten slotte worden afgeleide gegevens ingevuld.
Na de conversie van de afnemerindicatie wordt deze opgeslagen in de BRP database.
5.3.5

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 23 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

5.4

Converteer en persisteer autorisaties

5.4.1

Service
Converteer een LO3 autorisatie naar een BRP autorisatie en persisteer deze in de BRP database
in initiÃ«le vulling modus (zie MV UC102 Vul autorisatietabelregels in BRP initieel [UC102]).

5.4.2

Preconditie

â€¢
5.4.3

Er is een LO3 autorisatie die in BRP gepersisteerd dient te worden.

Postconditie

â€¢
â€¢

De LO3 autorisatie is geconverteerd en gepersisteerd in BRP, of
er is een (inhoudelijke) fout opgetreden en de LO3 autorisatie is niet gepersisteerd in BRP.

5.4.4

Implementatie

5.4.4.1

Converteren en persisteren autorisatie
Class

AutorisatieService
Verzoek (AutorisatieType)
Element
afnemerCode
autorisatieTabelRegels
autorisatieId
geheimhoudingInd
verstekkingsBeperking
afnemerNaam
conditioneleVerstrekking
spontaanMedium
selectieSoort
berichtAand
eersteSelectieDatum
selectiePeriode
selectieMedium
plPlaatsingsBevoegdheid
adresVraagBevoegdheid
adHocMedium
adresMedium
tabelRegelStartDatum
tabelRegelEindDatum
sleutelRubrieken
spontaanRubrieken
spontaanVoorwaarderegel
selectieRubrieken
selectieVoorwaarderegel
adHocRubrieken
adHocVoorwaarderegel
adresRubrieken
adresVoorwaarderegel
afnemersVerstrekkingen

Omschrijving
Afnemer code (95.10)
Een lijst van autorisatietabel regels voor deze afnemer
Een technisch unieke identificatie voor deze regel
Indicatie geheimhouding (95.12)
Verstrekkingsbeperking (95.13)
Afnemernaam (95.20)
Conditionele verstrekking (95.43)
Medium spontaan (95.44)
Selectiesoort (95.52)
Berichtaanduiding (95.53)
Eerste selectiedatum (95.54)
Selectieperiode (95.55)
Medium selectie (95.56)
Plaatsingsbevoegdheid persoonslijst (95.62)
Adresvraagbevoegdheid (95.66)
Medium ad hoc (95.67)
Medium adresgeÃ¶rienteerd (95.73)
Datum ingang tabelregel (99.98)
Datum beÃ«indiging tabelregel (99.99)
Sleutelrubriek (95.42)
Rubrieknummer spontaan (95.40)
Voorwaarderegel spontaan (95.41)
Rubrieknummer selectie (95.50)
Voorwaarderegel selectie (95.51)
Rubrieknummer ad hoc (95.60)
Voorwaarderegel ad hoc (95.61)
Rubrieknummer adresgeoriÃ«nteerd (95.70)
Voorwaarderegel adresgeÃ¶rienteerd (95.71)
Afnemersverstrekkingen (95.63)

Antwoord (AutorisatieAntwoordType)
Element
Omschrijving
autorisatieTabelRegels
Een lijst van resultaten per autorisatietabel regel
Operatie BRP

Pagina 24 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

autorisatieId
status
foutmelding

Een technisch unieke identificatie voor deze regel
Mogelijke waarden: Toegevoegd of Fout
Foutmelding (of waarschuwing)

De verwerking van de LO3 autorisatie begint met een kwaliteitscontrole per autorisatie tabel
regel. Hierbij wordt getoetst of de data aan alle precondities voldoet. Wanneer de overtredingen
een te hoge severity hebben wordt de autorisatie tabel regel niet verwerkt en wordt de status
â€˜Foutâ€™ geretourneerd.
Wanneer de kwaliteitscontrole is geslaagd, wordt de LO3 autorisatie geconverteerd naar een BRP
autorisatie. De conversie vindt plaats in twee stappen. Als eerste worden inhoudelijk gegevens
geconverteerd. In de tweede en laatste stap vindt historieconversie plaats.
Na de conversie van de autorisatie wordt deze opgeslagen in de BRP database en wordt de
status â€˜Toegevoegdâ€™ geretourneerd.
5.4.5

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 25 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

5.5

Converteer en persisteer protocollering data

5.5.1

Service
Converteer LO3 protocollering data naar een BRP leveringsaantekening en persisteer deze in de
BRP database in initiÃ«le vulling modus (zie MV UC104 Vul protocollering in BRP initieel [UC104]).

5.5.2

Preconditie

â€¢
5.5.3

Er is LO3 protocollering data die in BRP gepersisteerd dient te worden.

Postconditie

â€¢
â€¢

De LO3 protocollering data is geconverteerd en gepersisteerd in BRP, of
er is een (inhoudelijke) fout opgetreden en de LO3 protocollering data is niet gepersisteerd
in BRP.

5.5.4

Implementatie

5.5.4.1

Converteren en persisteren protocollering data
Class

ProtocolleringService
Verzoek (ProtocolleringLijstType)
Element
protocollering
activiteitId
persoonId
nadereBijhoudingsaardCode
toegangLeveringsautorisatieId
dienstId
startTijdstip
laatsteActieTijdstip

Omschrijving
Een lijst van protocolleringen
Een technisch unieke identificatie voor deze protocollering
De technische sleutel van een persoon in BRP
Nadere bijhoudingsaard
Technische sleutel voor een toegang leveringsautorisatie
Technische sleutel voor een dienst
Start tijdstip
Laatste actie tijdstip

Antwoord (ProtocolleringAntwoordLijstType)
Element
Omschrijving
protocolleringAntwoord
Lijst van resultaten per protocollering record
activiteitId
Een technisch unieke identificatie voor deze protocollering
status
Mogelijke waarden: Toegevoegd of Fout
foutmelding
Foutmelding (of waarschuwing)
De verwerking van de LO3 protocollering data begint met een kwaliteitscontrole per
protocollering record. Hierbij wordt getoetst of de data aan alle precondities voldoet. Wanneer de
overtredingen een te hoge severity hebben wordt het record niet verwerkt en wordt de status
â€˜Foutâ€™ geretourneerd.
Wanneer de kwaliteitscontrole is geslaagd de LO3 protocollering data opgeslagen als BRP
leveringsaantekening en wordt de status â€˜Toegevoegdâ€™ geretourneerd.
5.5.5

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 26 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6

Services (synchronisatie modus)

Dit hoofdstuk beschrijft de services die beschikbaar zijn wanneer de BRP Synchronisatie Service
in â€˜synchronisatieâ€™-modus wordt uitgevoerd.

6.1

Converteer en persisteer persoonslijst

6.1.1

Proces
Converteer een LO3 persoonslijst naar een BRP persoonslijst en persisteer deze in de BRP
database in synchronisatie modus.

6.1.2

Preconditie

â€¢
6.1.3

Postconditie

â€¢
â€¢

6.1.4

Er is een LO3 persoonslijst die in BRP gepersisteerd dient te worden.

De LO3 persoonslijst is geconverteerd en gepersisteerd in BRP, of
er is een (inhoudelijke) fout opgetreden en de LO3 persoonslijst is niet gepersisteerd in
BRP.

Structuur
Package

Omschrijving
Package
waarin de
service
implementaties
staan.

nl.bzk.migratiebrp.synchronisatie.runtime.service

nl.bzk.migratiebrp.synchronisatie.runtime.service.synchronisatie

6.1.5

Implementatie

6.1.5.1

Converteer en persisteer persoonslijst

Package
waarin
specifieke
implementaties
voor het
synchroniseren
van
persoonslijsten
staan.

Class

SynchroniseerNaarBrpService
SynchronisatieVerwerkerImpl
PlVerwerkerRegulier
Verzoek (SynchroniseerNaarBrpVerzoekType)
Element
Omschrijving
verzendendeGemeente
Gemeente die het Lg01 of La01 bericht stuurt

Operatie BRP

Pagina 27 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

lo3PersoonslijstAlsTeletexString
typeBericht
beheerderkeuze
- keuze
-

teVervangenPersoonId
kandidaat

-

persoonId

-

versie

Persoonslijst in LO3 formaat
Mogelijke waarden: Lg01 of La01
Mogelijke waarden: Toevoegen, Vervangen,
Negeren, Afkeuren
ID van de persoonslijst die wordt vervangen
Kandidaat persoonslijsten (bij status onduidelijk)
ID van de persoonslijst die wordt vervangen
ID van de laatste administratieve handeling die op
de kandidaat persoonslijst is uitgevoerd.

Antwoord (SynchroniseerNaarBrpAntwoordType)
Element
status

kandidaten

Omschrijving
Mogelijke waarden: Toegevoegd,
Vervangen, Onduidelijk, Genegeerd,
Afgekeurd, Fout
Kandidaat persoonslijsten (bij status
onduidelijk)
ID van de kandidaat persoonslijst

-

persoonId

-

versie

-

lo3PersoonslijstAlsTeletexString

ID van de laatste administratieve
handeling die op de kandidaat
persoonslijst is uitgevoerd.
Persoonslijst in LO3 formaat

-

lo3Categorie

Melding
Logging van precondities, schoning en
bijzondere situaties
Categorie

-

lo3Stapel

Stapelnummer

-

lo3Voorkomen

Volgnummer

-

severity

Logging niveau

-

code

Logging code

-

lo3Element

Element

melding
logging

Voordat de persoonslijst gepersisteerd kan worden moet de persoonslijst gecontroleerd,
gevalideerd en geconverteerd worden. Indien de controle faalt (Beslissing B1, B2 of B3) zal een
antwoord worden gegeven met de status â€˜Foutâ€™. Indien de validatie faalt (Beslissing D1) zal een
antwoord worden gegeven met de status â€˜Afgekeurdâ€™. Indien de conversie faalt (Beslissing D2)
zal een antwoord worden gegeven met de status â€˜Foutâ€™.

6.1.5.1.1

Verwerk persoonslijst als reguliere synchronisatie

De persoonslijst wordt verwerkt zoals beschreven in MV UC220 Bepalen verwerking persoonslijst
[UC220]. De controles worden achtereenvolgende uitgevoerd en zullen leiden tot het vaststellen
van Ã©Ã©n van de beschreven situaties, of tot de situatie onduidelijk:

Operatie BRP

Pagina 28 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

âž¢
âž¢
âž¢
âž¢
âž¢
âž¢
âž¢
âž¢
âž¢
âž¢

6.1.6

Vervangen: Reguliere wijziging door gemeente van bijhouding (Beslissing I1)
Vervangen: Reguliere wijziging door verhuizing of gemeente herindeling (Beslissing I2)
Vervangen: Emigratie (Beslissing I9)
Vervangen: A-nummer wijziging door de gemeente van bijhouding (Beslissing I3)
Vervangen: Wijziging van opgeschorte persoonslijst met reden â€˜Oâ€™ (Overlijden) door een
andere gemeenten
Persoonslijst toevoegen (Beslissing I4)
Negeren: De aangeboden persoonslijst is ouder (Beslissing I5)
Negeren: De aangeboden persoonslijst bevat blokkeringsinformatie (Beslissing I6)
Negeren: De persoonslijsten zijn gelijk (Beslissing I7)
Onduidelijk (Beslissing I8)

Ontwerpbeslissingen
Binnen elke stap en controle wordt er een regel aan de melding toegevoegd. Het totaal aan
regels komt zodoende volledig terug in het antwoordbericht binnen â€˜meldingâ€™ en vormt een
kruimelpad (zie bijlage A) waarmee getraceerd kan worden welke stappen en/of controles zijn
uitgevoerd.
Elke persoonslijst wordt gevalideerd tegen baseline 1 pre-condities. Indien niet aan een van de
condities wordt voldaan, wordt er per overtreden baseline 1 pre-conditie een logregel aan
â€˜loggingâ€™ toegevoegd. Hiermee wordt door â€˜loggingâ€™ in het antwoordbericht duidelijk aan welke
pre-condities niet is voldaan.

Operatie BRP

Pagina 29 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.2

Ophalen en converteren persoonslijst

6.2.1

Service
Haal een BRP persoonslijst op uit de BRP database en converteer deze naar een LO3
persoonslijst.

6.2.2

Preconditie

â€¢
6.2.3

Er is in de BRP database een gepersisteerde BRP persoonslijst.

Postconditie

â€¢

Een naar LO3 geconverteerde persoonslijst welke in het antwoordbericht staat.

6.2.4

Implementatie

6.2.4.1

Ophalen en converteren persoonslijst
Class

LeesUitBrpService
Verzoek (LeesUitBrpVerzoekType)
Element
aNummer
technischeSleutel
antwoordFormaat
Antwoord (LeesUitBrpAntwoordType)
Element
Status
lo3Pl
lo3PlXml
brpPl

Omschrijving
A-nummer
Technische sleutel
Mogelijke waarden: Lo3, Lo3XML, Brp

Omschrijving
Mogelijke waarden: Ok
Persoonslijst in LO3 teletex formaat
Persoonslijst in LO3 XML (migratie specifiek)
formaat
Persoonslijst in BRP XML (migratie specifiek)
formaat

De gevraagde persoonslijst (op basis van a-nummer of technische sleutel) wordt opgevraagd uit
de BRP database en geconverteerd naar het gevraagde formaat.
6.2.5

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 30 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.3

Zoek persoon (op actuele of historische gegevens)

6.3.1

Proces
Personen kunnen op basis van actuele of historische gegevens gezocht worden (zie Logisch
Ontwerp GBA [LO] paragraaf III.1.5.2).

6.3.2

Preconditie

â€¢
6.3.3

Postconditie

â€¢
6.3.4

n.v.t.

n.v.t.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.zoeken
6.3.5

Implementatie

6.3.5.1

Zoek persoon

Omschrijving
Package waarin de services voor het zoeken van
personen staan.

Class

ZoekPersoonOpActueleGegevensService
ZoekPersoonOpHistorischeGegevensService
Input (ZoekPersoonOpActueleGegevensVerzoekType)
Element
Omschrijving
aNummer
Actueel a-nummer (01.01.10)
burgerservicenummer
Actueel burgerservicenummer (01.01.20)
geslachtsnaam
Actuele geslachtsnaam (01.02.40)
postcode
Actuele postcode (08.11.60)
aanvullendeZoekcriteria
Aanvullende zoek criteria
Input (ZoekPersoonOpHistorischeGegevensVerzoekType)
Element
Omschrijving
aNummer
Historisch a-nummer (51.01.10)
burgerservicenummer
Historisch burgerservicenummer (51.01.20)
geslachtsnaam
Historische geslachtsnaam (51.02.40)
aanvullendeZoekcriteria
Aanvullende zoek criteria
Antwoord (ZoekPersoonAntwoordType)
Element
status
resultaat
uniekGevondenPersoon
persoonId
actueelANummer
bijhoudingsgemeente

Omschrijving
Mogelijke waarden: Ok
Mogelijke waarden: Geen, Gevonden of Meedere
Alleen aanwezig bij resultaat â€˜Gevondenâ€™
Technisch ID persoon
Actueel a-nummer
Actuele bijhoudingsgemeente

Op basis van de basis criteria in het zoek verzoek (a-nummer, burgerservicenummer,
geslachtsnaam en/of postcode) wordt een query uitgevoerd op de BRP database. Wanneer
Operatie BRP

Pagina 31 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

personen worden gevonden worden deze via de conversie programmatuur omgezet naar LO3
formaat en wordt gecontroleerd dat deze persoonslijsten voldoen aan de aanvullende
zoekcriteria. Indien meer dan Ã©Ã©n persoonslijst wordt gevonden, wordt de verwerking gestaakt
en wordt het resultaat â€˜Meerdereâ€™ teruggegeven.

6.3.5.2

Aanvullende zoekcriteria
De aanvullende zoekcriteria moeten worden aangegeven in LO3 bericht inhoud formaat (zie
Logisch Ontwerp GBA [LO] paragraaf III.1.3.2).

6.3.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 32 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.4

Ad hoc zoek persoonsvraag (netwerk)

6.4.1

Proces
In GBAV is het mogelijk om te zoeken op personen middels de LO3 Ad hoc zoek persoon
netwerkvraag (zie Logisch Ontwerp GBA [LO] paragraaf C.2.11.3).

6.4.2

Preconditie

â€¢
6.4.3

Postconditie

â€¢

6.4.4

Er is een â€˜AdHocZoekPersoonVerzoekâ€™-bericht op de â€˜sync.verzoekâ€™ queue.

Er is een â€˜Persoonsvraagâ€™-bericht op de â€˜GbaAdhocZoekPersoonsVerzoekâ€™- queue geplaatst
of indien er een validatie- of verzendfout is opgetreden een
â€˜AdHocZoekPersoonAntwoordâ€™-bericht op de â€˜sync.antwoordâ€™-queue.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.service.adhoczoeken
6.4.5

Implementatie

6.4.5.1

Ad hoc Zoek persoon

Omschrijving
Package waarin de services voor het zoeken van
personen staan.

Class

AdHocZoekAntwoordNaarIscMessageCreator
AdHocZoekenNaarBrpMessageCreator
AdHocZoekenNaarBrpVerzender
AdHocZoekenNaarIscVerzender
PersoonsvraagAntwoordMessageListener
ZoekPersoonService
Input (AdHocZoekPersoonVerzoekType)
Element
Omschrijving
partijCode
De code van de partij die het verzoek doet;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
persoonIdentificerendeGegevens
De gegevens waarop de persoon geÃ¯dentificeerd
kan worden binnen de BRP
gevraagdeRubrieken
De rubrieken die in het antwoordbericht dienen te
komen.
soortDienst
Het soort dienst, altijd: ZOEK_PERSOON

Operatie BRP

Pagina 33 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Output (Persoonsvraag)
Element
partijCode

zoekCriteria
zoekRubrieken
gevraagdeRubrieken
soortDienst

Omschrijving
De code van de partij die het verzoek doet;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
De BRP zoekcriteria waarop de persoon
geÃ¯dentificeerd kan worden binnen de BRP
De LO3-zoekrubrieken waarop de persoon
geÃ¯dentificeerd dient te worden binnen de BRP
De rubrieken die in het antwoordbericht dienen te
komen.
Het soort dienst, altijd: ZOEK_PERSOON

Antwoord (AdHocZoekPersoonAntwoordType)
Element
Omschrijving
inhoud
Het op basis van de gevraagde samengestelde
Ha01-bericht; de inhoud is leeg indien de
foutreden gevuld is.
foutreden
Mogelijke waarden: G, U, X
Op basis van de meegegeven elementen in het verzoekbericht wordt een BRP â€˜Persoonsvraagâ€™
bericht gemaakt in JSON-formaat. Dit bericht wordt naar de â€˜GbaAdhocPersoonsvraagVerzoekâ€™queue in BRP verstuurd en daar verwerkt door de GBA-bevraging-service. Het antwoord van
deze service bevat ofwel een foutreden (G, U, X) ofwel de gevraagde rubrieken geformatteerd
conform LO3 als Ha01-bericht.
Omdat de service asynchroon werkt, wordt het antwoord van de GBA-bevraging-service verwerkt
door de PersoonsvraagAntwoordMessageListener. Indien er iets misgaat met het
verzenden richting de BRP of indien er een inhoudelijke validatie is gefaald, zal er direct een
antwoord worden verstuurd uit de ZoekPersoonOpAdresService.

6.4.6

Ontwerpbeslissingen
Omdat het plaatsing-/verwijdering afnemerindicatie proces (uc1003) ook gebruik maakt van
deze service om een persoon in de BRP te identificeren, is het nodig om de soort dienst mee te
geven. Voor de Ad hoc zoek persoon vraag is deze altijd â€˜ZOEK_PERSOONâ€™; voor de plaatsing
wordt de soort dienst â€˜PLAATSING_AFNEMERINDICATIEâ€™ gebruikt en voor de verwijdering
â€˜VERWIJDERING_AFNEMERINDICATIEâ€™.

Operatie BRP

Pagina 34 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.5

Ad hoc zoek persoonsvraag antwoord (netwerk)

6.5.1

Proces
Er is een antwoord op een ad hoc persoonsvraag vanuit BRP die doorgestuurd dient te worden
naar de migratievoorzieningen.

6.5.2

Preconditie

â€¢
6.5.3

Postconditie

â€¢
6.5.4

Er is een antwoord op een ad hoc persoonsvraag beschikbaar van BRP.

Het antwoord is verstuurd naar ISC.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.service.adhoczoeken
6.5.5

Implementatie

6.5.5.1

Verwerken ad hoc persoonsvraag antwoord

Omschrijving
Package waarin de services voor ad hoc zoeken
staan.

Class

PersoonsvraagMessageHandler
Input
Element
foutreden
Inhoud

Omschrijving
Foutreden
Het ad hoc persoonsvraag antwoord

Output (AdHocZoekPersoonOpAdresAntwoordType)
Element
Omschrijving
inhoud
Het op basis van de gevraagde samengestelde
Ha01-bericht; de inhoud is leeg indien de
foutreden gevuld is.
foutreden
Mogelijke waarden: G, U, X
De gegevens inhoud worden gekopieerd naar een AdHocZoekPersoonAntwoordBericht en
verstuurd naar ISC via de sync.antwoord queue.

6.5.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 35 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.6

Ad hoc zoek persoon op adresvraag (netwerk)

6.6.1

Proces
In GBAV is het mogelijk om te zoeken op personen welke staan ingeschreven op een bepaald
adres middels de LO3 Ad hoc zoek persoon op adres netwerkvraag (zie Logisch Ontwerp GBA
[LO] paragraaf C.2.11.4).

6.6.2

Preconditie

â€¢
6.6.3

Postconditie

â€¢

6.6.4

Er is een â€˜AdHocZoekPersoonOpAdresVerzoekâ€™-bericht op de â€˜sync.verzoekâ€™ queue.

Er is een â€˜Adresvraagâ€™-bericht op de â€˜GbaAdhocAdresvraagVerzoekâ€™- queue geplaatst of
indien er een validatie- of verzendfout is opgetreden een
â€˜AdHocZoekPersoonOpAdresAntwoordâ€™-bericht op de â€˜sync.antwoordâ€™-queue.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.service.adhoczoeken
6.6.5

Implementatie

6.6.5.1

Ad hoc Zoek persoon

Omschrijving
Package waarin de services voor het zoeken van
personen staan.

Class

AdHocZoekAntwoordNaarIscMessageCreator
AdHocZoekenNaarBrpMessageCreator
AdHocZoekenNaarBrpVerzender
AdHocZoekenNaarIscVerzender
AdresvraagAntwoordMessageListener
ZoekPersoonOpAdresService
Input (AdHocZoekPersoonOpAdresVerzoekType)
Element
Omschrijving
partijCode
De code van de partij die het verzoek doet;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
identificerendeGegevens
De persoons-/adresgegevens waarop de
perso(o)n(en) gezocht kan/kunnen worden binnen
de BRP
gevraagdeRubrieken
De rubrieken die in het antwoordbericht dienen te
komen.
adresfunctie
De adresfunctie uit het GBA, mogelijke waarden:
B, W, A
identificatie
Indicator waarop de identificatie plaatsvindt,
mogelijke waarden: A, P

Operatie BRP

Pagina 36 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Output (Adresvraag)
Element
partijCode

zoekCriteria
zoekRubrieken
gevraagdeRubrieken
soortDienst
soortIdentificatie

Omschrijving
De code van de partij die het verzoek doet;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
De BRP zoekcriteria waarop de persoon
geÃ¯dentificeerd kan worden binnen de BRP
De LO3-zoekrubrieken waarop de persoon
geÃ¯dentificeerd dient te worden binnen de BRP
De rubrieken die in het antwoordbericht dienen te
komen.
Het soort dienst, altijd:
ZOEK_PERSOON_OP_ADRESGEGEVENS
Waarop identificatie plaatsvindt, mogelijke
waarden: PERSOON, ADRES

Antwoord (AdHocZoekPersoonOpAdresAntwoordType)
Element
Omschrijving
inhoud
Het op basis van de gevraagde samengestelde
Xa01-bericht; de inhoud is leeg indien de
foutreden gevuld is.
foutreden
Mogelijke waarden: G, P, U, X, Z
Op basis van de meegegeven elementen in het verzoekbericht wordt een BRP â€˜Adresvraagâ€™
bericht gemaakt in JSON-formaat. Dit bericht wordt naar de â€˜GbaAdhocAdresvraagVerzoekâ€™queue in BRP verstuurd en daar verwerkt door de GBA-bevraging-service. Het antwoord van
deze service bevat ofwel een foutreden (G, P, U, X, Z) ofwel de gevraagde rubrieken
geformatteerd conform LO3 als Xa01-bericht.
Omdat de service asynchroon werkt, wordt het antwoord van de GBA-bevraging-service verwerkt
door de AdresvraagAntwoordMessageListener. Indien er iets misgaat met het verzenden
richting de BRP of indien er een inhoudelijke validatie is gefaald, zal er direct een antwoord
worden verstuurd uit de ZoekPersoonOpAdresService.

6.6.6

Ontwerpbeslissingen
Op basis van de adresfunctie dient in het geval deze de waarde B (briefadres) of W (woonadres)
heeft, de rubriek 08.10.10 als extra zoekcriterium opgenomen te worden in het Adresvraag
bericht dat naar de BRP wordt verstuurd.
Omdat de adresvraag een identificatie kan doen op basis van persoonsgegevens of
adresgegevens dient er richting de BRP doorgegeven te worden welke van de twee identificaties
gebruikt dient te worden. Identificatie wordt voor het Adresvraag bericht vertaald naar â€˜ADRESâ€™
in het geval identificatie gelijk is aan â€˜Aâ€™ en naar â€˜PERSOONâ€™ in het geval deze gelijk is aan â€˜Pâ€™.

Operatie BRP

Pagina 37 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.7

Ad hoc zoek persoon op adresvraag antwoord (netwerk)

6.7.1

Proces
Er is een antwoord op een ad hoc adresvraag vanuit BRP die doorgestuurd dient te worden naar
de migratievoorzieningen.

6.7.2

Preconditie

â€¢
6.7.3

Postconditie

â€¢
6.7.4

Er is een antwoord op een ad hoc adresvraag beschikbaar van BRP.

Het antwoord is verstuurd naar ISC.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.service.adhoczoeken
6.7.5

Implementatie

6.7.5.1

Verwerken ad hoc adresvraag antwoord

Omschrijving
Package waarin de services voor ad hoc zoeken
staan.

Class

AdresvraagMessageHandler
Input
Element
foutreden
Inhoud

Omschrijving
Foutreden, mogelijke waarden: G, P, U, X, Z
Het ad hoc adresvraag antwoord

Output (AdHocZoekPersoonOpAdresAntwoordType)
Element
Omschrijving
inhoud
Het op basis van de gevraagde samengestelde
Xa01-bericht; de inhoud is leeg indien de
foutreden gevuld is.
foutreden
Mogelijke waarden: G, P, U, X, Z
De gegevens inhoud worden gekopieerd naar een AdHocZoekAdresAntwoordBericht en
verstuurd naar ISC via de sync.antwoord queue.

6.7.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 38 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.8

Persisteer blokkering

6.8.1

Service
Blokkeer een BRP persoonslijst en persisteer deze blokkering in de BRP database.

6.8.2

Preconditie

â€¢
6.8.3

Postconditie

â€¢
â€¢
6.8.4

Er is een niet geblokkeerde BRP persoonslijst.

De betreffende BRP persoonslijst is geblokkeerd in BRP, of
er is een fout opgetreden en de BRP persoonslijst is niet of nog steeds geblokkeerd.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

6.8.5

Implementatie

6.8.5.1

Persisteer blokkering

Omschrijving
Package waarin de service
implementaties staan.

Class

BlokkeringVerzoekService
Verzoek (BlokkeringVerzoekType)
Element
aNummer
persoonsaanduiding
processId
gemeenteNaar
gemeenteRegistratie
Antwoord (BlokkeringAntwoordType)
Element
status
persoonsaanduiding
processId
gemeenteNaar

Omschrijving
A-nummer
Indicatie type blokkering
Proces identificatie
Gemeente waarnaar wordt verhuisd
Gemeente die de blokkering registreert

Omschrijving
Mogelijke waarden: Ok, Geblokkeerd
Indicatie type blokkering (enkel gevuld wanneer
de persoonslijst reeds was geblokkeerd)
Proces identificatie (enkel gevuld wanneer de
persoonslijst reeds was geblokkeerd)
Gemeente waarnaar wordt verhuisd (enkel gevuld
wanneer de persoonslijst reeds was geblokkeerd)

Sla een blokkering voor een persoonslijst (geÃ¯dentificeerd door het gegeven a-nummer) op in de
BRP database. Indien de persoonslijst reeds is geblokkeerd wordt de actuele blokkering terug
gegeven; er wordt geen nieuwe blokkering opgeslagen.
6.8.6

Ontwerpbeslissingen
Het opslaan van de blokkering ligt buiten de standaard BRP database tabellen in de tabel
â€˜mig_blokkeringâ€™ (blokkering-schema). De reden hiervoor is dat blokkering LO3-specifiek is
vanwege de gekozen decentrale oplossingsrichting. Zonder blokkering zou het immers mogelijk
zijn om tegelijkertijd meerdere wijzigingen aan een persoonslijst te doen waardoor er hierin
inconsistenties kunnen optreden.

Operatie BRP

Pagina 39 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.9

Persisteer deblokkering

6.9.1

Service
Deblokkeer een geblokkeerde BRP persoonslijst en persisteer deze deblokkering in de BRP
database.

6.9.2

Preconditie

â€¢
6.9.3

Postconditie

â€¢
6.9.4

Er is een geblokkeerde BRP persoonslijst.

De betreffende BRP persoonslijst is niet meer geblokkeerd in BRP.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

6.9.5

Implementatie

6.9.5.1

Persisteer deblokkering

Omschrijving
Package waarin de service
implementaties staan.

Class

DeblokkeringVerzoekService
Verzoek (DeblokkeringVerzoekType)
Element
aNummer
processId
gemeenteRegistratie

Omschrijving
A-nummer
Proces identificatie
Gemeente die de deblokkering registreert

Antwoord (DeblokkeringAntwoordType)
Element
Omschrijving
status
Mogelijke waarden: Ok
Verwijder de blokkering van een persoonslijst (geÃ¯dentificeerd door het gegeven a-nummer) uit
de BRP database.
6.9.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 40 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.10

Ophalen blokkeringsinformatie

6.10.1

Service
Haal de blokkeringsinformatie voor een BRP persoonslijst op uit de BRP database.

6.10.2

Preconditie

â€¢

Er is een BRP persoonslijst in de BRP database.

6.10.3

Postconditie
N.v.t.

6.10.4

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

6.10.5

Implementatie

6.10.5.1

Ophalen blokkeringsinformatie

Omschrijving
Package waarin de service
implementaties staan.

Class

BlokkeringInfoVerzoekService
Verzoek (BlokkeringInfoVerzoekType)
Element
aNummer

Omschrijving
A-nummer

Antwoord (BlokkeringInfoAntwoordType)
Element
Omschrijving
status
Mogelijke waarden: Ok
persoonsaanduiding
Indicatie type blokkering
processId
Proces identificatie
gemeenteNaar
Gemeente waarnaar wordt verhuisd
Haal de (eventuele) blokkering van een persoonslijst (geÃ¯dentificeerd door het gegevens anummer) op uit de BRP database.
6.10.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 41 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.11

Plaatsen afnemersindicatie

6.11.1

Proces
Roep de GBA Afnemerindicatie route aan in BRP om een afnemersindicatie te plaatsen (zie MV
UC1003 Verwerken handmatig plaatsen en verwijderen afnemersindicatie [UC1003]).

6.11.2

Preconditie

â€¢

6.11.3

Postconditie

â€¢
6.11.4

De technische abonnementsgegevens (AfnemerRegister) en persoonsgegevens
(ZoekPersoon) zijn bepaald.

Het verzoek is verwerkt.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

6.11.5

Implementatie

6.11.5.1

Plaatsen afnemersindicatie

Omschrijving
Package waarin de service
implementaties staan.

Class

PlaatsAfnemersindicatieService
Verzoek (VerwerkAfnemersindicatieVerzoekType)
Element
Omschrijving
bsn
BSN van de persoon
partijCode
Partij code afnemer
Output (AfnemerindicatieOnderhoudOpdracht)
Element
Omschrijving
bsn
BSN van de persoon
partijCode
Partij code afnemer
effectAfnemerindicatie
Effect afnemerindicatie: PLAATSEN
referentienummer
Referentienummer waarmee het antwoord
gecorreleerd kan worden
Roept de GBA Afnemersindicatie route aan in BRP door een bericht te plaatsen op de
GbaAnemerindicaties queue met het â€˜effectâ€™ plaatsen.
6.11.6

Ontwerpbeslissingen
Aangezien de verwerking in BRP een asynchroon antwoord oplevert kan deze service niet direct
een antwoord retourneren. Het antwoord zal worden verwerkt door de service â€˜Verwerk
afnemersindicatie antwoordâ€™.

Operatie BRP

Pagina 42 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.12

Verwijderen afnemersindicatie

6.12.1

Proces
Roep de GBA Afnemerindicatie route aan in BRP om een afnemersindicatie te verwijderen (zie MV
UC1003 Verwerken handmatig plaatsen en verwijderen afnemersindicatie [UC1003]).

6.12.2

Preconditie

â€¢

6.12.3

Postconditie

â€¢
6.12.4

De technische abonnementsgegevens (AfnemerRegister) en persoonsgegevens
(ZoekPersoon) zijn bepaald.

Het verzoek is verwerkt.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

6.12.5

Implementatie

6.12.5.1

Verwijderen afnemersindicatie

Omschrijving
Package waarin de service
implementaties staan.

Class

VerwijderAfnemersindicatieService
Input (VerwerkAfnemersindicatieVerzoekType)
Element
Omschrijving
bsn
BSN van de persoon
partijCode
Partij code afnemer
Output (AfnemerindicatieOnderhoudOpdracht)
Element
Omschrijving
bsn
BSN van de persoon
partijCode
Partij code afnemer
effectAfnemerindicatie
Effect afnemerindicatie: VERWIJDEREN
referentienummer
Referentienummer waarmee het antwoord
gecorreleerd kan worden
Roept de GBA Afnemersindicatie route aan in BRP door een bericht te plaatsen op de
GbaAnemerindicaties queue met het â€˜effectâ€™ verwijderen.
6.12.6

Ontwerpbeslissingen
Aangezien de verwerking in BRP een asynchroon antwoord oplevert kan deze service niet direct
een antwoord retourneren. Het antwoord zal worden verwerkt door de service â€˜Verwerk
afnemersindicatie antwoordâ€™.

Operatie BRP

Pagina 43 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.13

Verwerk afnemersindicatie antwoord

6.13.1

Proces
Met Ã©Ã©n van de services â€˜Plaats afnemersindicatieâ€™ of â€˜Verwijder afnemersindicatieâ€™ is een
verwerking op de GBA Afnemerindicatie route gestart (in BRP). Deze route levert een antwoord
bericht op, op de GbaAfnemerindicatiesAntwoorden queue (in BRP), die door deze service
wordt verwerkt.

6.13.2

Preconditie

â€¢
6.13.3

Postconditie

â€¢
6.13.4

Er is een antwoord beschikbaar van BRP.

Er is een antwoord verstuurd naar ISC.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime

6.13.5

Implementatie

6.13.5.1

Verwerken afnemerindicatie antwoord

Omschrijving
Package waarin de message
handlers staan.

Class

AfnemerindicatiesMessageHandler
Input (AfnemerindicatieOnderhoudAntwoord)
Element
Omschrijving
foutcode
Verwachte waarden: G, H, I, R, X
Op basis van het AfnemerindicatieOnderhoudAntwoord wordt een
VerwerkAfnemersindicatieAntwoord opgesteld. Indien de foutcode is gevuld zal de status
worden gevuld met â€˜Foutâ€™, anders met â€˜Okâ€™.
Output (VerwerkAfnemersindicatieAntwoordType)
Element
Omschrijving
status
Mogelijke waarden: Ok, Fout
foutcode
Mogelijke waarden: G, H, I, R, X
Het bericht wordt verstuurd als â€˜antwoordâ€™ op het oorspronkelijke â€˜Plaats afnemersindicatieâ€™ of
â€˜Verwijder afnemersindicatieâ€™ verzoek op de sync.antwoord queue.

6.13.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 44 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.14

Verwerk toevallige gebeurtenis

6.14.1

Proces
Roep de GBA Toevallige gebeurtenis route aan in BRP om een toevallige gebeurtenis te
verwerken (zie MV UC309 Verwerk toevallige gebeurtenis in GBA [UC309]).

6.14.2

Preconditie

â€¢
6.14.3

Postconditie

â€¢
6.14.4

Het verzoek is ontvangen.

Het verzoek is verwerkt.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

6.14.5

Implementatie

6.14.5.1

Verwerk toevallige gebeurtenis

Omschrijving
Package waarin de service
implementaties staan.

Class

VerwerkToevalligeGebeurtenisService
6.14.5.2

Input
Input (VerwerkToevalligeGebeurtenisVerzoekType)
Element
Omschrijving
verzendendeGemeente
Verzendende gemeente
ontvangendeGemeente
Ontvangende gemeente
aktenummer
Aktenummer
tb02InhoudAlsTeletex
Tb02 (inhoud als teletex string)

Verplicht
Ja
Ja
Ja
Ja

Bij het verwerken van de toevallige gebeurtenis worden de volgende stappen doorlopen:

1. Controleren Tb02 inhoud
a. Parsen teletex string
b. Syntax controle
c. Verwerken opbouw tb02
d. Controle precondities
2. Bepalen hoofdpersoon
a. Zoeken hoofdpersoon
b. Controle bijhouder
c. Controle actualiteit gegevens
d. Zoeken relatie (enkel bij verbintenissen)
3. Opbouwen administratieve handeling
4. Verzenden administratieve handeling
Operatie BRP

Pagina 45 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.14.5.2.1

Controleren Tb02 inhoud

De inhoud van het Tb02 bericht wordt geparsed en gecontroleerd. Indien het Tb02 bericht
voldoet aan alle gestelde precondities wordt de inhoud van het bericht geconverteerd naar BRP
gegevens waarmee de hoofdpersoon bepaald kan worden en de administratieve handeling kan
worden opgebouwd.

6.14.5.2.2

Bepalen hoofdpersoon

Op basis van de gegevens van de hoofdpersoon wordt de persoon binnen BRP bepaald. Indien de
persoon niet kan worden gevonden (op basis van het a-nummer) wordt direct een
VerwerkToevalligeGebeurtenisAntwoord verstuurd met een foutreden (â€˜Gâ€™).
Bij actuele bijhouder van de persoon en de blokkeringsstatus worden gecontroleerd. Indien de
persoon is geblokkeerd of niet wordt bijgehouden door de gemeente waaraan het bericht wordt
verstuurd, wordt direct een VerwerkToevalligeGebeurtenisAntwoord verstuurd met een
foutreden (respectievelijk â€˜Bâ€™ of â€˜Vâ€™).
Tenslotte worden de gegeven van de hoofdpersoon gecontroleerd met de gegevens uit het Tb02
bericht. Indien deze niet overeenkomen wordt direct een
VerwerkToevalligeGebeurtenisAntwoord verstuurd met een foutreden (â€˜Nâ€™).
Indien de akte betrekking heeft op een reeds bestaande verbintenis (akte 3B, 3H, 5B of 5H)
wordt de bestaande relatie gezocht binnen de gevonden persoon waarbij alle gegeven
sluitingsgegevens moeten overeenkomen. Indien de relatie niet wordt gevonden wordt direct een
VerwerkToevalligeGebeurtenisAntwoord verstuurd met een foutreden (â€˜Nâ€™).

6.14.5.2.3

Opbouwen administratieve handeling

De administratieve handeling wordt opgebouwd en gevuld vanuit de geconverteerde gegevens.

6.14.5.2.4

Verzenden administratieve handeling

De opgebouwde administratieve handeling wordt omgezet naar XML en verzonden op de
GbaToevalligeGebeurtenissen queue (in BRP).

6.14.6

Ontwerpbeslissingen
Aangezien de verwerking in BRP een asynchroon antwoord oplevert kan deze service niet direct
een antwoord retourneren. Het antwoord zal worden verwerkt door de service â€˜Verwerk
toevallige gebeurtenis antwoordâ€™.

Operatie BRP

Pagina 46 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.15

Verwerk toevallige gebeurtenis antwoord

6.15.1

Proces
Met de services â€˜Verwerk toevallige gebeurtenisâ€™ is een verwerking op de GBA Toevallige
gebeurtenis route gestart (in BRP). Deze route levert een antwoord bericht op, op de
GbaToevalligeGebeurtenissenAntwoord queue (in BRP), die door deze service wordt verwerkt.

6.15.2

Preconditie

â€¢
6.15.3

Er is een antwoord beschikbaar van BRP.

Postconditie

â€¢
6.15.4

Er is een antwoord verstuurd naar ISC.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime

6.15.5

Implementatie

6.15.5.1

Verwerken toevallige gebeurtenis antwoord

Omschrijving
Package waarin de message
handlers staan.

Class

ToevalligeGebeurtenisMessageHandler
Input
Element
foutcode
Melding (eventueel meerdere malen)

Omschrijving
Indicatie of het verzoek succesvol is verwerkt

-

soort

Soort melding

-

regel

Regel die overtreden is

-

melding

Melding tekst

Op basis van het antwoord uit BRP wordt een VerwerkToevalligeGebeurtenisAntwoord
opgesteld waarin de foutcode wordt bepaald op basis van de vertaling die staat beschreven in
MV UC309 Verwerk toevallige gebeurtenis in GBA [UC309].
Output (VerwerkToevalligeGebeurtenisAntwoordType)
Element
Omschrijving
status
Mogelijke waarden: Ok, Fout
foutcode
Mogelijke waarden: B, G, N, O, U, V
administratieveHandelingId
Technisch Id van de administratieve handeling
bijhoudingGemeenteCode
Gemeente code bij fout meldingen B of V
Het bericht wordt verstuurd als â€˜antwoordâ€™ op het oorspronkelijke â€˜Verwerk Toevallige
Gebeurtenisâ€™ verzoek op de sync.antwoord queue.
Operatie BRP

Pagina 47 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.15.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 48 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.16

Verwerk levering

6.16.1

Proces
Er is een levering vanuit BRP die doorgestuurd dient te worden naar de migratievoorzieningen.

6.16.2

Preconditie

â€¢
6.16.3

Postconditie

â€¢
6.16.4

Er is een levering beschikbaar van BRP.

Er is een levering verstuurd naar ISC.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime

6.16.5

Implementatie

6.16.5.1

Verwerken toevallige gebeurtenis antwoord

Omschrijving
Package waarin de message
handlers staan.

Class

LeveringenMessageHandler
Input
Element
willekeurig

Omschrijving
Een leveringsbericht

Zonder de inhoud te verwerken wordt het bericht direct doorgezet naar de levering queue
binnen de routering centrale.

6.16.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 49 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.17

Verwerk vrijbericht van GBA naar BRP

6.17.1

Proces
In de GBA is het voor partijen mogelijk om elkaar vrije berichten te sturen (zie Logisch Ontwerp
GBA [LO] paragraaf III.2.15 Vrij bericht).

6.17.2

Preconditie

â€¢
6.17.3

Postconditie

â€¢

6.17.4

Er is een â€˜VrijBerichtVerzoekBerichtâ€™-bericht op de â€˜sync.verzoekâ€™ queue.

Er is een â€˜VrijBerichtOpdrachtâ€˜-bericht op de â€˜GbaVrijeBerichtenâ€™-queue. Er is een
â€˜VrijBerichtAntwoordâ€˜-bericht op de â€˜sync.antwoord queue.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.service.vrijbericht
6.17.5

Implementatie

6.17.5.1

Verwerk vrijbericht

Omschrijving
Package waarin de services voor het verwerken
van vrijberichten staan.

Class

VrijBerichtNaarBrpMessageCreator
VrijBerichtNaarBrpVerzender
VrijBerichtService
VrijBerichtAntwoordMessageListener
VrijBerichtAntwoordNaarIscMessageCreator
VrijBerichtAntwoordNaarIscVerzender

Input (VrijBerichtVerzoekType)
Element
verzendendePartij

ontvangendePartij

bericht
referentienummer

Output (VrijBerichtOpdracht)
Element
verzendendePartijCode

ontvangendePartijCode

Operatie BRP

Omschrijving
De code van de partij die het vrijbericht verstuurt;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
De code van de partij die het vrijbericht ontvangt;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
Inhoud van het vrijbericht.
Referentienummer

Omschrijving
De code van de partij die het vrijbericht verstuurt;
Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
De code van de partij die het vrijbericht ontvangt;

Pagina 50 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.17.6

Bericht
Referentienummer

Let op: de code is altijd lengte 6 en kan voorloop
nullen bevatten (bijvoorbeeld 000301)
Inhoud van het vrijbericht.
Referentie nummer

Antwoord (VrijBerichtAntwoordType)
Element
status
referentienummer

Omschrijving
Mogelijke waarden: Ok, Fout
Referentie nummer

Ontwerpbeslissingen

Operatie BRP

Pagina 51 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

6.18

Verwerk notificaties van BRP naar GBA

6.18.1

Proces
Er is een notificatie vanuit BRP die doorgestuurd dient te worden naar de migratievoorzieningen.

6.18.2

Preconditie

â€¢
6.18.3

Postconditie

â€¢
6.18.4

Er is een notificatie beschikbaar van BRP.

Er is een notificatie verstuurd naar ISC.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.
runtime.notificatie
6.18.5

Implementatie

6.18.5.1

Verwerken van notificatie

Omschrijving
Package waarin de verwerking van
notificaties wordt afgehandeld.

Class

NotificatieMessageHandler
Input
Element
willekeurig

Omschrijving
Een notificatie bericht

Zonder de inhoud te verwerken wordt het bericht direct doorgezet naar de notificatie queue
binnen de routering centrale.

6.18.6

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 52 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

7

Register services (synchronisatie modus)

Verschillende componenten binnen het systeem zijn afhankelijk van de gegevens die beschikbaar
worden gesteld via registers. Deze informatie is opgeslagen in de BRP database en daarom
alleen direct raadpleegbaar door de BRP Synchronisatie Service. Omdat de componenten worden
geblokkeerd worden totdat deze informatie beschikbaar is, is er voor gekozen deze verzoeken
apart te behandelen en daarvoor een eigen verzoek queue te geven.
Deze services zijn alleen beschikbaar indien de BRP Synchronisatie Service in â€˜synchronisatieâ€™modus wordt uitgevoerd.

7.1

Ophalen gemeenteregister

7.1.1

Proces
Haal het gemeenteregister op uit de BRP database.

7.1.2

Preconditie

â€¢
7.1.3

De BRP database bevat een overzicht van LO3- en BRP-gemeenten en afnemers.

Postconditie

â€¢
7.1.4

Het gemeenteregister is gepubliceerd.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime.service

7.1.5

Implementatie

7.1.5.1

Ophalen gemeenteregister

Omschrijving
Package waarin de service
implementaties staan.

Class

GemeenteRegisterService
Verzoek (LeesGemeenteRegisterVerzoekType)
Element
Omschrijving
<leeg>
Antwoord (LeesGemeenteRegisterAntwoordType)
Element
Omschrijving
Status
Mogelijke waarden: Ok
Gemeente (meerdere malen)
- partijCode
BRP partijcode

-

Operatie BRP

gemeenteCode

LO3 gemeentecode

Pagina 53 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

-

datumBrp

Datum overgang naar BRP

Haal het gemeenteregister op uit de BRP database. Het gemeenteregister bevat alle actueel
geldige gemeenten. Indien een gemeente over is gegaan van het LO3 naar het BRP stelsel is de
datum overgang gevuld.
7.1.6

Ontwerpbeslissingen
Er is gekozen om het register te publiceren op een topic. Hierdoor worden alle applicaties die
gebruik maken van het afnemerregister voorzien van de â€˜laatste versieâ€™ wanneer deze wordt
opgevraagd.

Operatie BRP

Pagina 54 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

8

Archief services (synchronisatie modus)

Dit hoofdstuk beschrijft de service die beschikbaar is om berichten te archiveren in BRP. Deze
service is alleen beschikbaar indien de BRP Synchronisatie Service in â€˜synchronisatieâ€™-modus
wordt uitgevoerd.

8.1

Verwerk archief verzoek

8.1.1

Service
Verstuur het archief verzoek naar BRP.

8.1.2

Preconditie

â€¢
8.1.3

Postconditie

â€¢
8.1.4

Er is een archief verzoek ontvangen.

Het archiefverzoek is verstuurd naar BRP.

Structuur
Package

nl.bzk.migratiebrp.synchronisatie.runtime

8.1.5

Implementatie

8.1.5.1

Verwerk archief verzoek

Omschrijving
Package waarin de message
handlers staan.

Class

ArchiveringMessageHandler
Verzoek (ArchiveringVerzoekType)
Element
soortBericht
richting
zender
ontvanger
referentienummer
crossReferentienummer
tijdstipVerzending
tijdstipOntvangst
data

Omschrijving
Soort bericht
Richting (ingaand/uitgaand)
Verzendende systeem en partij
Ontvangende partij
Referentienummer
Cross-referentienummer
Tijdstip verzending
Tijdstip ontvangst
Bericht inhoud

Antwoord
Element
geen

Omschrijving
Er wordt geen antwoord verstuurd

Converteer een archiefverzoek naar het benodigde BRP formaat en verstuur dit naar de queue
GbaArchief in de BRP message broker.
Verzoek (GbaArchiveringVerzoek)
Element
Operatie BRP

Omschrijving
Pagina 55 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

soortBericht
richting
zendendePartijCode
zendendeSysteem
ontvangendePartijCode
referentienummer
crossReferentienummer
tijdstipVerzending
tijdstipOntvangst
data

8.1.6

Soort bericht
Richting (ingaand/uitgaand)
Verzendende partij
Verzendende systeem
Ontvangende partij
Referentienummer
Cross-referentienummer
Tijdstip verzending
Tijdstip ontvangst
Bericht inhoud

Ontwerpbeslissingen
Voor deze service zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 56 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

9

Bijlage A: Beslissingen persisteren persoonslijst

Code

Omschrijving

A1
A2
B1 (*)
B2 (*)
B3 (*)
C1

Verwerken als initiÃ«le vulling.
Verwerken als synchronisatie.
Bericht validatie: bericht kan niet geparsed worden
Bericht validatie: bericht voldoet niet aan syntactische controles
Bericht validatie: bericht voldoet niet aan inhoudelijke controles
Groep 80 (Synchroniciteit) in categorie 07 (Inschrijving) aanvullen met default
waarden
Conversie: persoonslijst voldoet niet aan baseline 1 controles
Conversie: Persoonslijst kan niet geconverteerd worden naar BRP structuur
InitiÃ«le vulling: persoonslijst gevonden in BRP o.b.v. actueel a-nummer
InitiÃ«le vulling: Persoonslijst toevoegen
Synchronisatie: verwerken als beheerderskeuze: opnemen als nieuwe persoonslijst
Synchronisatie: verwerken als beheerderskeuze: vervang persoonslijst
Synchronisatie: persoonslijst vervangen (gezaghebbend bericht)
Synchronisatie: verwerken als reguliere synchronisatie
Beheerderskeuze nieuw: persoonslijst gevonden in BRP o.b.v. actueel a-nummer
Beheerderskeuze nieuw: persoonslijst toevoegen
Beheerderskeuze vervangen: persoonslijst vervangen
Beheerderskeuze afkeuren: bericht afkeuren
Beheerderskeuze negeren: bericht negeren
Beheerderskeuze: onduidelijk
Beheerderskeuze vervangen: persoonslijst niet gevonden in BRP o.b.v. actueel anummer
Beheerderskeuze vervangen: persoonslijst vervangen
Reguliere synchronisatie: reguliere wijziging door gemeente van bijhouding
Reguliere synchronisatie: reguliere wijziging door verhuizing of gemeentelijke
herindeling
Reguliere synchronisatie: a-nummer wijziging door gemeente van bijhouding
Reguliere synchronisatie: persoonslijst toevoegen
Reguliere synchronisatie: de aangeboden persoonslijst is ouder
Reguliere synchronisatie: de aangeboden persoonslijst bevat blokkeringsinformatie
Reguliere synchronisatie: de persoonslijsten zijn gelijk
Reguliere synchronisatie: onduidelijk
Reguliere synchronisatie: emigratie
Reguliere synchronisatie: wijzigingen op persoonslijst overleden persoon

D1 (*)
D2 (*)
E1 (*)
E2 (*)
F1
F2
F3 (*)
F4
G1 (*)
G2 (*)
G3 (*)
G4 (*)
G5 (*)
G6
H1 (*)
H2 (*)
I1 (*)
I2 (*)
I3 (*)
I4 (*)
I5 (*)
I6 (*)
I7 (*)
I8 (*)
I9 (*)
I10 (*)

Deze code kan als â€˜eind statusâ€™ worden weergegeven in de melding van het synchronisatie
antwoord.
(*)

Operatie BRP

Pagina 57 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

10

Bijlage B: JMX interface

Ten behoeve van externe toegang is een JMX interface beschikbaar waarmee enkele handelingen
uitgevoerd kunnen worden.

10.1

Synchronisatie
nl.bzk.migratiebrp.synchronisatie:name=SYNCHRONISATIE
Operatie

Parameters

Omschrijving

afsluiten
isGestart

-

isSyncGestart

-

startSync

-

stopSync

-

getAantalSyncVerwerkers

-

setAantalSyncVerwerkers

aantal (int)

isArchiveringGestart

-

startArchivering

-

stopArchivering

-

getAantalArchiveringVerwerkers

-

setAantalArchiveringVerwerkers

aantal (int)

isGemeenteRegisterGestart

-

startGemeenteRegister

-

stopGemeenteRegister

-

isAutorisatieRegisterGestart

-

startAutorisatieeRegister

-

stopAutorisatieRegister

-

isAfnemersindicatiesGestart

-

Applicatie afsluiten.
Geeft aan of de applicatie is
gestart
Geeft aan of synchronisatie
verzoeken worden verwerkt
Start verwerken van
synchronisatie verzoeken
Stop verwerken van
synchronisatie verzoeken
Geef het maximum aantal
verwerkers voor
synchronisatie verzoeken
Zet het maximum aantal
verwerkers voor
synchronisatie verzoeken
Geeft aan of archief verzoeken
worden verwerkt
Start verwerken van archief
verzoeken
Stop verwerken van archief
verzoeken
Geef het maximum aantal
verwerkers voor archief
verzoeken
Zet het maximum aantal
verwerkers voor archief
verzoeken
Geeft aan of gemeente
register verzoeken worden
verwerkt
Start verwerken van gemeente
register verzoeken
Stop verwerken van gemeente
register verzoeken
Geeft aan of autorisatie
register verzoeken worden
verwerkt
Start verwerken van
autorisatie register verzoeken
Stop verwerken van
autorisatie register verzoeken
Geeft aan of
afnemersindicaties antwoorden
worden verwerkt

Operatie BRP

Pagina 58 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

startAfnemersindicaties

-

stopAfnemersindicaties

-

getAantalAfnemersindicatiesVerwerkers

-

setAantalAfnemersindicatiesVerwerkers

aantal (int)

isToevalligeGebeurtenissenGestart

-

startToevalligeGebeurtenissen

-

stopToevalligeGebeurtenissen

-

getAantalToevalligeGebeurtenissenVerwerkers

-

setAantalToevalligeGebeurtenissenVerwerkers

aantal (int)

isLeveringenGestart

-

startLeveringen

-

stopLeveringen
getAantalLeveringenVerwerkers

-

setAantalLeveringenVerwerkers

aantal (int)

Start verwerken van
afnemersindicaties antwoorden
Stop verwerken van
afnemersindicaties antwoorden
Geef het maximum aantal
verwerkers voor
afnemersindicaties antwoorden
Zet het maximum aantal
verwerkers voor
afnemersindicaties antwoorden
Geeft aan of toevallige
gebeurtenissen antwoorden
worden verwerkt
Start verwerken van toevallige
gebeurtenissen antwoorden
Stop verwerken van toevallige
gebeurtenissen antwoorden
Geef het maximum aantal
verwerkers voor toevallige
gebeurtenissen antwoorden
Zet het maximum aantal
verwerkers voor toevallige
gebeurtenissen antwoorden
Geeft aan of leveringen
worden verwerkt
Start verwerken van
leveringen
Stop verwerken van leveringen
Geef het maximum aantal
verwerkers voor leveringen
Zet het maximum aantal
verwerkers voor leveringen

Class
Jmx
JmxImpl

10.2

Caching
Er wordt voor caching van gegevens uit de database gebruik gemaakt van EH Cache. Deze
caching is ook via JMX te benaderen (om bijvoorbeeld de caches te legen).
net.sf.ehcache:type=CacheManager,name=ConversieTabelCacheManager
Operatie

Parameters

Omschrijving

clearAll

-

Alle caches legen

Operatie BRP

Pagina 59 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

11

Bijlage C: Configuratie

De volgende instellingen zijn beschikbaar in het configuratie bestand â€˜synchronisatie.propertiesâ€™:
Instelling

Standaard waarde

Omschrijving

sync.database.driver

org.postgresql.xa.PGXADataSo
urce

XA driver voor BRP database

sync.database.host

localhost

Host voor BRP database

sync.database.port

5432

Poort voor BRP database

sync.database.name

brp

BRP database naam

sync.database.username

postgres

Gebruikersnaam voor BRP
database

sync.database.password

postgres

Wachtwoord voor BRP
database

sync.database.minpool

3

Minimum database pool

sync.database.maxpool

20

Maximum database pool

atomikos.max.timeout

300000

Maximale transactie timeout
(in milliseconden)

atomikos.default.timeout

300000

Standaard transactie timeout
(in milliseconden)

atomikos.max.actives

50

Maximaal aantal transacties

atomikos.unique.name

synchronisatie-runtime

Unieke naam voor deze
instantie

atomikos.base.dir

work/atomikos

Werk map voor Atomikos

sync.queue.url

tcp://localhost:61616

URL om verbinding te maken
met de Routering module

sync.queue.minpool

3

Minimum queue pool

sync.queue.maxpool

20

Maximum queue pool

sync.queue.verzoek

sync.verzoek

Naam voor de sync.verzoek
queue

sync.queue.antwoord

sync.antwoord

Naam voor de sync.antwoord
queue

sync.queue.archivering

archivering

Naam voor de archivering
queue

sync.queue.levering

levering

Naam voor de levering queue

sync.topic.gemeente

gemeente.register

Naam voor het
gemeenteregister topic

sync.queue.gemeente

gemeente.verzoek

Naam voor de
gemeenteregister verzoek
queue

Operatie BRP

Pagina 60 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Instelling

Standaard waarde

Omschrijving

sync.topic.autorisatie

autorisatie.register

Naam voor het
autorisatieregister topic

sync.queue.autorisatie

autorisatie.verzoek

Naam voor de
autorisatieregister verzoek
queue

brp.queue.url

tcp://localhost:61616

URL om verbinding te maken
met de BRP message broker

brp.queue.minpool

3

Minimum queue pool

brp.queue.maxpool

20

Maximum queue pool

brp.queue.archief

GbaArchief

Naam van de GbaArchief
queue

brp.queue.afnemersindicaties

GbaAfnemerindicaties

Naam van de
GbaAfnemerindicaties queue

brp.queue.afnemersindicaties.ant
woord

GbaAfnemerindicatiesAntwoord
en

Naam van de
GbaAfnemersindicatiesAntwoor
den queue

brp.queue.leveringen

GbaLeveringen

Naam van de GbaLeveringen
queue

brp.queue.toevalligegebeurteniss
en

GbaToevalligeGebeurtenissen

Naam van de
GbaToevalligeGebeurtenissen
queue

brp.queue.toevalligegebeurteniss
en.antwoord

GbaToevalligeGebeurtenissenA
ntwoorden

Naam van de
GbaToevalligeGebeurtenissenA
ntwoorden queue

sync.autostart

true

Automatisch starten van het
verwerken van synchronisatie
verzoeken

archivering.autostart

true

Automatisch starten van het
verwerken van archief
verzoeken

afnemersindicaties.autostart

true

Automatisch starten van het
verwerken van
afnemerindicaties antwoorden

toevalliggebeurtenissen.autostar
t

true

Automatisch starten van het
verwerken van toevallige
gebeurtenissen antwoord

leveringen.autostart

true

Automatisch starten van het
verwerken van leveringen

register.gemeente.autostart

true

Automatisch starten van het
verwerken van
gemeenteregister verzoeken

Operatie BRP

Pagina 61 van 62

Definitief | 2.13 | Technisch ontwerp BRP Synchronisatie Service | 30-06-2017

Instelling

Standaard waarde

Omschrijving

register.autorisatie.autostart

true

Automatisch starten van het
verwerken van
autorisatieregister verzoeken

synchronisatie.jmx.serialize.por
t

3481

De port voor JMX verkeer

Let op: de initiÃ«le vulling modus gebruikt een ander configuratie bestand
(â€˜initielevulling.propertiesâ€™) waar de volgende instellingen in beschikbaar zijn:
Instelling

Standaard waarde

Omschrijving

sync.database.driver

org.postgresql.xa.PGXADataSource

XA driver voor BRP
database

sync.database.host

localhost

Host voor BRP database

sync.database.port

5432

Poort voor BRP database

sync.database.name

brp

BRP database naam

sync.database.username

postgres

Gebruikersnaam voor BRP
database

sync.database.password

postgres

Wachtwoord voor BRP
database

sync.database.minpool

3

Minimum database pool

sync.database.maxpool

20

Maximum database pool

atomikos.max.timeout

300000

Maximale transactie
timeout (in milliseconden)

atomikos.default.timeout

300000

Standaard transactie
timeout (in milliseconden)

atomikos.max.actives

50

Maximaal aantal
transacties

atomikos.unique.name

synchronisatie-runtime

Unieke naam voor deze
instantie

atomikos.base.dir

work/atomikos

Werk map voor Atomikos

hornetq.queue.host

127.0.0.1

HornetQ host

hornetq.queue.port

5445

HornetQ poort

sync.queue.verzoek

sync.verzoek

Naam voor de
sync.verzoek queue

sync.queue.antwoord

sync.antwoord

Naam voor de
sync.antwoord queue

jms.maxConcurrentConsumers

1

Maximum aantal
verwerkers voor
synchronisatie verzoeken

synchronisatie.jmx.serialize.port

3481

De port voor JMX verkeer

Operatie BRP

Pagina 62 van 62

