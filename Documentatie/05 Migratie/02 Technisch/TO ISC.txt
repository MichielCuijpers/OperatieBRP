Technisch ontwerp ISC

2.8

Datum
Status

16-03-2017
Definitief

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Inhoudsopgave

1

INLEIDING .............................................................................................................................................8
1.1
1.2
1.3

2

BEKNOPTE OMSCHRIJVING ...................................................................................................................8
REFERENTIES ........................................................................................................................................8
LEESWIJZER ........................................................................................................................................10

CONTEXT ...............................................................................................................................................11
2.1 CONTEXT .............................................................................................................................................11
2.1.1 Maven Structuur ....................................................................................................................12
2.2 ONTWERPBESLISSINGEN ....................................................................................................................13
2.2.1 Ontvangen en versturen berichten .................................................................................13
2.2.2 Processen ..................................................................................................................................16
2.2.3 Algemene foutafhandeling .................................................................................................20
2.2.4 Versturen herhaalbericht ....................................................................................................23
2.3 TOOLING .............................................................................................................................................24
2.3.1 Spring container .....................................................................................................................24
2.3.2 JBPM ...........................................................................................................................................24
2.3.3 Hibernate ..................................................................................................................................24
2.3.4 Quartz ........................................................................................................................................24
2.3.5 Atomikos ...................................................................................................................................25

3

PROCESSEN .........................................................................................................................................26
3.1 CONTEXT .............................................................................................................................................26
3.2 UC202 – VERWERKEN SYNCHRONISATIE-CYCLUS .........................................................................28
3.2.1 Proces .........................................................................................................................................28
3.2.2 Preconditie ................................................................................................................................29
3.2.3 Postconditie ..............................................................................................................................29
3.2.4 Structuur ...................................................................................................................................29
3.2.5 Implementatie.........................................................................................................................30
3.2.6 Ontwerpbeslissingen binnen UC202 ...............................................................................31
3.3 UC301 – VERWERK VERVOLGINSCHRIJVING VAN BRP NAAR LO3 ..............................................32
3.3.1 Proces .........................................................................................................................................32
3.3.2 Preconditie ................................................................................................................................32
3.3.3 Postconditie ..............................................................................................................................32
3.3.4 Structuur ...................................................................................................................................32
3.3.5 Implementatie.........................................................................................................................32
3.3.6 Ontwerpbeslissingen binnen UC301 ...............................................................................32
3.4 UC302 – VERWERK VERVOLGINSCHRIJVING VAN LO3 NAAR BRP INGEZETENEN ......................33
3.4.1 Proces .........................................................................................................................................33
3.4.2 Preconditie ................................................................................................................................33
3.4.3 Postconditie ..............................................................................................................................33
3.4.4 Structuur ...................................................................................................................................33
3.4.5 Implementatie.........................................................................................................................33
3.4.6 Ontwerpbeslissingen binnen UC302 ...............................................................................33
3.5 UC303 – VERWERK VERVOLGINSCHRIJVING VAN BRP NAAR LO3 RNI ......................................34
3.5.1 Proces .........................................................................................................................................34
3.5.2 Preconditie ................................................................................................................................34
3.5.3 Postconditie ..............................................................................................................................34
3.5.4 Structuur ...................................................................................................................................34
3.5.5 Implementatie.........................................................................................................................34
3.5.6 Ontwerpbeslissingen binnen UC303 ...............................................................................34
3.6 MV305 – STUUR VERWIJSGEGEVENS NAAR LO3 ...........................................................................35
3.6.1 Proces .........................................................................................................................................35
3.6.2 Preconditie ................................................................................................................................35

Operatie BRP

Pagina 2 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.6.3 Postconditie ..............................................................................................................................35
3.6.4 Structuur ...................................................................................................................................35
3.6.5 Implementatie.........................................................................................................................35
3.6.6 Ontwerpbeslissingen binnen UC305 ...............................................................................35
3.7 UC306 – STUUR TOEVALLIGE GEBOORTE IN BRP DOOR ..............................................................36
3.7.1 Proces .........................................................................................................................................36
3.7.2 Preconditie ................................................................................................................................36
3.7.3 Postconditie ..............................................................................................................................36
3.7.4 Structuur ...................................................................................................................................36
3.7.5 Implementatie.........................................................................................................................36
3.7.6 Ontwerpbeslissingen binnen UC306 ...............................................................................36
3.8 UC307 – STUUR TOEVALLIGE GEBOORTE IN LO3 GBA DOOR .....................................................37
3.8.1 Proces .........................................................................................................................................37
3.8.2 Preconditie ................................................................................................................................37
3.8.3 Postconditie ..............................................................................................................................37
3.8.4 Structuur ...................................................................................................................................37
3.8.5 Implementatie.........................................................................................................................37
3.8.6 Ontwerpbeslissingen binnen UC307 ...............................................................................37
3.9 UC308 – STUUR TOEVALLIGE GEBEURTENIS IN BRP DOOR .........................................................38
3.9.1 Proces .........................................................................................................................................38
3.9.2 Preconditie ................................................................................................................................38
3.9.3 Postconditie ..............................................................................................................................38
3.9.4 Structuur ...................................................................................................................................38
3.9.5 Implementatie.........................................................................................................................38
3.9.6 Ontwerpbeslissingen binnen UC308 ...............................................................................38
3.10 UC309 – STUUR TOEVALLIGE GEBEURTENIS IN LO3 GBA DOOR ............................................39
3.10.1 Proces .....................................................................................................................................39
3.10.2 Preconditie ............................................................................................................................40
3.10.3 Postconditie ..........................................................................................................................40
3.10.4 Structuur ...............................................................................................................................40
3.10.5 Implementatie .....................................................................................................................40
3.10.6 Ontwerpbeslissingen binnen UC309 ...........................................................................42
3.11 UC310 – VERWERK WIJZIGING A-NUMMER IN LO3 ..................................................................43
3.11.1 Proces .....................................................................................................................................43
3.11.2 Preconditie ............................................................................................................................43
3.11.3 Postconditie ..........................................................................................................................43
3.11.4 Structuur ...............................................................................................................................43
3.11.5 Implementatie .....................................................................................................................43
3.11.6 Ontwerpbeslissingen binnen UC310 ...........................................................................43
3.12 UC311 – VERWERK WIJZIGING A-NUMMER IN BRP ..................................................................44
3.12.1 Proces .....................................................................................................................................44
3.12.2 Preconditie ............................................................................................................................44
3.12.3 Postconditie ..........................................................................................................................44
3.12.4 Structuur ...............................................................................................................................44
3.12.5 Implementatie .....................................................................................................................44
3.12.6 Ontwerpbeslissingen binnen UC311 ...........................................................................44
3.13 UC312 – OPNEMEN/WIJZIGEN VERBLIJFSTITEL VANUIT BRP ...................................................45
3.13.1 Proces .....................................................................................................................................45
3.13.2 Preconditie ............................................................................................................................45
3.13.3 Postconditie ..........................................................................................................................45
3.13.4 Structuur ...............................................................................................................................45
3.13.5 Implementatie .....................................................................................................................45
3.13.6 Ontwerpbeslissingen binnen UC312 ...........................................................................45
3.14 UC405 – DOORSTUREN TMV BERICHT .......................................................................................46
3.14.1 Proces .....................................................................................................................................46
3.14.2 Preconditie ............................................................................................................................46
3.14.3 Postconditie ..........................................................................................................................46

Operatie BRP

Pagina 3 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.14.4 Structuur ...............................................................................................................................46
3.14.5 Implementatie .....................................................................................................................46
3.14.6 Ontwerpbeslissingen binnen UC405 ...........................................................................46
3.15 UC501 – STUUR VRIJ BERICHT UIT LO3 DOOR..........................................................................47
3.15.1 Proces .....................................................................................................................................47
3.15.2 Preconditie ............................................................................................................................47
3.15.3 Postconditie ..........................................................................................................................47
3.15.4 Structuur ...............................................................................................................................47
3.15.5 Implementatie GBA gemeente/afnemer naar BRP gemeente/afnemer ........48
3.15.6 Implementatie BRP gemeente/afnemer naar GBA gemeente/afnemer ........50
3.15.7 Ontwerpbeslissingen binnen UC501 ...........................................................................51
3.16 UC502 – STUUR VRIJ BERICHT UIT BRP DOOR..........................................................................52
3.16.1 Proces .....................................................................................................................................52
3.16.2 Preconditie ............................................................................................................................52
3.16.3 Postconditie ..........................................................................................................................52
3.16.4 Structuur ...............................................................................................................................52
3.16.5 Implementatie .....................................................................................................................52
3.16.6 Ontwerpbeslissingen binnen UC502 ...........................................................................52
3.17 UC801 – BEHEREN PROCESSEN ...................................................................................................53
3.17.1 Proces .....................................................................................................................................53
3.17.2 Preconditie ............................................................................................................................53
3.17.3 Postconditie ..........................................................................................................................53
3.17.4 Structuur ...............................................................................................................................53
3.17.5 Implementatie .....................................................................................................................53
3.17.6 Ontwerpbeslissingen binnen UC801 ...........................................................................56
3.18 UC802 – OPVRAGEN RAPPORTAGES ............................................................................................58
3.18.1 Proces .....................................................................................................................................58
3.18.2 Preconditie ............................................................................................................................58
3.18.3 Postconditie ..........................................................................................................................58
3.18.4 Structuur ...............................................................................................................................58
3.18.5 Implementatie .....................................................................................................................58
3.18.6 Rapportages .........................................................................................................................59
3.18.7 Ontwerpbeslissingen binnen UC802 ...........................................................................62
3.19 UC803 – BEHEREN VAN UITWISSELINGSCONFIGURATIES .........................................................63
3.19.1 Proces .....................................................................................................................................63
3.19.2 Preconditie ............................................................................................................................63
3.19.3 Postconditie ..........................................................................................................................63
3.19.4 Structuur ...............................................................................................................................63
3.19.5 Implementatie .....................................................................................................................63
3.19.6 Ontwerpbeslissingen binnen UC803 ...........................................................................63
3.20 UC806 – BEHEER VERTAALTABELLEN LO3 EN BRP CODERINGEN............................................64
3.20.1 Proces .....................................................................................................................................64
3.20.2 Preconditie ............................................................................................................................64
3.20.3 Postconditie ..........................................................................................................................64
3.20.4 Structuur ...............................................................................................................................64
3.20.5 Implementatie .....................................................................................................................64
3.20.6 Ontwerpbeslissingen binnen UC806 ...........................................................................64
3.21 UC807 – OPSCHONEN PROCESINFORMATIE................................................................................65
3.21.1 Proces .....................................................................................................................................65
3.21.2 Preconditie ............................................................................................................................65
3.21.3 Postconditie ..........................................................................................................................65
3.21.4 Structuur ...............................................................................................................................65
3.21.5 Implementatie .....................................................................................................................65
3.21.6 Ontwerpbeslissingen binnen UC807 ...........................................................................67
3.22 UC808 – BEOORDELEN ONDUIDELIJKE SYNCHRONISATIE .........................................................68
3.22.1 Proces .....................................................................................................................................68
3.22.2 Preconditie ............................................................................................................................68

Operatie BRP

Pagina 4 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.22.3 Postconditie ..........................................................................................................................68
3.22.4 Structuur ...............................................................................................................................68
3.22.5 Implementatie .....................................................................................................................69
3.22.6 Ontwerpbeslissingen binnen UC808 ...........................................................................69
3.23 UC811 – VERWERKEN SYNCHRONISATIEVRAAG-CYCLUS ..........................................................70
3.23.1 Proces .....................................................................................................................................70
3.23.2 Preconditie ............................................................................................................................71
3.23.3 Postconditie ..........................................................................................................................71
3.23.4 Structuur ...............................................................................................................................71
3.23.5 Implementatie .....................................................................................................................72
3.23.6 Ontwerpbeslissingen binnen UC811 ...........................................................................74
3.24 UC812 – VERWERKEN BULK SYNCHRONISATIEVRAAG-CYCLUS .................................................75
3.24.1 Proces .....................................................................................................................................75
3.24.2 Preconditie ............................................................................................................................75
3.24.3 Postconditie ..........................................................................................................................75
3.24.4 Structuur ...............................................................................................................................75
3.24.5 Implementatie .....................................................................................................................76
3.24.6 Ontwerpbeslissingen binnen UC812 ...........................................................................77
3.25 UC813 – HANDMATIG STARTEN SYNCHRONISATIEVRAAG-CYCLUS ...........................................78
3.25.1 Proces .....................................................................................................................................78
3.25.2 Preconditie ............................................................................................................................78
3.25.3 Postconditie ..........................................................................................................................78
3.25.4 Structuur ...............................................................................................................................78
3.25.5 Implementatie .....................................................................................................................79
3.25.6 Ontwerpbeslissingen binnen UC813 ...........................................................................80
3.26 UC814 – BEHEREN BERICHTEN ....................................................................................................81
3.26.1 Proces .....................................................................................................................................81
3.26.2 Preconditie ............................................................................................................................81
3.26.3 Postconditie ..........................................................................................................................81
3.26.4 Structuur ...............................................................................................................................81
3.26.5 Implementatie .....................................................................................................................82
3.26.6 Ontwerpbeslissingen binnen UC814 ...........................................................................82
3.27 UC815 – BEHEREN TAKEN ............................................................................................................83
3.27.1 Proces .....................................................................................................................................83
3.27.2 Preconditie ............................................................................................................................83
3.27.3 Postconditie ..........................................................................................................................83
3.27.4 Structuur ...............................................................................................................................83
3.27.5 Implementatie .....................................................................................................................83
3.27.6 Ontwerpbeslissingen binnen UC815 ...........................................................................84
3.28 UC1003 – PLAATSEN AFNEMERSINDICATIE ................................................................................85
3.28.1 Proces .....................................................................................................................................85
3.28.2 Preconditie ............................................................................................................................86
3.28.3 Postconditie ..........................................................................................................................86
3.28.4 Structuur ...............................................................................................................................86
3.28.5 Implementatie .....................................................................................................................86
3.28.6 Ontwerpbeslissingen binnen UC1003 (Plaatsen) ...................................................88
3.29 UC1003 – VERWIJDEREN AFNEMERSINDICATIE .........................................................................89
3.29.1 Proces .....................................................................................................................................89
3.29.2 Preconditie ............................................................................................................................89
3.29.3 Postconditie ..........................................................................................................................89
3.29.4 Structuur ...............................................................................................................................90
3.29.5 Implementatie .....................................................................................................................90
3.29.6 Ontwerpbeslissingen binnen UC1003 (Verwijderen) ............................................92
3.30 UC1004 – AD HOC PERSOONSVRAAG .........................................................................................93
3.30.1 Proces .....................................................................................................................................93
3.30.2 Preconditie ............................................................................................................................93
3.30.3 Postconditie ..........................................................................................................................94

Operatie BRP

Pagina 5 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.30.4 Structuur ...............................................................................................................................94
3.30.5 Implementatie .....................................................................................................................94
3.30.6 Ontwerpbeslissingen binnen UC1004 (Ad hoc persoonsvraag) ........................95
3.31 UC1004 – AD HOC ADRESVRAAG ................................................................................................96
3.31.1 Proces .....................................................................................................................................96
3.31.2 Preconditie ............................................................................................................................97
3.31.3 Postconditie ..........................................................................................................................97
3.31.4 Structuur ...............................................................................................................................97
3.31.5 Implementatie .....................................................................................................................97
3.31.6 Ontwerpbeslissingen binnen UC1004 (Ad hoc adresvraag) ...............................98
4

DATAMODEL MIGRATIE ................................................................................................................99
4.1
4.2

JBPM TABELLEN ...................................................................................................................................99
ISC TABELLEN ....................................................................................................................................99

5

OPMERKINGEN ................................................................................................................................100

6

BIJLAGE A: JMX INTERFACE ....................................................................................................101
6.1
6.2
6.3
6.4

7

ISC .....................................................................................................................................................101
OPSCHONEN ......................................................................................................................................102
TELLINGEN ........................................................................................................................................102
REGISTER ..........................................................................................................................................102

BIJLAGE B: CONFIGURATIE .....................................................................................................104

Operatie BRP

Pagina 6 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Versiehistorie
Datum

Versie

Omschrijving

Auteur

10-04-2014

0.1

Operatie BRP

15-04-2014

1.0

22-04-2014

1.1

28-04-2014
13-05-2014
27-05-2014

1.2
1.3
1.4

10-06-2014

1.5

11-06-2014
22-07-2014

1.6
1.7

04-09-2014
28-07-2015
28-09-2015
05-10-2015
09-12-2015
22-01-2016
07-04-2016
14-06-2016

1.8
2.0
2.1
2.2
2.3
2.4
2.5
2.6

23-08-2016

2.7

16-03-2017

2.8

13-04-2017

2.9

Eerste opzet technisch ontwerp ISC
gebaseerd op de processen voor stap 2.2
Aanpassingen n.a.v. review. Gereed voor
stap 2.2
Aanpassingen ontwerpbeslissing uc801 en
uc814 m.b.t. filteren.
Aanpassingen n.a.v. cross-team review.
Aanpassingen voor opschonen verwerkt
Remote command voor losse beheer console
toegevoegd.
Aanpassingen aan remote command en
versienummers nagelopen.
Aanpassing module- en packagenamen
Toevoegen onderhoud afnemersindicaties
(UC1003)
Definitief gemaakt voor release 2.2
Versie aangemaakt voor release 3.1
Referenties bijgewerkt
Verwerken refactor ISC
Toevoegen UC309
Nalopen tbv release; bijwerken kleine fouten
Verwerken refactor UC309
Verwerken refactor beslisboom
UC202/UC811
Verwerken automatisch verwerken
beheerdertaken; verwerken status en
delivery report
Beschrijving UC1004 Ad hoc persoonsvraag
en Ad hoc adresvraag opgenomen
Afbeelding proces uc202 aangepast i.v.m.
vervallen pad en uc501 opgenomen

Operatie BRP
Operatie BRP
Operatie BRP
Operatie BRP
Operatie BRP
Operatie BRP
Operatie BRP
Operatie BRP
Operatie
Operatie
Operatie
Operatie
Operatie
Operatie
Operatie
Operatie

BRP
BRP
BRP
BRP
BRP
BRP
BRP
BRP

Operatie BRP

Operatie BRP
Operatie BRP

Reviewhistorie
Datum

Versie

Omschrijving

Reviewers

15-04-2014

0.1

Inhoudelijke review

Operatie BRP

25-04-2014

1.1

Inhoudelijke review cross-team

Operatie BRP

22-07-2014

1.7

Inhoudelijke review onderhoud
afnemersindicaties (uc1003)

Operatie BRP

06-10-2015

2.2

Inhoudelijke review

Operatie BRP

09-12-2015

2.3

Inhoudelijke review (uc309)

Operatie BRP

Operatie BRP

Pagina 7 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

1

Inleiding

1.1

Beknopte omschrijving
Dit document beschrijft het technisch ontwerp van ISC (InterStelsel Communicatie) en de
algemene procesverwerking die geldt voor alle use cases die zijn gerealiseerd als JBPM proces.

1.2

Referenties
#
[LO]

Document
Logisch Ontwerp

Organisatie
Agentschap
BPR

[SAD]

Software Architecture Document
Migratiesoftware BRP

OperatieBRP

[JBPM]

http://www.jbpm.org/

JBoss

Versie
3.9

Datum
31-01-2015

3.2.14

Let op: de gebruikte versie van JBPM is
3.2.14
[VOISC]

Technisch ontwerp VOISC

OperatieBRP

[SYNC]

Technisch ontwerp BRP Synchronisatie
service

OperatieBRP

[MVAANV]

MV Aanvullende specificaties ISC

OperatieBRP

[MVUC105]

MV UC105 Vul configuratie mailboxen initieel

OperatieBRP

[MVUC202]

MV UC202 Verwerken synchronisatie-cyclus

OperatieBRP

[MVUC220]

MV UC220 Bepalen verwerking persoonslijst

OperatieBRP

[MVUC301]

MV UC301 Verwerk vervolginschrijving van
BRP naar LO3 GBA

OperatieBRP

[MVUC302]

MV UC302 Verwerk vervolginschrijving van
LO3 naar BRP ingezetenen

OperatieBRP

[MVUC303]

MV UC303 Verwerk vervolginschrijving van
BRP naar LO3 RNI

OperatieBRP

[MVUC305]

MV UC305 Stuur verwijsgevens naar LO3

OperatieBRP

[MVUC306]

MV UC306 Stuur toevallige geboorte in BRP
door

OperatieBRP

[MVUC307]

MV UC307 Stuur toevallige geboorte in LO3
GBA door

OperatieBRP

[MVUC308]

MV UC308 Stuur toevallige gebeurtenis in
BRP door

OperatieBRP

[MVUC309]

MV UC309 Stuur toevallige gebeurtenis in
LO3 GBA door

OperatieBRP

[MV-

MV UC310 Verwerk wijziging A-nummer in

OperatieBRP

Operatie BRP

Pagina 8 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

#
UC310]

Document
LO3

Organisatie

[MVUC311]

MV UC311 Verwerk wijziging A-nummer in
BRP

OperatieBRP

[MVUC312]

MV UC312 Opnemen/wijzigen verblijfstitel
vanuit BRP stelsel

OperatieBRP

[MVUC405]

MV UC405 Doorsturen TMV bericht

OperatieBRP

[MVUC501]

MV UC501 Stuur vrij bericht uit LO3 door

OperatieBRP

[MVUC502]

MV UC502 Stuur vrij bericht uit BRP door

OperatieBRP

[MVUC801]

MV UC801 Beheren processen

OperatieBRP

[MVUC802]

MV UC802 Opvragen rapportages

OperatieBRP

[MVUC806]

MV UC806 Beheer vertaaltabellen LO3 en
BRP coderingen

OperatieBRP

[MVUC807]

MV UC807 Opschonen procesinformatie

OperatieBRP

[MVUC808]

MV UC808 Beoordelen onduidelijke
synchronisatie

OperatieBRP

[MVUC811]

MV UC811 Verwerken synchronisatievraagcyclus

OperatieBRP

[MVUC812]

MV UC812 Verwerken bulk
synchronisatievraag-cyclus

OperatieBRP

[MVUC813]

MV UC813 Handmatig starten
synchronisatievraag-cyclus

OperatieBRP

[MVUC814]

MV UC814 Beheren berichten

OperatieBRP

[MVUC815]

MV UC815 Beheren taken

OperatieBRP

[MVUC1003]

MV UC1003 Verwerken handmatig plaatsen
en verwijderen afnemersindicatie

OperatieBRP

[MVUC1004]

MV UC1003 Verwerken handmatig plaatsen
en verwijderen afnemersindicatie

OperatieBRP

Versie

Datum

Nota: versienummers van ‘interne’ documenten worden niet opgenomen. Deze dienen consistent
te zijn.

Operatie BRP

Pagina 9 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

1.3

Leeswijzer
Dit document is een verzameling van alle use case binnen ISC. De opzet is dusdanig dat eerst de
context, overkoepelende en algemene zaken worden besproken (hoofdstuk 2). Vervolgens wordt
er stilgestaan bij alle implementaties van de processen die in ISC voorkomen (hoofdstuk 3). Voor
het bespreken van de processen is gekozen om de opzet per proces hetzelfde te houden. Dit
houdt in dat er per proces gesproken wordt over:

➢
➢
➢
➢
➢

Het proces; een beschrijving van wat de use case/proces inhoudt.
Preconditie; indien van toepassing de geldende preconditie.
Postconditie; indien van toepassing de geldende postconditie.
De structuur; een beschrijving van het package/de packages waar de implementatie staat.
De implementatie; een beschrijving van belangrijke implementatie specifieke zaken en
klassen.
➢ Ontwerpbeslissingen; een beschrijving van de ontwerpbeslissingen die ten grondslag
liggen van de gekozen implementatie.
Het datamodel van ISC wordt in hoofdstuk 4 beschreven. Eventueel nog uit te zoeken punten of
onduidelijkheden zullen worden besproken het laatste hoofdstuk (hoofdstuk 5).

Operatie BRP

Pagina 10 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2

Context

2.1

Context
In [SAD] is aangegeven in welke omgeving ISC opereert. In de hier onderstaande afbeelding is
ter illustratie de omgeving weergegeven; in paragraaf 4.1.8 View-deel 6: Interstelsel
Communicatie (ISC) [SAD] kan meer detailinformatie hieromtrent worden gevonden.

Dit document richt zich alleen op de zaken die binnen ISC vallen met uitzondering van de
raakvlakken met [VOISC] en [Sync] waarvoor het nodig is dat deze beschreven worden.

Operatie BRP

Pagina 11 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.1.1

Maven Structuur
Het onderstaande overzicht toont de Maven structuur en geeft aan waar elk project voor wordt
gebruikt.
Project
migr-bericht

Subproject

Beschrijving

migr-bericht-model

Hierin staan de berichten die gebruikt worden
binnen ISC.

migr-isc-console-mig4jsf
migr-isc-console-webapp
migr-isc-database
migr-isc-jbpm-algemeen

Actionhandlers en listeners voor binnen de console.
De console voor monitoring en controle van JBoss.
Database scripts
Jbpm project waarin de generieke foutafhandeling
en uc808 zijn opgenomen.
Project waarin de remote commands staan voor
het uitvoeren van acties op processen en taken in
de Jbpm console.
Project voor [MV-UC202]
Project voor [MV-UC301]
Project voor [MV-UC309]
Project voor [MV-UC311]
Project voor [MV-UC501]
Project voor [MV-UC811]
Project voor [MV-UC812]
Project voor [MV-UC1003]
Functionaliteit voor het opschonen van processen
en berichten
Project waarin de JMS-queues gedefinieerd en
geconfigureerd worden.
Functionaliteit voor het tellen van berichten en
processen.

migr-isc

migr-isc-jbpm-command

migr-isc-jbpm-uc202
migr-isc-jbpm-uc301
migr-isc-jbpm-uc309
migr-isc-jbpm-uc311
migr-isc-jbpm-uc501
migr-isc-jbpm-uc811
migr-isc-jbpm-uc812
migr-isc-jbpm-uc1003
migr-isc-opschoner
migr-isc-runtime
migr-isc-telling

Operatie BRP

Pagina 12 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2

Ontwerpbeslissingen
Voor ISC zijn op basis van [MV-AANV] en de beschikbare use cases een aantal
ontwerpbeslissingen genomen welke hieronder in detail worden beschreven. Dit zijn:

Ontvangen en versturen berichten
➢ Processen
➢ Algemene foutafhandeling
➢

2.2.1

Ontvangen en versturen berichten
Het ISC systeem kan, gezien vanuit de techniek, berichten ontvangen van en versturen aan een
aantal externe bronnen:
➢
➢
➢
➢
➢
➢

VOISC (gebruikt door [VOISC] voor LO3 mailbox berichten)
BRP Synchronisatie Service (gebruikt door [SYNC])
Levering (gebruikt door [BRP] voor LO3 leveringsberichten)
Afnemerregister (gebruikt door [Sync])
Gemeente (gebruikt door [Sync])
Archivering (gebruikt door [Sync])

De communicatie verloopt de JMS queues die beschikbaar worden gemaakt door [Routering]:
Queue
sync.verzoek

Doel
Berichten van ISC naar de Synchronisatie Service

sync.antwoord

Berichten van de Synchronisatie Service naar ISC

voisc.ontvangst

Berichten van VOISC naar ISC

voisc.verzenden

Berichten van ISC naar VOISC

levering

Berichten voor Levering (van BRP) naar ISC

partij.verzoek

Verzoeken voor het Partijregister (van ISC of VOISC) naar de
Synchronisatie Service
Publicatie van het Partijregister (voor ISC of VOISC) door de
Synchronisatie Service
Kanaal voor het versturen van vrije berichten van BRP naar GBA

partij.register
notificatie

Het ontvangen en versturen van berichten gaat asynchroon en meerdere berichten kunnen
gelijktijdig verzonden/ontvangen worden.

Operatie BRP

Pagina 13 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.1.1

Ontvangen van berichten
Het ontvangen en verwerken van berichten is geïmplementeerd met de standaard Spring
functionaliteit voor het ontvangen van JMS berichten (spring-jms;
DefaultMessageListenerContainer). Het ontvangen van berichten doorloopt de volgende stappen:
➢
➢
➢
➢
➢
➢
➢
➢
➢

Ontvangen via queue
Audit
Parse
Controleren MSSequenceNumber (enkel voor VOISC berichten)
Verwerken status report (enkel voor VOISC berichten)
Verwerken delivery report (enkel voor VOISC berichten)
Verwerken herhaling (enkel voor VOISC berichten)
Correleren
Verwerk in JBPM proces

Een uitzondering op deze algemene stappen is de verwerking van BRP leveringsberichten.
Vanwege de hoeveelheid berichten (verwacht 1,15 miljoen berichten per dag) is er voor gekozen
om de verwerking (in realiteit enkel doorsturen) niet via een JBPM proces te laten verlopen. Het
ontvangen van een BRP Leveringsbericht doorloopt de volgende stappen:
➢
➢
➢
➢

2.2.1.1.1

Ontvangen via queue
Audit
Verwerk leveringsbericht
Verstuur bericht via VOISC aan LO3 mailbox

Audit

Class

AuditInkomendAction
Het bericht wordt opgeslagen in de MIG_BERICHTEN tabel (zie 4.2 ISC tabellen).

2.2.1.1.2

Parse

Class

ParseBerichtAction
Het bericht wordt syntactisch gevalideerd. Het berichttype wordt opgeslagen bij het bericht.

2.2.1.1.3

Verwerk status report

Class

VerwerkStatusReportAction
Er wordt bepaald of dit bericht een status report is met daarin een non-receipt-notification.
Indien dit het geval is dan wordt het relateerde bericht opnieuw verstuurd.
2.2.1.1.4

Verwerk delivery report

Class

VerwerkDeliveryReportAction

Operatie BRP

Pagina 14 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Er wordt bepaald of dit bericht een delivery report is met daarin een non-delivery-code. Indien
dit het geval is dan wordt het relateerde bericht opnieuw verstuurd.

2.2.1.1.5

Verwerk herhaling

Class

VerwerkHerhalingAction
Er wordt bepaald of dit bericht reeds is verwerkt. Indien het bericht reeds is verwerkt wordt dit
geregistreerd, wordt eventueel het reeds verstuurde antwoord opnieuw verstuurd en wordt de
verdere afhandeling afgebroken.

2.2.1.1.6

Correleren

Class

CorrelerenAction
Er wordt bepaald of dit bericht behoort tot een lopend proces (indien het een antwoord is op een
door het systeem verzonden verzoek; of wel indien het antwoord een correlatie-id bevat). Dit
wordt bij het bericht geregistreerd.

2.2.1.1.7

Verwerken in JBPM

Class

VerwerkInProcesAction
Indien het bericht behoort tot een lopend JBPM proces, dan wordt gecontroleerd of het proces op
dat bericht wacht. Zo ja (dit geldt ook voor berichten die syntactisch niet valide zijn), dan wordt
het bericht aan het JBPM proces gekoppeld en wordt het proces gesignaleerd om verder te gaan.
Zo nee, dan wordt een nieuw foutafhandelingsproces gestart. Indien het bericht niet behoort tot
een lopend proces, dan wordt bepaald of dit proces een cyclus mag starten. Zo ja, dan wordt een
nieuw JBPM proces gestart, het bericht wordt gekoppeld aan het proces en het proces wordt
gesignaleerd om te starten. Zo nee, dan wordt een nieuw foutafhandelingsproces gestart.
2.2.1.1.8

Verwerk leveringsbericht

Class

VerwerkLeveringsberichtAction
Binnen deze action worden de volgende handelingen na elkaar uitgevoerd:

➢ bepalen wat de verzendende partij is; dit is de mailbox van waaruit het leveringsbericht
wordt verstuurd
➢ virtueel proces aangemaakt; een virtueel proces wordt gebruikt om eventuele reacties op
het leveringsbericht, welke kunnen binnenkomen, te correleren en hiervoor een
foutafhandelingsproces te starten.
➢ opslaan van het leveringsbericht
➢ het virtueel proces koppelen aan het bericht door het zetten van het virtueel_proces_id in
de mig_berichten tabel (zie 4.2 ISC tabellen)
➢ voorbereiden stappen voor het verzenden:
o zetten messageId

Operatie BRP

Pagina 15 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

o
o

zetten correlatieId (altijd leeg in dit geval)
zetten van de eerder bepaalde verzendende partij

Het verzenden van het bericht gebeurd door de standaard uitgaande verwerking voor VOISC.

2.2.1.2

Versturen van berichten
Het versturen van berichten is geïmplementeerd met de standaard Spring functionaliteit
(JmsTemplate). Het versturen van berichten doorloopt de volgende stappen:
➢
➢
➢

Audit
Opslaan correlatiegegevens
Versturen via queue

Het bericht is reeds in de database opgeslagen door het proces (of in geval van BRP
Leveringsberichten de ‘VerwerkLeveringsbericht’ action).

2.2.1.2.1

Audit

Class

AuditUitgaandAction
Er wordt bij het bericht opgeslagen via welk kanaal het bericht wordt verstuurd.
2.2.1.2.2

Opslaan correlatiegegevens

Class

CorrelatieOpslaanAction
Er wordt technische informatie opgeslagen in de MIG_CORRELATIE tabel zodat op basis van het
correlatie-id (message-id van het te versturen berichten) bij het ontvangen van een bericht kan
worden bepaald aan welk proces het bericht gekoppeld moet worden (process-instance-id) en of
het proces op dat bericht wacht (node-id, token-id, bron-instantie en doel-instantie).

2.2.2

Processen
De functionaliteit die nodig is voor het afhandelen van communicatie tussen het GBA stelsel en
het BRP stelsel is geïmplementeerd in JBPM processen. Deze processen zijn standaard
opgebouwd en bevatten uniforme componenten. De volgende delen van een proces zijn
gestandaardiseerd en worden niet bij elke specifieke proces implementatie opnieuw beschreven:
➢
➢
➢
➢

2.2.2.1

Het starten van een proces
Het eindigen van een proces
Het communiceren met een externe bron
Algemene foutafhandeling

Het starten van een proces
Class

StartProcesInstantieAction
Bij het starten van een proces wordt ten behoeve van rapportages [MV-UC802] een proces
extract geregistreerd in de tabel MIG_EXTRACTIEPROCESSEN.

Operatie BRP

Pagina 16 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.2.2

Het eindigen van een proces
Class

BeeindigProcesInstantieAction
Bij het beeindigen van een proces wordt ten behoeve van rapportages [MV-UC802] het proces
extract bijgewerkt met het eindtijdstip van het proces.

2.2.2.3

Het communiceren met een GBA partij via de VOISC
Het communiceren met een GBA partij via de VOISC volgt altijd dezelfde handelingen.

De stappen kunnen worden als volgt worden gekenmerkt:
1. Maak het uitgaande bericht
2. Verstuur het uitgaande bericht (en wacht op een inkomend bericht)
3. Controleer of er een bericht is ontvangen:
a. Indien geen bericht is ontvangen, controleer het aantal herhalingen:
▪
Herhaal automatisch of,
▪
Start de algemene foutafhandeling (maximaal aantal herhalingen is
bereikt)
b. Indien er een bericht is ontvangen:
▪
Bepaal of het antwoord bericht een verwacht type is. Zo nee, start de
algemene foutafhandeling

2.2.2.3.1

Maak uitgaand bericht

Het maken van het uitgaande bericht dient specifiek in de realisation beschreven te worden. De
mapping van gegevens naar het uitgaande bericht is in elk proces specifiek.

Operatie BRP

Pagina 17 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.2.3.2

Verstuur uitgaand bericht

Bij het versturen van het uitgaande bericht dient enkel vermeld te worden naar welk kanaal het
bericht wordt verstuurd.
Hierdoor wordt de standaard functionaliteit, beschreven in paragraaf2.2.1.2, aangeroepen voor
het versturen van berichten.
Het ontvangen van berichten, beschreven in paragraaf 2.2.1.1, zorgt voor de terugkoppeling
naar het proces.

2.2.2.3.3

Automatisch herhalen

Binnen elke communicatie is het belangrijk om tijdig een response te krijgen van het externe
systeem. Bij communicatie naar GBA, waarbij op een antwoord wordt gewacht, wordt altijd een
standaard periode gewacht voordat automatisch een herhaling wordt verstuurd. Na een gegeven
aantal herhalingen, zonder dat een antwoord is ontvangen, zal een foutafhandeling proces
worden gestart. Dit automatisch herhalen wordt niet nader in de specifieke realisations
beschreven.
De wacht periodes en aantal herhalingen zijn te configureren via [MV-UC803].

2.2.2.3.4

Aanvragen notification receipt

Binnen het GBA systeem dient bij een ‘eind’ bericht (of te wel een bericht waarop geen antwoord
wordt verwacht) een status report te worden aangevraagd. Dit is binnen ISC geïmplementeerd
door de bericht implementatie te markeren met de interface
nl.bzk.migratiebrp.bericht.model.lo3.Lo3EindBericht waardoor bij het versturen van het
bericht een vlag naar de VOISC wordt gezet waardoor het notification receipt wordt
aangevraagd.

2.2.2.3.5

Verwerken status report en delivery report

Class

VerwerkDeliveryReportAction
VerwerkStatusReportAction
Bij het ontvangen van een status report (wanneer het bericht niet is opgehaald) of een delivery
report (wanneer het bericht niet correct verzonden kon verzonden) dient een signaal naar de
beheerder te worden gestuurd en dient de beheerder het bericht opnieuw te kunnen versturen.
Uitzondering hierop is de ontvangst van het eerste status report op een verzonden bericht
waarop het bericht automatisch herhaald wordt.
Bij het ontvangen van een status of delivery report wordt het ‘herhaal’ proces gestart (zie
paragraaf 2.2.4)
2.2.2.3.6

Bepaal type antwoord bericht

Bij de communicatie naar een externe bron dient vermeldt te worden welke specifieke typen
berichten worden verwacht. Bij alle overige typen berichten (of de standaard foutberichten Pf01,
Pf02, Pf03 en SynchronisatieFout) of ongeldige berichten wordt een foutafhandeling proces
gestart.

Operatie BRP

Pagina 18 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.2.4

Het communiceren via de SYNC
Het communiceren via de SYNC volgt altijd dezelfde handelingen.

De stappen kunnen worden als volgt worden gekenmerkt:
1. Maak het uitgaande bericht
2. Verstuur het uitgaande bericht (en wacht op een inkomend bericht)
3. Indien er een bericht is ontvangen:
a. Bepaal of het antwoord bericht een verwacht type is. Zo nee, start de algemene
foutafhandeling
De beheerder heeft na het versturen van het bericht de mogelijkheid om via de transitie
‘afbreken’ het wachten op een antwoord bericht handmatig te onderbreken.
Het maken en het versturen van het uitgaande bericht voldoet aan dezelfde beschrijving als de
VOISC berichten.

Operatie BRP

Pagina 19 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.3

Algemene foutafhandeling
De meeste foutsituaties in een proces kunnen op een uniforme wijze worden afgehandeld.

In dit proces worden de volgende stappen uitgevoerd:
➢
➢
➢

➢
➢
➢

Registreer fout
Controleer input
(Optioneel) beheerder interactie
o Registreer start wachttijd
o Beheerder interactie
▪
Standaardactie, of
▪
Start [MV-UC808]
o Registreer einde wachttijd
Registreer resolutie
(Optioneel) stuur LO3 foutbericht
(Optioneel) stuur VrijBerichtVerzoekBericht

Operatie BRP

Pagina 20 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.3.1

Registreer fout
Class

RegistreerFoutAction
In de tabel MIG_FOUTEN worden ten behoeve van rapportages alle opgetreden fouten
geregistreerd.

2.2.3.2

Controleer input
Class

ControleerInputAction
Valideer de gegevens waarmee het foutafhandeling proces is gestart.

2.2.3.3

Beheerder interactie
De beheerder interactie kan, afhankelijk van de configuratie van het proces, resulteren in één
van de twee verschillende acties:
➢ [MV-UC808]
➢ Standaardactie
[MV-UC808] is verder beschreven het betreffende use case realisation en beschrijven we hier
niet.
De standaard actie is geïmplementeerd via het ‘human task’ mechnisme in JBPM wat tot gevolg
heeft dat er een ‘taak’ wordt gemaakt in het ‘werkbakje’ van een beheerder. In de tabel
MIG_PROCESEXTRACTIE wordt ten behoeve van rapportages geregistreerd wanneer een taak
voor een beheerder is geregistreerd en wanneer deze is afgehandeld.

Een beheerder kan deze taak starten en de taak daarmee aan zichzelf toewijzen. Wanneer een
taak is gestart wordt de specifieke afhandeling van die taak beschikbaar. Voor het algemene
foutafhandeling proces is een algemene afhandeling beschikbaar.

Operatie BRP

Pagina 21 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

De beheerder krijgt de fout en foutmelding te zien en kan de optie voor foutafhandeling
selecteren. De standaard keuzes die beschikbaar zijn zijn ‘opnieuw’ en ‘beeindigen’. Indien
overige keuzes nodig zijn dient dit specifiek bij de realisation beschreven te worden.

2.2.3.4

Registreer foutafhandeling
Class

RegistreerResolutieAction
Voor rapportage doeleinden wordt geregistreerd, ook indien er geen interactie met de beheerder
is geweest, hoe de fout is afgehandeld.

Operatie BRP

Pagina 22 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.2.3.5

Verstuur LO3 fout
Class

MaakPfAction
Indien nodig, wordt een protocol fout bericht verstuurd naar de LO3 bron en daarmee de LO3
cyclus beeindigd.
Uitgaand bericht: Pf01, Pf02, Pf03 (zie [LO])
Kanaal: VOSPG
Verwacht bericht: geen (enkel versturen)

2.2.3.6

Verstuur VrijBerichtVerzoekBericht
Class

MaakVb01Action
Indien nodig, wordt BRP variant van het bericht naar de verzendende gemeente of afnemer in
het BRP stelsel verstuurd om deze te attenderen dat het verstuurde vrij bericht niet is
doorgestuurd naar de GBA gemeente of afnemer.
Uitgaand bericht: VrijBerichtVerzoekBericht (zie [SYNC])
Kanaal: Sync
Verwacht bericht: Geen

2.2.4

Versturen herhaalbericht

Bij sommige situaties (na het ontvangen van een status- of delivery-report) moet eventueel een
herhaalbericht worden verstuurd. Echter dit herhaalbericht is (behalve bij de eerste keer
ontvangen van een status-report) afhankelijk van de keuze van een beheerder. Dit proces wordt
ondersteund door het ‘herhaal’ proces.

Operatie BRP

Pagina 23 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

2.3

Tooling
De basis applicatie opbouw is vanuit Spring waarbinnen de andere componenten worden
opgebouwd en uitgevoerd. We beschrijven hier de basis componenten waaruit de ISC applicatie
is opgebouwd.

2.3.1

Spring container
De Spring container is verantwoordelijk voor het aansluiten van alle componenten.

2.3.2

JBPM
JBPM is verantwoordelijk voor het ondersteunen van de langlopende processen.

2.3.2.1

Configuratie vanuit Spring
Class

JbpmConfigurationFactoryBean
JbpmProcessInstaller
JbpmProcessInstallerImpl
Om JBPM te kunnen configureren vanuit Spring is een Spring object factory geïmplementeerd
waarmee JBPM wordt opgebouwd. Deze objectfactory configureerd onder andere de persistentie
(hibernate) en scheduling (quartz) in JBPM. Als onderdeel van de configuratie van JBPM worden
de geimplementeerde processen geinstalleerd in JBPM.

2.3.2.2

Gebruik van Spring beans
Class

SpringAction
SpringActionHandler
SpringDecision
SpringDecisionHandler
SpringService
SpringServiceFactory
Om vanuit JBPM gebruik te kunnen maken van onderdelen uit de Spring container zijn
verschillende hulpmiddelen aanwezig. Met de SpringAction/Decision kunnen Spring beans
gebruikt worden als JBPM actions. Met de SpringService kan via JBPM willekeurig Spring beans
worden opgevraagd en gebruikt.
2.3.3

Hibernate
Class

Hibernate4PersistenceService
Hibernate4PersistenceServiceFactory
Hibernate is verantwoordelijk voor de database interactie. JBPM 3.2.14 maakt standaard gebruik
van een ‘oude’ versie van hibernate. Deze is bijgewerkt naar een recente versie. De specifiek
voor ISC aanwezige gegevens worden ook via Hibernate aangesproken en kunnen op deze
manier in dezelfde transactie worden bijgewerkt als de JBPM gegevens.
2.3.4

Quartz
Class

Operatie BRP

Pagina 24 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

AbstractExecuteJob
ExecuteJobJob
ExecuteService
ExecuteServiceImpl
ExecuteTimerJob
QuartzMessageService
QuartzMessageServiceFactory
QuartzSchedulerService
QuartzSchedulerServiceFactory
Quartz is verantwoordelijk voor het uitvoeren van geplande taken. Met geplande taken worden
ook de ‘wachtmomenten’ uit JBPM bedoeld.
2.3.5

Atomikos
Om de transactionaliteit van de acties te garanderen wordt gebruik gemaakt van Atomikos als
JTA Transaction Manager. De transanctie voor de verwerking ligt ‘over’ de queues en database
heen. Dit betekent dat het oppakken van een bericht, het verwerken van het bericht in JBPM en
het eventueel versturen van een resulterend bericht in één transactie wordt uigevoerd en dus in
zijn geheel slaagt of faalt.

Operatie BRP

Pagina 25 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3

Processen

3.1

Context
Onderstaande tabel toont een overzicht van de geïmplementeerde processen binnen ISC. Voor
elk proces is, waar het van toepassing is, aangegeven welk ander proces er kan worden/wordt
gebruikt ter uitvoering. De beschrijving van het proces UC220 is, gezien de synchronisatieservice
een losse component is, beschreven in [SYNC] en zal daarom niet hieronder herhaald worden.
Proces
UC202

Beschrijving
Verwerken synchronisatie-cyclus

Gebruikt proces(sen)
UC220, foutafhandelingproces

UC220

Bepalen verwerking persoonslijst

UC808

UC301

Verwerk vervolginschrijving van BRP naar LO3 GBA

-

UC302

Verwerk vervolginschrijving van LO3 naar BRP
ingezetenen

-

UC303

Verwerk vervolginschrijving van BRP naar LO3 RNI

-

UC305

Stuur verwijsgevens naar LO3

-

UC306

Stuur toevallige geboorte in BRP door

-

UC307

Stuur toevallige geboorte in LO3 GBA door

-

UC308

Stuur toevallige gebeurtenis in BRP door

-

UC309

Stuur toevallige gebeurtenis in LO3 GBA door

foutafhandelingproces

UC310

Verwerk wijziging A-nummer in LO3

-

UC311

Verwerk wijziging A-nummer in BRP

foutafhandelingproces

UC312

Opnemen/wijzigen verblijfstitel vanuit BRP stelsel

-

UC405

Doorsturen T bericht

-

UC501

Stuur vrij bericht uit LO3 door

-

UC502

Stuur vrij bericht uit BRP door

-

UC801

Beheren processen

UC814, UC815

UC802

Opvragen rapportages

UC807

UC803

Beheren van uitwisselingsconfiguraties

-

UC806

Beheer vertaaltabellen LO3 en BRP coderingen

-

UC807

Opschonen procesinformatie

-

UC808

Beoordelen onduidelijke synchronisatie

-

UC811

Verwerken synchronisatievraag-cyclus

UC220, foutafhandelingproces

UC812

Verwerken bulk synchronisatievraag-cyclus

UC811, foutafhandelingproces

UC813

Handmatig starten synchronisatievraag-cyclus

UC811, foutafhandelingproces

UC814

Beheren berichten

-

UC815

Beheren taken

-

UC1003

Verwerken handmatig plaatsen en verwijderen
afnemersindicatie

UC1003,
foutafhandelingproces

Operatie BRP

Pagina 26 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

De volgende paragrafen zullen de bovenstaande processen in meer detail bespreken en ingaan
op proces specifieke stappen, ontwerpbeslissingen en implementatiekeuzes.

Operatie BRP

Pagina 27 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.2

UC202 – Verwerken synchronisatie-cyclus

3.2.1

Proces
Tijdens de migratieperiode zullen LO3- en RNI-gemeenten persoonsgegevens synchroniseren
met de BRP. Dit is de start van de synchronisatie (bericht)cyclus. De synchronisatie-cyclus is
uitvoerig beschreven in het Logisch Ontwerp [LO].
De synchronisatie-cyclus is een eenvoudige cyclus die uit slechts één bericht bestaat, het
synchronisatiebericht (Lg01).

Operatie BRP

Pagina 28 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Schematische weergave van de synchronisatie-cyclus zoals die in het Logisch ontwerp is
beschreven

3.2.2

Preconditie
•
Er is een synchronisatiebericht ontvangen

3.2.3

Postconditie
•
Het aangeboden bericht is in de BRP verwerkt, of
•
Het aangeboden bericht is niet in de BRP verwerkt

3.2.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc202

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Pagina 29 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.2.5

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces gerealiseerd waarin de functionaliteit is geïmplementeerd.

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC202].

3.2.5.1

Controleren: Valideer Lg01 bericht
Class

ControleerLg01BerichtAction
De volgende controles worden uitgevoerd:
➢
➢
➢
➢

➢

De gemeente waarvan het bericht is ontvangen moet een gemeente zijn die zich in het
GBA stelsel bevindt.
De partij waaraan het bericht is verstuurd moet de centrale voorziening zijn.
Het a-nummer uit de kop van het Lg01 bericht moet overeenkomen met het actuele anummer (categorie 01, element 01.10) van de persoonslijst in het Lg01 bericht.
Indien het vorig a-nummer in de kop van het Lg01 bericht is gevuld, moet dat
overeenkomen met het actuele vorige a-nummer (categorie 01, element 20.10) van de
persoonslijst in het Lg01 bericht.
De gemeente van inschrijving (categorie 08, element 09.10) moet overeenkomen met de
gemeente van wie het bericht is ontvangen.

Indien de controles niet slagen, wordt een foutafhandeling proces gestart (Zie 2.2.3).

Operatie BRP

Pagina 30 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.2.5.2

Synchroniseer naar BRP
Class

MaakSynchroniseerNaarBrpVerzoekAction
ControleerSynchroniseerNaarBrpAntwoordAction
De persoon wordt gesynchroniseerd naar de BRP database. De te synchroniseren persoonslijst
wordt overgenomen uit het ontvangen Lg01 bericht.
Uitgaand bericht: SynchroniseerNaarBrpVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: SynchroniseerNaarBrpAntwoord (Zie [SYNC])
Er wordt gecontroleerd of de persoonslijst opgeslagen is. Indien de gegeven persoonslijst is
‘afgekeurd’ wordt een foutafhandeling proces gestart. Indien de gegevens persoonslijst is
‘genegeerd’ wordt het proces vervolgd bij ‘Unlock’. Indien wordt aangegeven dat de persoonlijst
‘onduidelijk’ wordt een alternatieve foutafhandeling ingegaan (zie 3.22). Indien de gegeven
persoonslijst niet kon worden opgeslagen omdat er nog ‘Te leveren administratieve handelingen’
aanwezig zijn wordt het proces vervolgd bij ‘Wachten’ waarna de synchronisatie opnieuw wordt
uitgevoerd.

3.2.5.3

Synchroniseer naar BRP: Afhandelen onduidelijk
Class

ControleerSynchroniseerNaarBrpAntwoordAction
AutomatischVerwerkenGerelateerdeTakenAction
Op basis van de gevonden kandidaat persoonslijsten in het SynchroniseerNaarBrpAntwoord
worden de mogelijke keuzes voor de beheerder bepaald.
➢

➢
➢
➢

Keuze ‘Opnemen als nieuwe persoonslijst’: enkel opnemen indien er geen persoonslijst is
gevonden waarbij het actuele a-nummer gelijk is aan het actuele a-nummer van de
gegeven persoonslijst.
Keuze ‘Vervang persoonslijst met a-nummer <xxx>’: opnemen voor elke gevonden
persoonslijst.
Keuze ‘Negeer persoonslijst’: altijd opnemen
Keuze ‘Persoonslijst afkeuren’: altijd opnemen (resulteert in Pf03 naar gemeente).

Er wordt een foutafhandeling proces gestart (zie 2.2.3) van het type UC808 (zie 3.22).
3.2.5.4

Automatisch verwerken
Class

AutomatischVerwerkenGerelateerdeTakenAction
Op basis van het resultaat van Synchroniseer naar BRP (indien de persoonslijst is toegevoegd of
vervangen) worden gerelateerde taken van het UC808 proces automatisch verwerkt. De
gerelateerde taken, zijn taken waarvan de te verwerken persoonslijst minimaal één a-nummer
(element 01.01.10 of 51.01.10) heeft dat overeenkomt met een a-nummer van de zo juist
verwerkte persoonslijst.

3.2.6

Ontwerpbeslissingen binnen UC202
Voor UC202 zijn er geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 31 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.3

UC301 – Verwerk vervolginschrijving van BRP naar LO3

3.3.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.3.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.3.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.3.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc301

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.3.5

Implementatie

3.3.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.3.6

Ontwerpbeslissingen binnen UC301
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 32 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.4

UC302 – Verwerk vervolginschrijving van LO3 naar BRP ingezetenen

3.4.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.4.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.4.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.4.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc302

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.4.5

Implementatie

3.4.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.4.6

Ontwerpbeslissingen binnen UC302
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 33 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.5

UC303 – Verwerk vervolginschrijving van BRP naar LO3 RNI

3.5.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.5.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.5.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.5.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc303

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.5.5

Implementatie

3.5.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.5.6

Ontwerpbeslissingen binnen UC303
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 34 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.6

MV305 – Stuur verwijsgegevens naar LO3

3.6.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.6.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.6.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.6.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc305

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.6.5

Implementatie

3.6.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.6.6

Ontwerpbeslissingen binnen UC305
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 35 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.7

UC306 – Stuur toevallige geboorte in BRP door

3.7.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.7.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.7.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.7.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc306

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.7.5

Implementatie

3.7.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.7.6

Ontwerpbeslissingen binnen UC306
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 36 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.8

UC307 – Stuur toevallige geboorte in LO3 GBA door

3.8.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.8.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.8.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.8.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc307

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.8.5

Implementatie

3.8.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.8.6

Ontwerpbeslissingen binnen UC307
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 37 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.9

UC308 – Stuur toevallige gebeurtenis in BRP door

3.9.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.9.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.9.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.9.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc308

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.9.5

Implementatie

3.9.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.9.6

Ontwerpbeslissingen binnen UC308
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 38 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.10

UC309 – Stuur toevallige gebeurtenis in LO3 GBA door

3.10.1

Proces
Gedurende de duale periode zullen er toevallige gebeurtenissen (een gebeurtenis die
geregistreerd wordt in een gemeente anders dan de gemeente waarbij de hoofdpersoon is
ingeschreven) plaats vinden. Wanneer een rechtsfeit geregistreerd wordt in een GBA gemeente
voor een hoofdpersoon die is ingeschreven in een BRP gemeente, wordt (indien mogelijk) door
de GBA gemeente een Tb02 bericht verstuurt aan de BRP gemeente.

Schematische weergave van de toevallige gebeurtenis-cyclus zoals die in het Logisch ontwerp is
beschreven

Operatie BRP

Pagina 39 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.10.2

Preconditie

•
3.10.3

Postconditie

•
•
3.10.4

Er is een Tb02 bericht ontvangen

Het Tb02 bericht is verwerkt en de BRP gemeente is op de hoogte gesteld van het rechtsfeit, of
Het Tb02 bericht is afgekeurd en de verzendende gemeente is op de hoogte gesteld.

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc309

3.10.5

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Implementatie

Operatie BRP

Pagina 40 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.10.5.1

Controleren
Class

ControleerTb02BerichtAction
De volgende controles worden uitgevoerd:

•
•

De gemeente waarvan het bericht is ontvangen moet een gemeente zijn die zich in het
GBA stelsel bevindt
De gemeente waaraan het bericht is ontvangen moet een gemeente zijn die zich in het
BRP stelsel bevindt

Indien de controles niet slagen, wordt een foutafhandeling proces gestart (zie 2.2.3) en wordt
een Pf03 bericht verstuurd naar de verzendende gemeente.

3.10.5.2

Verwerken
Class

MaakVerwerkToevalligeGebeurtenisVerzoekBerichtAction

Op basis van het Tb02 bericht wordt een VerwerkToevalligeGebeurtenisVerzoek bericht
opgesteld. Het bericht wordt als volgt gevuld:

•
•
•
•

Aktenummer: het aktenummer uit de kop van het Tb02 bericht
Verzendende gemeente: de verzendende gemeente uit de metadata van het bericht
(mailbox)
Ontvangende gemeente: de ontvangende gemeente uit de metadata van het bericht
(mailbox)
Tb02inhoud: de inhoud (dus zonder kop) van het Tb02 bericht als teletex string.

Uitgaand bericht: VerwerkToevalligeGebeurtenisVerzoek (zie [SYNC])
Kanaal: Sync
Verwacht bericht: VerwerkToevalligeGebeurtenisAntwoord (zie [SYNC])

3.10.5.3

Antwoord
Class

BepaalSoortAntwoordBerichtDecision
MaakNullAntwoordBerichtAction
MaakTf21AntwoordBerichtAction
Op basis van het VerwerkToevalligeGebeurtenisAntwoord wordt bepaald welk bericht naar de
verzendende gemeente verstuurd moet worden. Indien de status in het bericht ‘OK’ is wordt een
Null bericht opgesteld en verzonden. Anders wordt een Tf21 bericht opgesteld en verzonden.

Operatie BRP

Pagina 41 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Uitgaand bericht: Null of Tf21 (zie [LO])
Kanaal: Voisc
Verwacht bericht: -

3.10.6

Ontwerpbeslissingen binnen UC309
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 42 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.11

UC310 – Verwerk wijziging A-nummer in LO3

3.11.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.11.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.11.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.11.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc310

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.11.5

Implementatie

3.11.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.11.6

Ontwerpbeslissingen binnen UC310
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 43 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.12

UC311 – Verwerk wijziging A-nummer in BRP

3.12.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.12.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.12.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.12.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc311

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.12.5

Implementatie

3.12.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.12.6

Ontwerpbeslissingen binnen UC311
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 44 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.13

UC312 – Opnemen/wijzigen verblijfstitel vanuit BRP

3.13.1

Proces
<Nog onbekend, dit proces valt binnen stap 4.3>

3.13.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.13.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 4.3>

3.13.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc312

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.13.5

Implementatie

3.13.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 4.3>

3.13.6

Ontwerpbeslissingen binnen UC312
<Nog onbekend, dit proces valt binnen stap 4.3>

Operatie BRP

Pagina 45 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.14

UC405 – Doorsturen TMV bericht

3.14.1

Proces
<Nog onbekend, dit proces valt binnen stap 3.6>

3.14.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 3.6>

3.14.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 3.6>

3.14.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc405

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.14.5

Implementatie

3.14.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 3.6>

3.14.6

Ontwerpbeslissingen binnen UC405
<Nog onbekend, dit proces valt binnen stap 3.6>

Operatie BRP

Pagina 46 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.15

UC501 – Stuur vrij bericht uit LO3 door

3.15.1

Proces
Gedurende de duale periode kunnen er vanuit afnemers en gemeenten vrij berichten (Vb01)
gestuurd worden naar een afnemer of gemeente. Hierbij kunnen er vrijelijk tussen het GBAstelsel en het BRP-stelsel vrije berichten uitgewisseld worden.

Schematische weergave van de vrij bericht-cyclus zoals die in het Logisch ontwerp is beschreven
3.15.2

Preconditie

•
•

3.15.3

In het geval dat een GBA gemeente of afnemer een vrij bericht wil versturen, wordt het
proces geïnitieerd door een Vb01 bericht op het Voisc-kanaal.
In het geval dat een BRP gemeente of afnemer een vrij bericht wil versturen, wordt het
proces geïnitieerd door een VrijBerichtNotificatieBericht op het Notificatie-kanaal.

Postconditie
In het geval dat een GBA gemeente of afnemer een vrij bericht wil versturen:

•
•

Het Vb01 bericht is verwerkt en doorgestuurd naar de BRP gemeente of afnemer, of
Het Vb01 bericht is afgekeurd en de verzendende gemeente is op de hoogte gesteld middel
een Pf03 bericht

In het geval dat een BRP gemeente of afnemer een vrij bericht wil versturen:

•
•

3.15.4

Het VrijberichtNotificatie bericht is verwerkt en doorgestuurd naar de GBA gemeente of
afneemer, of
Het Tb02 VrijberichtNotificatie is afgekeurd en de verzendende gemeente is op de hoogte
gesteld middels een VrijBerichtVerzoek bericht.

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc501

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Pagina 47 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.15.5

Implementatie GBA gemeente/afnemer naar BRP gemeente/afnemer

3.15.5.1

Controleren
Class

ControleerVb01BerichtAction
De volgende controles worden uitgevoerd:

•
•
•

De gemeente waarvan het bericht is ontvangen moet een gemeente zijn die zich in het
GBA stelsel bevindt
De gemeente waaraan het bericht is ontvangen moet een gemeente zijn die zich in het
BRP stelsel bevindt
Het bericht dient ook daadwerkelijk een bericht te bevatten; lege Vb01 berichten worden
niet geaccepteerd

Indien de controles niet slagen, wordt een foutafhandeling proces gestart (zie 2.2.3) en wordt
een Pf03 bericht verstuurd naar de verzendende gemeente.

Operatie BRP

Pagina 48 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.15.5.2

Verwerken
Class

MaakVrijBerichtVerzoekBerichtAction
Op basis van het Vb01 bericht wordt een VrijBerichtVerzoekBericht bericht opgesteld. Het bericht
wordt als volgt gevuld:

•
•
•
•

Verzendende gemeente: de verzendende gemeente uit de metadata van het bericht
(mailbox)
Ontvangende gemeente: de ontvangende gemeente uit de metadata van het bericht
(mailbox)
Bericht: de inhoud (uit de kop) van het Vb01 bericht als teletex string.
Referentienummer: het message id van het Vb01 bericht

Uitgaand bericht: VrijBerichtVerzoekBericht (zie [SYNC])
Kanaal: Sync
Verwacht bericht: VrijBerichtAntwoordBericht (zie [SYNC])

3.15.5.3

Antwoord
Class

ControleerAntwoordVrijBerichtInhoudelijkAction
Op basis van het VrijBerichtAntwoordBericht wordt bepaald welk bericht naar de verzendende
gemeente verstuurd moet worden. Indien de status in het bericht ‘OK’ is wordt er geen bericht
opgesteld en verzonden. In andere gevallen wordt een Pf03 bericht opgesteld en verzonden.
Uitgaand bericht: Geen bericht of Pf03 (zie [LO])
Kanaal: Voisc
Verwacht bericht: -

Operatie BRP

Pagina 49 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.15.6

Implementatie BRP gemeente/afnemer naar GBA gemeente/afnemer

3.15.6.1

Controleren
Class

ControleerVrijBerichtNotificatieBerichtAction
De volgende controles worden uitgevoerd:

•
•

De gemeente waarvan het bericht is ontvangen moet een gemeente zijn die zich in het
BRP stelsel bevindt
De gemeente waaraan het bericht is ontvangen moet een gemeente zijn die zich in het
GBA stelsel bevindt

Indien de controles niet slagen, wordt een foutafhandeling proces gestart (zie 2.2.3) en wordt
een VrijBerichtVerzoekBericht bericht verstuurd naar de verzendende gemeente.

Operatie BRP

Pagina 50 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.15.6.2

Verwerken
Class

MaakVb01Action
Op basis van het VrijBerichtVerzoekBericht bericht wordt een Vb01 bericht opgesteld. Het bericht
wordt als volgt gevuld:

•
•
•

Verzendende gemeente: de verzendende gemeente uit de metadata van het bericht
(mailbox)
Ontvangende gemeente: de ontvangende gemeente uit de metadata van het bericht
(mailbox)
Inhoud: de inhoud uit het VrijBerichtVerzoekBericht bericht wordt als header in het Vb01
bericht geplaatst.

Op basis van het VrijBerichtVerzoekBericht wordt bepaald welk bericht naar de verzendende
gemeente verstuurd moet worden. Indien het bericht succesvol vertaald kan worden naar het
Vb01 bericht, wordt er geen antwoord gestuurd. In andere gevallen wordt een
VrijBerichtVerzoekBericht bericht opgesteld en verzonden.
Uitgaand bericht: VrijBerichtNotificatieBericht (zie [LO])
Kanaal: Voisc (bij OK) Sync (bij niet OK)
Verwacht bericht: - (zie [LO]) of VrijBerichtVerzoekBericht (zie [SYNC])

3.15.7

Ontwerpbeslissingen binnen UC501
Binnen dit proces zijn geen aanvullende ontwerpbeslissing.

Operatie BRP

Pagina 51 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.16

UC502 – Stuur vrij bericht uit BRP door

3.16.1

Proces
<Nog onbekend, dit proces valt binnen stap 3.7>

3.16.2

Preconditie
<Nog onbekend, dit proces valt binnen stap 3.7>

3.16.3

Postconditie
<Nog onbekend, dit proces valt binnen stap 3.7>

3.16.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc502

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

3.16.5

Implementatie

3.16.5.1

Onderdeel X
<Nog onbekend, dit proces valt binnen stap 3.7>

3.16.6

Ontwerpbeslissingen binnen UC502
<Nog onbekend, dit proces valt binnen stap 3.7>

Operatie BRP

Pagina 52 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.17

UC801 – Beheren processen

3.17.1

Proces
De migratievoorziening is een complex systeem dat een veelheid van activiteiten uitvoert. Het is
daarom belangrijk dat het systeem goed beheerd kan worden. Om dit mogelijk te maken is er
voor gekozen om alle activiteiten in processen te vatten waarbij elk proces bestaat uit meerdere
voorgedefinieerde stappen.
Dit proces beschrijft op welke wijze de beheerder inzicht krijgt in de processen van het systeem
en hoe deze beheerd kunnen worden.

3.17.2

Preconditie
N.v.t.

3.17.3

Postconditie
N.v.t.

3.17.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.console.m
ig4jsf

3.17.5

Implementatie

3.17.5.1

Beheer proces instanties

Omschrijving
Package waarin specifieke implementaties van
actionListeners en handlers voor deze use case
staan.

Class

ListProcessInstancesActionListener
ListProcessInstancesForProcessInstanceActionListener
ListProcessInstancesForProcessInstanceHandler
ListProcessInstancesHandler

Operatie BRP

Pagina 53 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

ListTransitionsForProcessInstanceActionListener
ListTransitionsForProcessInstanceHandler
MigratieLibrary
ProcessInstanceUtil

Bovenstaand scherm toont het overzicht van de beschikbare processen binnen ISC. Bij het
doorklikken op ‘bekijken’ achter een proces, krijgt de gebruiker onderstaand scherm met daarop
alle lopende processen van dat type (in het voorbeeld zijn ter illustratie ook de beëindigde
processen weergegeven door het vinkje voor ‘E’ aan te zetten en op ‘Filter aanbrengen’ te
klikken).

Operatie BRP

Pagina 54 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Het volgende scherm toont een overzicht van de stappen die door het proces zijn gevolgd om te
komen tot de status waarop het proces is op het moment van raadplegen.

Bovenstaand scherm toon de procesplaat behorende bij een procesinstantie van een proces. Het
blauw gekleurde blok geeft aan waar het proces zich op het moment van raadplegen bevindt. Op
het onderstaande scherm is een overzicht van alle binnen de procesinstantie gebruikte berichten
weergegeven.

Operatie BRP

Pagina 55 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Het onderstaande scherm toont welke gerelateerde processen er voor de huidige procesinstantie
zijn.

3.17.6

Ontwerpbeslissingen binnen UC801
De berichtverwerking voor interstelsel communicatie zijn gerealiseerd met JBoss JBPM. De
processen kunnen worden gemonitord door gebruik te maken van de (aangepaste) standaard
beheerapplicatie die hiervoor beschikbaar is.
Om hier beter gebruik van te kunnen maken zijn de volgende aanpassingen gedaan aan de
standaard oplossing.
Filteren van tabelkolommen word doorgaans gedaan door de filter toe te passen op de
kolomheader. Echter voor proces-id en proces-type gaat dit iets anders. Het filteren van
processen op ‘id’ kan gedaan worden door de waarde van het parameterveld ‘id’ in de url aan te
passen naar de desbetreffende id. Men moet zich dan wel al bevinden op de pagina van een
procesinstantie.
Het filteren van processen op ‘type’ kan gedaan worden door een procesdefinitie van het
gewenste type te bekijken.

3.17.6.1

Remote command
Om ervoor te zorgen dat de beheerder synchroon remote acties kan uitvoeren, maken we
gebruik van een commands via een JMX call. Hierbij worden er geen berichten op de queue
geplaatst, maar wordt er een JMX call gedaan waarna het betreffende command wordt
uitgevoerd.
Het betreft de volgende acties:

•
•
•
•
•

Synchronisatievraag [UC811] en [UC812]
Opschorten van procesinstanties
Hervatten van procesinstanties
Beheerderskeuze [UC808]
Foutafhandeling

Package
nl.bzk.migratiebrp.isc.jbpm.command

Omschrijving
Basis voor remote acties.

Class
Command
CommandExecutor

Operatie BRP

Pagina 56 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

exception.CommandExecutorException
client.CommandClient
client.CommandClientImpl
executor.CommandService
executor.CommandServiceImpl
impl.JbpmResumeCommand
impl.JbpmStartTaakCommand
impl.JbpmSuspendCommand
impl.JbpmSynchronisatievraagCommand
impl.JbpmTaakCommand
impl.JbpmTransitionCommand
Package
nl.bzk.migratiebrp.isc.console.mig4js
f

Omschrijving
Package voor de JBPM console

Class
ResumeProcessInstanceActionListener
ResumeProcessInstanceHandler
StartTaakActionListener
StartTaakHandler
SuspendProcessInstanceActionListener
SuspendProcessInstanceHandler
SynchronisatievraagActionListener
SynchronisatievraagHandler
VerwerkTaakActionListener
VerwerkTaakHandler
Om acties remote uit te kunnen voeren middels commands worden de volgende generieke
stappen doorlopen:
Op de beheer node:

•
•
•
•

Afhankelijk van de uit te voeren actie wordt er een Command aangemaakt
Het aangemaakt command wordt meegegeven aan de CommandClient(Impl)
De CommandClient maakt op basis van de ingestelde properties via JMX een connectie naar
de CommandService(Impl) op de verwerkende node
De CommandClient roept de beschikbare JMX service aan met als argument het eerder
aangemaakte Command

Op de verwerkende node:

•

Aanroepen excecuteCommand() op het ontvangen Command

Behalve de specifieke implementaties van de commands, zijn in de volgende webapp bestanden
de tags aangepast zodat deze gebruikmaken van de migratie-specifieke handlers/actionlisteners
in plaats van de standaard Jbpm handlers/actionslisteners:

•
•
•
•
•

actions.xhtml
procins.xhtml
task.xhtml
t_tasks.xhtml
t_transitionlog.xhtml

Opmerking: Omdat we een JMX call uitvoeren moeten op zowel de beheer node als de
verwerkende node dezelfde Commands beschikbaar zijn. Indien dit niet het geval is en de
verwerkende node ontvangt een Command dat niet bekend is, zal er SerializationException
optreden. Concreet betekent dit dat dezelfde versie van migr-isc-jbpm-command in zowel de iscruntime als in de isc-console dient te zitten.

Operatie BRP

Pagina 57 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.18

UC802 – Opvragen rapportages

3.18.1

Proces
Voor het inzichtelijk maken van opgetreden fouten, voortgang van processen en taken die
beheerders dienen uit te voeren, is het nodig om rapportages met betrekking tot de verwerking
beschikbaar te stellen. Deze rapportages dienen vanuit de console beschikbaar te zijn.

3.18.2

Preconditie
N.v.t.

3.18.3

Postconditie
N.v.t.

3.18.4

Structuur

3.18.5

Package
nl.bzk.migratiebrp.isc.console.mig4jsf

Omschrijving
Package waarin specifieke implementaties van
actionListeners en handlers voor de commands
staan.

nl.bzk.migratiebrp.isc.jbpm.command

Package waarin de implementaties van de Jbpmcommands staan.

nl.moderniseringgba.isc.console.webapp
.report

Package waarin rapport functionaliteit staat.

Implementatie
De rapportages zijn geïmplementeerd met het BiRT framework. BiRT is opgenomen in de JBPM
Console.

Operatie BRP

Pagina 58 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

De rapportages worden ondersteund door een batch proces dat periodiek tellingen uitvoerd.
3.18.5.1

Batch proces tellingen
Periodiek wordt ten behoeve van de rapportages een telling uitgevoerd op basis van de gegevens
in de database. In de tabellen MIG_BERICHTEN en MIG_EXTRACTIEPROCES wordt geregistreerd
dat een gegeven is geteld waarna het gegeven eventueel beschikbaar komt voor opschonen
[MV-UC807].

3.18.6

Rapportages

3.18.6.1

Fouten
Gebruikte BIRT-Rapport files
mig-fouten-gemeente-proces-foutcode
mig-fouten-gemeente-proces
mig-fouten-gemeente
mig-fouten-overzicht
mig-fouten-proces-foutcode-gemeente
mig-fouten-proces-foutcode
mig-fouten-proces-gemeente-foutcode
mig-fouten-proces-gemeente
mig-fouten-proces
Op basis van de MIG_FOUTEN tabel wordt een overzicht gegeven van de geregistreerde fouten in
het systeem.

Operatie BRP

Pagina 59 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.18.6.2

Openstaande processen
Gebruikte BIRT-Rapport files
jbpm-proces-instanties-in-uitvoering-ok
jbpm-proces-instanties-in-uitvoering-waarschuwing
jbpm-proces-instanties-wacht-op-actie-ok
jbpm-proces-instanties-wacht-op-actie-waarschuwing
jbpm-proces-instanties
Op basis van de MIG_EXTRACTIEPROCES tabel wordt een overzicht gegeven van de lopende
processen per type.

Operatie BRP

Pagina 60 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.18.6.3

Overzicht kanaal
Gebruikte BIRT-Rapport files
mig-kanaal-overzicht
Op basis van de MIG_TELLINGENPROCESSEN en MIG_TELLINGENBERICHTEN tabellen wordt een
overzicht gegeven van het aantal verwerkte berichten en de daardoor gestarte processen.

Operatie BRP

Pagina 61 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.18.6.4

Afhandeling processen
Gebruikte BIRT-Rapport files
mig-overzicht-afhandeling-processen
Op basis van de MIG_TELLINGENPROCESSEN en MIG_TELLINGENBERICHTEN tabellen wordt een
overzicht gegevens van het aantal processen.

3.18.7

Ontwerpbeslissingen binnen UC802
Voor het genereren en presenteren van de rapportages wordt gebruikt gemaakt van BIRT versie
4.2.1 met daarbij de ‘BIRT controls library’ (nodig voor gedraaide tekst) versie 2.5.2.1.

Operatie BRP

Pagina 62 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.19

UC803 – Beheren van uitwisselingsconfiguraties

3.19.1

Proces
Dit proces beschrijft hoe de algemene configuratie wordt gedaan binnen ISC.

3.19.2

Preconditie
N.v.t.

3.19.3

Postconditie
N.v.t.

3.19.4

Structuur
Dit proces heeft geen implementatieklassen.

3.19.5

Implementatie

3.19.5.1

Configuratie ISC
De configuratiegegevens voor ISC zijn opgenomen in de tabel MIG_CONFIGURATIE.
De volgende configuratie instellingen worden gebruikt:
Configuratie

vospg.timeout

3.19.5.2

Omschrijving
Aantal uur waarna, zonder het ontvangen van een antwoord, een
bericht op het LO3 kanaal opnieuw wordt verstuurd.

vospg.herhalingen

Aantal herhalingen waarna, zonder het ontvangen van een antwoord
op het LO3 kanaal, een proces als fout wordt aangemerkt en wordt
aangeboden aan de beheerder.

lock.timeout

Aantal uur waarna, na een blokkade op basis van het a-nummer (zie
processen uc202 en uc811), op nieuw wordt geprobeerd om een lock
te verkrijgen

Verzendende instantie
In de tabel MIG_VERZENDER wordt geconfigureerd welke verzendende instantie moet worden
gebruikt bij het versturen van een bericht naar een afnemer of gemeente, indien dat bericht is
geïnitieerd door de centrale voorziening. Het initieel vullen van deze tabel wordt ondersteund
door proces [UC105].

3.19.6

Ontwerpbeslissingen binnen UC803
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 63 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.20

UC806 – Beheer vertaaltabellen LO3 en BRP coderingen

3.20.1

Proces
Dit proces beschrijft hoe de vertaaltabellen binnen ISC worden onderhouden.

3.20.2

Preconditie
N.v.t.

3.20.3

Postconditie
N.v.t.

3.20.4

Structuur
Dit proces heeft geen implementatieklassen.

3.20.5

Implementatie

3.20.5.1

Vertaaltabellen LO3 en BRP coderingen
De vertaaltabellen (conversietabellen) worden binnen ISC onderhouden als statische
stamtabellen welke rechtstreeks uit het BMR komen.

3.20.6

Ontwerpbeslissingen binnen UC806
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 64 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.21

UC807 – Opschonen procesinformatie

3.21.1

Proces
Dit proces beschrijft hoe gegevens binnen ISC worden geschoond. Gegevens worden geschoond
om het systeem performant te houden.

3.21.2

Preconditie

•

3.21.3

Postconditie

•

3.21.4

Er zijn processen en berichten die voldoen aan de condities (zie 3.21.5.1) om opgeschoond te
worden.

De processen, hierbij inbegrepen alle aan de processen gerelateerde gegevens, en berichten
die voldeden aan de condities (zie 3.21.5.1) om opgeschoond te worden zijn verwijderd uit de
database.

Structuur
Package
nl.bzk.migratiebrp.isc.opschoner

Omschrijving
Package waarin de JMX en Main klasse van
het opschonen staat.

nl.bzk.migratiebrp.isc.opschoner.dao

Packages waarin de DAO interfaces en
klassen staan.

nl.bzk.migratiebrp.isc.opschoner.exception

Package waarin de klassen voor specifieke
exceptie voor het opschonen staan.

nl.bzk.migratiebrp.isc.opschoner.job

Package waarin de job voor het opschonen
staat.

nl.bzk.migratiebrp.isc.opschoner.service

Packages waarin de interfaces en klassen
voor de services staan.

3.21.5

Implementatie

3.21.5.1

Opschonen processen en berichten
Periodiek worden de afgeronde processen en de daarbij behorende berichten verwijderd.
De processen worden geselecteerd op basis van de gegevens die zijn geregistreerd in de MIG_
EXTRACTIE_ PROCES tabel. Processen worden verwijderd indien voldaan wordt aan alle volgende
voorwaarden:
➢
➢
➢

Het proces is beëindigd
Het proces is geteld (als onderdeel van [MV-UC802])
Het beëindiging tijdstip valt niet binnen de timeout periode.

De timeout periode wordt als volgt bepaald:
➢
➢
➢

Operatie BRP

Neem de huidige systeemdatum
Trek hier een instelbaar aantal uur af
Neem de datum (zonder tijd) als timeout periode.

Pagina 65 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Berichten worden verwijderd indien voldaan wordt aan alle volgende voorwaarden:
➢
➢
➢

Het bericht behoord bij een beëindigd proces
Het bericht is geteld (als onderdeel van [MV-UC802])
Het beëindiging tijdstip valt niet binnen de timeout periode.

De timeout periode wordt als volgt bepaald:
➢
➢
➢

Neem de huidige systeemdatum
Trek hier een instelbaar aantal uur af
Neem de datum (zonder tijd) als timeout periode.

Voorbeeld 1:
➢
➢

Systeemdatum: 14:35 op 04 januari 2013
Instelling aantal uren: 15

➢

Resultaat alle processen beëindigd tot (exclusief) 3 januari 2013 komen in
aanmerking om opgeschoond te worden

Voorbeeld 2:

3.21.5.1.1

➢
➢

Systeemdatum: 15:35 op 04 januari 2013
Instelling aantal uren: 15

➢

Resultaat alle processen beëindigd tot (exclusief) 4 januari 2013 komen in
aanmerking om opgeschoond te worden

JMX

Class

OpschonerJmx
OpschonerJmxImpl
Via Jmx is het mogelijk om de opschoner te activeren en direct een opschoonactie te laten
uitvoeren.

3.21.5.1.2

Job

Class
OpschoonJob
Klasse die vanuit quartz wordt gebruikt voor het periodiek uitvoeren van de opschonerservice.

Operatie BRP

Pagina 66 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.21.5.1.3

Dao

Class
ExtractieDao
ExtractieDaoImpl
JbpmDao
JbpmDaoImpl
MigDao
MigDaoImpl
RuntimeDao
RuntimeDaoImpl
Alle database interacties vinden plaats middels DAO-klassen. Deze klassen worden vanuit de
services gebruikt om gegevens uit de database op te vragen en om gegevens in de database te
verwijderen.
3.21.5.1.4

Services

Class
OpschonerService
OpschonerServiceImpl
ProcesService
ProcesServiceImpl
RuntimeService
RuntimeServiceImpl
Alle logica, zoals hierboven beschreven, bevindt zich in de services.

3.21.6

Ontwerpbeslissingen binnen UC807
Het opschonen van de procesinformatie vindt plaats middels een via quartz-scheduler
geconfigureerde batch verwerking waarbij bovenstaande periodiek wordt uitgevoerd.

Operatie BRP

Pagina 67 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.22

UC808 – Beoordelen onduidelijke synchronisatie

3.22.1

Proces
In sommige gevallen kan een persoonslijst niet in de BRP verwerkt worden omdat er door het
systeem een onduidelijke situatie is geconstateerd. Er kunnen één of meer kandidaat
persoonslijsten gevonden in de BRP. Hier krijgt de beheerder melding van. De beheerder dient
handmatig te bepalen op welke wijze de aangeboden persoonslijst verwerkt dient te worden.
Dit proces beschrijft op basis waarvan en op welke wijze een beheerder kan beoordelen en
aangeven hoe een persoonslijst in de BRP verwerkt dient te worden.

3.22.2

Preconditie

•

Bij de verwerking van een aangeboden persoonslijst in de BRP is een onduidelijke situatie
geconstateerd. Hierbij zijn één of meer kandidaat persoonslijsten gevonden.

3.22.3

Postconditie
•
Negeren, de aangeboden persoonslijst wordt niet opgenomen in de BRP
•
Vervangen, één van de kandidaat persoonslijsten dient vervangen te worden met de
aangeboden persoonslijst
•
Toevoegen, de aangeboden persoonslijst dient als nieuw opgenomen te worden in de BRP
•
Afkeuren, de aangeboden persoonslijst dient afgekeurd te worden en niet opgenomen in de
BRP

3.22.4

Structuur
Package
nl.bzk.migratiebrp.isc.jbpm.uc808

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van
actionListeners en handlers voor deze use case
staan.

Pagina 68 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.22.5

Implementatie

3.22.5.1

Registratie gerelateerd a-nummers
Ten behoeve van het automatisch verwerken van taken (zie UC202 en UC811) worden de
gerelateerde a-nummers (elementen 01.01.10 en 51.01.10) van de te verwerken persoonslijst
geregistreerd in de tabel MIG_TAAK_GERELATEERD.

3.22.5.2

Beheerderskeuze
Class
ReportSelectedChoiceActionListener
ReportSelectedChoiceHandler
Dit proces is geïmplementeerd binnen de standaard foutafhandeling van ISC. Er kan door middel
van een parameter worden aangegeven dat een UC808 taak gestart dient te worden, waarin de
te synchroniseren persoonslijst (bericht) vergeleken kan worden met de gevonden
persoonslijsten in de BRP database.

De taak toont naast de te synchroniseren persoonlijst, de persoonslijsten die zijn gevonden in de
BRP database, waardoor niet eenduidig kon worden bepaald hoe de persoonlijst opgeslagen dient
te worden. Indien een categorie verschillen bevat dan wordt de gehele categorie gekleurd
weergegeven. Elk (ten opzichte van de te synchroniseren persoonslijst) afwijkend element wordt
ook aangegeven.

3.22.6

Ontwerpbeslissingen binnen UC808
Voor deze use case zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 69 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.23

UC811 – Verwerken synchronisatievraag-cyclus

3.23.1

Proces
Vanuit de BRP kan een vraag aan een gemeente gesteld worden om de laatste versie van een
persoonslijst op te sturen om zodoende de persoonslijst te synchroniseren. Dit is de start van de
synchronisatievraag (bericht)cyclus. De synchronisatievraag-cyclus is uitvoerig beschreven in het
Logisch Ontwerp [LO].
De cyclus start met het versturen van een synchronisatievraag (Lq01) naar een gemeente. In de
meeste gevallen antwoord de gemeente hierop met een synchronisatieantwoord (La01). Indien
de synchronisatievraag niet te beantwoorden is wordt door de gemeente een fout gestuurd
(Lf01). Verder is het ook mogelijk dat een protocolfout gestuurd wordt (Pf0x).
Dit document beschrijft op welke wijze de synchronisatievraag-cyclus verwerkt wordt.

Operatie BRP

Pagina 70 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Schematisch weergave van de synchronisatievraag-cyclus zoals die in het Logisch Ontwerp is
beschreven.

3.23.2

Preconditie
•
Er is een synchronisatievraag opgesteld met de vereiste gegevens

3.23.3

Postconditie
•
De persoonslijst uit het synchronisatieantwoord is in de BRP vastgelegd, of
•
De persoonslijst uit het synchronisatieantwoord is genegeerd en niet vastgelegd, of
•
De beheerder heeft de cyclus beëindigd

3.23.4

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc811

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Pagina 71 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.23.5

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces gerealiseerd waarin de functionaliteit is geïmplementeerd.

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC811].

Operatie BRP

Pagina 72 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.23.5.1

Controleren: Valideer input parameters
Class

ValideerInputDecision
Controleer of de gemeente een bestaande GBA gemeente is die zich in het GBA stelsel bevind.
Controleer of het a-nummer voldoet aan de daarvoor geldende controles (zie [LO]).
Indien de controles niet slagen, wordt een foutafhandeling proces gestart.

3.23.5.2

Synchronisatievraag
Class

MaakLq01Action
ControleerLa01BerichtDecision
BepaalLf01BeheerderKeuzesAction
MaakVerwijsUc811BerichtAction
Verstuur een Lq01 bericht aan de gegeven gemeente met het gegeven a-nummer.
Uitgaand bericht: Lq01 (Zie [LO])
Kanaal: VOSPG
Verwacht bericht: La01 of Lf01 (Zie [LO])
Indien een Lf01 bericht is ontvangen, wordt bepaald of het bericht verwijsgegevens bevat
(header: status ‘V’ en gemeente gevuld). Zo ja, dan wordt de beheerder de keuze gegeven om
een instantie van het Uc811 proces te starten met als invoer het gegeven a-nummer en de
gemeente uit de verwijsgegevens.
Indien een La01 bericht is ontvangen, wordt gecontroleerd of het actuele a-nummer (categorie
01, element 01.10) gelijk is aan het gevraagde a-nummer. Zo nee, wordt een foutafhandeling
proces gestart.

3.23.5.3

Synchroniseer naar BRP
Class

MaakSynchroniseerNaarBrpVerzoekAction
De persoon wordt gesynchroniseerd naar de BRP database. De te synchroniseren persoonslijst
wordt overgenomen uit het ontvangen La01 bericht. Er wordt aangegeven dat deze persoonslijst
‘gezaghebbend’ is.
Uitgaand bericht: SynchroniseerNaarBrpVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: SynchroniseerNaarBrpAntwoord (Zie [SYNC])
Er wordt gecontroleerd of de persoonslijst opgeslagen is. Indien de gegeven persoonslijst is
‘afgekeurd’ wordt een foutafhandeling proces gestart. Indien de gegevens persoonslijst is
‘genegeerd’ wordt het proces vervolgd bij ‘Unlock’. Indien wordt aangegeven dat de persoonlijst
‘onduidelijk’ wordt een alternatieve foutafhandeling ingegaan. Indien de gegeven persoonslijst
niet kon worden opgeslagen omdat er nog ‘Te leveren administratieve handelingen’ aanwezig zijn
wordt het proces vervolgd bij ‘Wachten’ waarna de synchronisatie opnieuw wordt uitgevoerd.
Bij de situaties ‘afgekeurd’ en ‘onduidelijk’ wordt de beheerder ook de mogelijkheid gegeven om
de synchronisatie vraag nog een keer bij de gemeente uit te voeren. Indien de beheerder voor
deze keuze kiest, wordt de lock op a-nummers, verwijderd.

Operatie BRP

Pagina 73 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.23.5.4

Synchroniseer naar BRP: Afhandelen onduidelijk
Class

ControleerSynchroniseerNaarBrpAntwoordAction
Op basis van de gevonden kandidaat persoonslijsten in het SynchroniseerNaarBrpAntwoord
worden de mogelijke keuzes voor de beheerder bepaald.
Keuze ‘Opnemen als nieuwe persoonslijst’: enkel opnemen indien er geen persoonslijst is
gevonden waarbij het actuele a-nummer gelijk is aan het actuele a-nummer van de
gegeven persoonslijst.
➢ Keuze ‘Vervang persoonslijst met a-nummer <xxx>’: opnemen voor elke gevonden
persoonslijst.
➢ Keuze ‘Negeer persoonslijst’: altijd opnemen
➢ Keuze ‘Persoonslijst afkeuren’: altijd opnemen (resulteert in een Pf03 naar de gemeente)
Er wordt een foutafhandeling proces gestart (zie 2.2.3) van het type UC808 (zie 3.22).
➢

3.23.5.5

Automatisch verwerken
Class

AutomatischVerwerkenGerelateerdeTakenAction
Op basis van het resultaat van Synchroniseer naar BRP (indien de persoonslijst is toegevoegd of
vervangen) worden gerelateerde taken van het UC808 proces automatisch verwerkt. De
gerelateerde taken, zijn taken waarvan de te verwerken persoonslijst minimaal één a-nummer
(element 01.01.10 of 51.01.10) heeft dat overeenkomt met een a-nummer van de zo juist
verwerkte persoonslijst.

3.23.6

Ontwerpbeslissingen binnen UC811
Er zijn voor UC811 geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 74 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.24

UC812 – Verwerken bulk synchronisatievraag-cyclus

3.24.1

Proces
Vanuit de BRP kan een persoonslijst bij een gemeente opgevraagd worden. Dit wordt gedaan
door middel van een synchronisatievraag (Lq01). In het Logisch Ontwerp [LO] is de
synchronisatievraag en de bijbehorende berichtcyclus uitvoerig beschreven.
Soms is het ook wenselijk dat meerdere synchronisatievragen tegelijk gesteld kunnen worden.
Dit proces beschrijft op welke wijze meerdere synchronisatievragen tegelijk gesteld worden.

3.24.2

Preconditie
•
Er is een tekstbestand met een lijst van synchronisatievragen

3.24.3

Postconditie
•
Er zijn één of meer synchronisatievraag-cyclusen gestart [MV-UC811], of
•
De validatie van één of meer synchronisatievragen is mislukt en dit is gemeld aan de
beheerder

3.24.4

Structuur

Package

nl.bzk.migratiebrp.isc.jbpm.uc812

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van
actions en decisions voor deze use case staan.

Pagina 75 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.24.5

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces waarin de functionaliteit is geïmplementeerd.

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC812].

Operatie BRP

Pagina 76 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.24.5.1

Valideren bulk bestand
Class

ValideerBulkBestandAction
Het bulkbestand wordt regel voor regel gecontroleerd op structuur en validiteit van de gegevens.
Indien de structuur van een regel valide is wordt inhoudelijk gecontroleerd dat:
•

de gemeente een gemeente in het GBA stelsel (via het Gemeenteregister) is
EN

•

het a-nummer een valide a-nummer is

Indien een fout wordt geconstateerd wordt een foutafhandeling proces gestart met de
mogelijkheid voor de beheerder om te kiezen voor:
•
•

3.24.5.2

Opnieuw controleren (als het gemeenteregister nog bijgewerkt moest worden)
Beëindigen van het proces

Verwerking
Class

BepaalVoorkomensAction
ControleerGemeentenAction
Het systeem start per regel in het bulkbestand een instantie van het JBPM proces 'uc811' [MVUC811].
Na het beëindigen van een instantie van het JBPM proces 'uc811' wordt gecontroleerd of alle
instanties zijn beëindigd. Indien alle instanties zijn beëindigd vervolgt het proces.
3.24.6

Ontwerpbeslissingen binnen UC812
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 77 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.25

UC813 – Handmatig starten synchronisatievraag-cyclus

3.25.1

Proces
Een beheerder kan bij een gemeente een persoonslijst opvragen. Dit wordt gedaan door middel
van een synchronisatievraag. In het Logisch Ontwerp[LO] is de synchronisatievraag en de
bijbehorende berichtcyclus uitvoerig beschreven.
Dit proces beschrijft op welke wijze een beheerder een of meer synchronisatievragen (tegelijk)
kan stellen.

3.25.2

Preconditie
N.v.t.

3.25.3

Postconditie
•
Er is een synchronisatievraag-cyclus gestart [MV-UC811], of
•
Er is een bulk synchronisatievraag-cyclus gestart [MV-UC812]

3.25.4

Structuur
Package
nl.bzk.migratiebrp.isc.console.mig4js
f

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van
actionListeners en handlers voor deze use case
staan.

Pagina 78 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.25.5

Implementatie

3.25.5.1

Synchronisatievraag
Class

SynchronisatievraagHandler
SynchronisatievraagActionListener
De use case is geïmplementeerd binnen de standaard oplossing van Jboss JBPM [MV-UC801]. De
JBPM Console is uitgebreid met een scherm waarin de beheerder de synchronisatievraag cyclus
kan starten.

Door het invoeren van:
•

een gemeentecode én een a-nummer
OF

•

een bulkbestand

kan de verwerking worden gestart.
Actie 'Uitvoeren':
•
Wanneer een valide gemeentecode en een valide a-nummer en geen bulkbestand zijn
opgegeven wordt een instantie van JBPM proces 'uc811' [MV-UC811] gestart.
•
Wanneer geen gemeentecode en geen a-nummer maar wel een bulkbestand zijn
opgegeven wordt een instantie van JBPM proces 'uc812' [MV-UC812] gestart.
•
In alle andere gevallen wordt een foutmelding getoond.

Operatie BRP

Pagina 79 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.25.6

Ontwerpbeslissingen binnen UC813
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 80 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.26

UC814 – Beheren berichten

3.26.1

Proces
Tijdens het uitvoeren van een proces is het mogelijk dat er berichten verstuurd en ontvangen
worden. Dit kunnen interne berichten binnen het systeem zijn maar ook berichten van/naar
buiten het systeem.
Dit proces beschrijft op welke de beheerder inzicht krijgt in de berichten die
verstuurd/ontvangen zijn door het systeem.

3.26.2

Preconditie
N.v.t.

3.26.3

Postconditie
N.v.t.

3.26.4

Structuur

Package
nl.bzk.migratiebrp.isc.console.mi
g4jsf

Operatie BRP

Omschrijving
Package waarin specifieke implementaties van
actionListeners en handlers voor deze use case staan.

Pagina 81 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.26.5

Implementatie

3.26.5.1

Tonen en filteren berichten
Class

BerichtenFilter
BerichtenFilterActionListener
BerichtenFilterHandler
ListBerichtenActionListener
ListBerichtenForProcessInstanceActionListener
ListBerichtenForProcessInstanceHandler
ListBerichtenHandler
LoadBerichtActionListener
LoadBerichtHandler
PrettyPrintBerichtActionListener
PrettyPrintBerichtHandler
De use case is geïmplementeerd binnen de standaard oplossing van Jboss JBPM [MV-UC801]. De
JBPM Console is uitgebreid met een scherm waarin de beheerder alle berichten kan zien en kan
doorklikken naar de details van een bericht.

3.26.6

Ontwerpbeslissingen binnen UC814
Filteren van tabelkolommen word doorgaans gedaan door de filter toe te passen op de
kolomheader. Echter voor proces-id gaat dit iets anders. Het filteren van processen op ‘id’ kan
gedaan worden door de waarde van het parameterveld ‘id’ in de url aan te passen naar de
desbetreffende id. Men moet zich dan wel al bevinden op de pagina van een procesinstantie.

Operatie BRP

Pagina 82 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.27

UC815 – Beheren taken

3.27.1

Proces
Het kan voorkomen dat in een proces een onduidelijke situatie is ontstaan waardoor het systeem
niet zelfstandig kan bepalen wat de volgende stap in het proces zou moeten zijn. Een dergelijk
geval dient onder de aandacht van de beheerder gebracht te worden zodat die kan bepalen wat
de volgende stap in het proces zou moeten zijn. He systeem brengt dit onder de aandacht door
een taak voor de beheerder aan te maken.
Taken zijn onderdeel van de standaard oplossing die gebruikt wordt bij de implementatie van
processen en berichten (jBPM).
Dit proces beschrijft op welke wijze de beheerder inzicht krijgt in de taken die het systeem heeft
aangemaakt.

3.27.2

Preconditie
N.v.t.

3.27.3

Postconditie
N.v.t.

3.27.4

Structuur
Package
nl.bzk.migratiebrp.isc.console.mi
g4jsf

3.27.5

Implementatie

3.27.5.1

Tonen en filteren taken

Omschrijving
Package waarin specifieke implementaties van
actionListeners en handlers voor deze use case staan.

Class

ListTasksActionListener
ListTasksForActorActionListener

Operatie BRP

Pagina 83 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

ListTasksForActorHandler
ListTasksHandler
UnassignTaskActionListener
UnassignTaskHandler
De use case is geïmplementeerd binnen de standaard oplossing van Jboss JBPM [MV-UC801]. De
JBPM Console is uitgebreid met een scherm waarin de beheerder alle taken kan zien en kan
doorklikken naar een taak (zie 2.2.3.3). Bovendien heeft de beheerder de mogelijkheid om taken
toe te wijzen aan andere gebruikers of de toewijzing ongedaan te maken, taken te starten of te
stoppen.

3.27.6

Ontwerpbeslissingen binnen UC815
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 84 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.28

UC1003 – Plaatsen afnemersindicatie

3.28.1

Proces
Tijdens de migratieperiode zullen leveringen worden verzorgd vanuit het BRP systeem. Echter
een afnemer uit het LO3 stelsel zal nog steeds afnemersindicaties kunnen plaatsen via de LO3
cyclus.

Operatie BRP

Pagina 85 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.28.2

Preconditie
•

3.28.3

Postconditie
•
•

3.28.4

Er is een ‘plaatsen afnemersindicatie’-bericht (Ap01) ontvangen

De opdracht tot plaatsen is succesvol in de BRP verwerkt, of
Bij een foutsituatie is een foutbericht (Af01) verstuurd aan de afnemer

Structuur

Package
nl.bzk.migratiebrp.isc.jbpm.uc1003

3.28.5

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces gerealiseerd waarin de functionaliteit is geïmplementeerd.

Operatie BRP

Pagina 86 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC1003].

3.28.5.1

Controleren: controleer afnemer
Class

ControleerAfnemerAction
De volgende controles worden uitgevoerd:
➢
➢
➢

De partij waarvan het bericht is ontvangen moet een bekende afnemer zijn.
De partij waaraan het bericht is verstuurd moet de centrale voorziening zijn.
De afnemer moet een geldige (toegang- en) leveringsautorisatie hebben met (een
dienstbundel met) de dienst ‘Plaatsen Afnemerindicaties’.

Indien de controles niet slagen, wordt een Af01 bericht met foutcode ‘X’ verstuurd aan de
afnemer en wordt foutafhandeling proces gestart (Zie 2.2.3).

3.28.5.2

Zoek persoon
Class

MaakZoekPersoonBerichtAction
ControleerPersoonAction
Op basis van de in het Ap01 bericht opgegeven identificerende gegevens wordt de ZoekPersoon
service aangeroepen. Indien er exact één persoon wordt gevonden vervolgt het proces. Indien
geen persoon wordt gevonden, wordt een Af01 bericht met foutcode ‘G’ verstuurd aan de
afnemer. Indien meerdere personen worden gevonden, wordt een Af01 bericht met foutcode ‘U’
verstuurd aan de afnemer.
Uitgaand bericht: ZoekPersoonVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: ZoekPersoonAntwoord (Zie [SYNC])

3.28.5.3

Blokkeringinfo

Operatie BRP

Pagina 87 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Class

MaakBlokkeringInfoAction
ControleerBlokkeringInfoAntwoordAction
De blokkeringssituatie wordt opgevraagd. Het a-nummer in het verzoek is het actuele a-nummer
van de gevonden persoon.
Uitgaand bericht: BlokkeringInfoVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: BlokkeringInfoAntwoord (Zie [SYNC])
Indien er een blokkering aanwezig is, dan wordt een Af01 bericht met foutcode ‘B’ verstuurd aan
de afnemer.
3.28.5.4

Plaatsen afnemersindicatie
Class

MaakPlaatsenAfnemersindicatieBerichtAction
ControleerPlaatsenAfnemersindicatieAction
De afnemersindicatie wordt geplaatst door de BRP Synchronisatie Service aan te roepen. Als
referentienummer wordt het message-id van het Ap01 bericht meegegeven.
Uitgaand bericht: PlaatsAfnemersindicatieVerzoekBericht (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: VerwerkAfnemersindicatieAntwoordBericht (Zie [SYNC])
Er wordt gecontroleerd of de afnemersindicatie geplaatst. Indien de status ‘Ok’, is wordt het
proces afgerond. Indien de status ‘Fout’ is, wordt een ‘Af01’ bericht naar de afnemer gestuurd
met daarin de gegeven foutcode (‘G’, ‘H’, ‘I’, ‘R’ of ‘X’).
3.28.6

Ontwerpbeslissingen binnen UC1003 (Plaatsen)
De LO3 cyclus eindigt met een Ag01 bericht. Dit bericht wordt echter asynchroon binnen BRP
door een compleet ander proces gemaakt. Het proces eindigt na het succesvol plaatsen van de
afnemersindicatie. Echter wanneer een leveringsbericht wordt ontvangen met een referentie, dan
wordt het gekoppeld aan het proces waaraan het daarmee te vinden Ap01 bericht is gekoppeld.

Operatie BRP

Pagina 88 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.29

UC1003 – Verwijderen afnemersindicatie

3.29.1

Proces
Tijdens de migratieperiode zullen leveringen worden verzorgt vanuit het BRP systeem. Echter
een afnemer uit het LO3 stelsel zal nog steeds afnemersindicaties kunnen verwijderen via de LO3
cyclus.

3.29.2

Preconditie
•

3.29.3

Er is een ‘verwijderen afnemersindicatie’-bericht (Av01) ontvangen

Postconditie
•
•

De opdracht tot verwijderen is succesvol in de BRP verwerkt, of
Bij een foutsituatie is een foutbericht (Af11) verstuurd aan de afnemer

Operatie BRP

Pagina 89 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.29.4

Structuur
Package
nl.bzk.migratiebrp.isc.jbpm.uc1003

3.29.5

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces gerealiseerd waarin de functionaliteit is geïmplementeerd.

Operatie BRP

Pagina 90 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC1003].

3.29.5.1

Controleren: controleer afnemer
Class

ControleerAfnemerAction
De volgende controles worden uitgevoerd:
➢
➢
➢

De partij waarvan het bericht is ontvangen moet een bekende afnemer zijn.
De partij waaraan het bericht is verstuurd moet de centrale voorziening zijn.
De afnemer moet een geldige (toegang- en) leveringsautorisatie hebben met (een
dienstbundel met) de dienst ‘Plaatsen Afnemerindicaties’.

Indien de controles niet slagen, een Af11 bericht met foutcode ‘X’ verstuurd aan de afnemer en
wordt foutafhandeling proces gestart (Zie 2.2.3).

3.29.5.2

Zoek persoon
Class

MaakZoekPersoonBerichtAction
ControleerPersoonAction
Op basis van de in het Av01 bericht opgegeven a-nummer wordt de ZoekPersoon service
aangeroepen. Indien er exact één persoon wordt gevonden vervolgt het proces. Indien geen
persoon wordt gevonden, wordt een Af11 bericht met foutcode ‘G’ verstuurd aan de afnemer.
Indien meerdere personen worden gevonden, wordt een Af11 bericht met foutcode ‘U’ verstuurd
aan de afnemer.
Uitgaand bericht: ZoekPersoonVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: ZoekPersoonAntwoord (Zie [SYNC])

3.29.5.3

Blokkeringinfo
Class

MaakBlokkeringInfoAction
ControleerBlokkeringInfoAntwoordAction
De blokkeringssituatie wordt opgevraagd. Het a-nummer in het verzoek is het actuele a-nummer
van de gevonden persoon.
Uitgaand bericht: BlokkeringInfoVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: BlokkeringInfoAntwoord (Zie [SYNC])
Indien er een blokkering aanwezig is, dan wordt een Af11 bericht met foutcode ‘B’ verstuurd aan
de afnemer.
3.29.5.4

Verwijderen afnemersindicatie
Class

MaakVerwijderenAfnemersindicatieBerichtAction

Operatie BRP

Pagina 91 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

ControleerVerwijderenAfnemersindicatieAction
De afnemersindicatie wordt verwijderd door de BRP Synchronisatie Service aan te roepen.
Uitgaand bericht: VerwijderAfnemersindicatieVerzoekBericht (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: VerwerkAfnemersindicatieAntwoordBericht (Zie [SYNC])
Er wordt gecontroleerd of de afnemersindicatie succesvol is verwijderd. Indien de status ‘Ok’, is
wordt het proces afgerond. Indien de status ‘Fout’ is, wordt een ‘Af11’ bericht naar de afnemer
gestuurd met daarin de gegeven foutcode (‘G’, ‘H’, ‘I’, of ‘X’).
3.29.5.5

Null bericht
Class

MaakNullBerichtAction
Aan het einde van het proces wordt een Null-bericht verstuurd naar de LO3-afnemer als
bevestiging dat de afnemersindicatie is verwijderd.
Uitgaand bericht: NullBericht
Kanaal: VOSPG
Verwacht bericht: Geen
3.29.6

Ontwerpbeslissingen binnen UC1003 (Verwijderen)
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 92 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.30

UC1004 – Ad hoc Persoonsvraag

3.30.1

Proces
Tijdens de migratieperiode zullen ad hoc persoonsvragen nog vanuit het LO3 stelsel worden
gesteld door afnemers. Dit proces voorziet in het verstrekken van de middels ad hoc
persoonsvragen gestelde rubrieken op basis van de identificerende rubrieken en de autorisatie
van de vragende partij.

3.30.2

Preconditie
•

Er is een ‘ad hoc persoonsvraag’-bericht (Hq01) ontvangen

Operatie BRP

Pagina 93 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.30.3

Postconditie
•
•

3.30.4

De opdracht heeft geleid tot het verstrekken van de gevraagde rubrieken (Ha01), of
Bij een foutsituatie is een foutbericht (Hf01) verstuurd aan de afnemer

Structuur
Package
nl.bzk.migratiebrp.isc.jbpm.uc1004

3.30.5

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces gerealiseerd waarin de functionaliteit is geïmplementeerd.

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC1004].

Operatie BRP

Pagina 94 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.30.5.1

Controleren: controleer Ad hoc persoonvraag (Hq01)
Class

ControleerHq01BerichtAction
MaakZoekPersoonBerichtAction
De volgende controles worden uitgevoerd:
➢
➢

De partij waarvan het bericht is ontvangen moet een bekende afnemer zijn.
De partij waaraan het bericht is verstuurd moet de centrale voorziening zijn.

Uitgaand bericht: AdhocZoekPersoonVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: AdhocZoekPersoonAntwoord (Zie [SYNC])

3.30.5.2

Controleren: controleer antwoord
Class

ControleerAntwoordInhoudelijkAction
MaakHa01BerichtAction
MaakHf01BerichtAction
Het antwoord bericht uit de synchronisatiecomponenten wordt gecontroleerd op foutreden.
Indien de foutreden is gevuld, moet er een Hf01 verstuurd worden met de betreffende foutreden.
Daartoe wordt er een foutafhandeling proces gestart (Zie 2.2.3).
Aan het einde van het proces wordt een Ha01-bericht verstuurd naar de LO3-afnemer met daarin
de gevraagde rubrieken indien er geen fout is opgetreden. Wanneer er een fout is opgeteden,
wordt een Hf01 verstuurd.
Uitgaand bericht: Ha01Bericht of Hf01Bericht
Kanaal: VOSPG
Verwacht bericht: Geen
3.30.6

Ontwerpbeslissingen binnen UC1004 (Ad hoc persoonsvraag)
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 95 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.31

UC1004 – Ad hoc adresvraag

3.31.1

Proces
Tijdens de migratieperiode zullen ad hoc adresvragen nog vanuit het LO3 stelsel worden gesteld
door afnemers en/of gemeenten. Dit proces voorziet in het verstrekken van de middels ad hoc
adresvragen gestelde rubrieken op basis van de identificerende rubrieken en de autorisatie van
de vragende partij.

Operatie BRP

Pagina 96 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.31.2

Preconditie
•

3.31.3

Postconditie
•
•

3.31.4

Er is een ‘ad hoc persoonsvraag’-bericht (Xq01) ontvangen

De opdracht heeft geleid tot het verstrekken van de gevraagde rubrieken (Xa01), of
Bij een foutsituatie is een foutbericht (Xf01) verstuurd aan de afnemer/gemeente

Structuur
Package
nl.bzk.migratiebrp.isc.jbpm.uc1004

3.31.5

Omschrijving
Package waarin specifieke implementaties van actions
en decisions voor deze use case staan.

Implementatie
Dit proces is geïmplementeerd binnen de standaard oplossing van Jboss JBPM. Er is een JBPM
proces gerealiseerd waarin de functionaliteit is geïmplementeerd.

De basis realisatie van een proces is beschreven in 2.2.2. Deze realisation beschrijft de
specifieke stappen die zijn geïmplementeerd voor [MV-UC1004].

Operatie BRP

Pagina 97 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

3.31.5.1

Controleren: controleer Ad hoc persoonvraag (Xq01)
Class

ControleerXq01BerichtAction
MaakZoekPersoonAdresBerichtAction
De volgende controles worden uitgevoerd:
➢
➢

De partij waarvan het bericht is ontvangen moet een bekende afnemer zijn.
De partij waaraan het bericht is verstuurd moet de centrale voorziening zijn.

Uitgaand bericht: AdhocZoekPersonOpAdresVerzoek (Zie [SYNC])
Kanaal: Sync
Verwacht bericht: AdhocZoekPersonenOpAdresAntwoord (Zie [SYNC])

3.31.5.2

Controleren: controleer antwoord
Class

ControleerAntwoordAdresInhoudelijkAction
MaakXa01BerichtAction
MaakXf01BerichtAction
Het antwoord bericht uit de synchronisatiecomponenten wordt gecontroleerd op foutreden.
Indien de foutreden is gevuld, moet er een Xf01 verstuurd worden met de betreffende foutreden.
Daartoe wordt er een foutafhandeling proces gestart (Zie 2.2.3).
Aan het einde van het proces wordt een Xa01-bericht verstuurd naar de LO3-afnemer met daarin
de gevraagde rubrieken indien er geen fout is opgetreden. Wanneer er een fout is opgeteden,
wordt een Xf01 verstuurd.
Uitgaand bericht: Xa01Bericht of Xf01Bericht
Kanaal: VOSPG
Verwacht bericht: Geen
3.31.6

Ontwerpbeslissingen binnen UC1004 (Ad hoc adresvraag)
Binnen dit proces zijn geen aanvullende ontwerpbeslissingen.

Operatie BRP

Pagina 98 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

4

Datamodel migratie

Voor ISC maken we gebruik van de database ‘soa’. Deze database bevat twee soorten tabellen:

➢ Tabellen voor Jbpm; dit zijn onderliggende tabellen die door Jbpm worden gebruikt, maar
niet rechtstreeks door ISC (wel indirect omdat ISC Jbpm gebruikt)
➢ Tabellen voor ISC; dit zijn tabellen die rechtstreeks door ISC worden benaderd en gebruikt
4.1

Jbpm tabellen
Aangezien het hier standaard Jbpm tabellen betreft zullen we deze hier niet beschrijven; meer
informatie hieromtrent kan worden gevonden in de documentatie van Jbpm [JBPM].

4.2

ISC tabellen
De ISC database bevat de onderstaande tabellen.

Operatie BRP

Pagina 99 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

5

Opmerkingen

N.v.t.

Operatie BRP

Pagina 100 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

6

Bijlage A: JMX interface

Ten behoeve van externe toegang is een JMX interface beschikbaar waarmee enkele handelingen
uitgevoerd kunnen worden.
De standaard JMX voorziening van Java wordt gebruikt om de JMX interface beschikbaar te
stellen. Om hier mee te kunnen verbinden worden bij het opstarten van de applicatie de
volgende systeem instellingen (properties) gebruikt.
Instelling

Waarde

Omschrijving

com.sun.management.jmxremote

Indicatie om aan te geven dat de
JMX interface wordt gebruikt
com.sun.management.jmxremote.port
1099
Poort voor JMX
com.sun.management.jmxremote.rmi.port
1099
Poort voor RMI
com.sun.management.jmxremote.ssl
false
Indicatie om aan te geven dat geen
SSL wordt gebruikt
com.sun.management.jmxremote.authenticate false
Indicatie om aan te geven dat geen
authenticatie wordt gebruikt
com.sun.management.jmxremote.local.only
false
Indicatie om aan te geven dat niet
enkel lokaal verbonden mag worden
Nota: de poort instellingen kunnen veranderd worden indien deze poorten reeds gebruikt worden
door een andere applicatie.

6.1

Isc

nl.bzk.migratiebrp.isc:name=RUNTIME
Operatie

Parameters

Omschrijving

afsluiten
isLeveringGestart

-

startLevering
stopLevering
getAantalLeveringVerwerkers

-

setAantalLeveringVerwerkers

aantal (int)

isVoiscGestart
startVoisc
stopVoisc
getAantalVoiscVerwerkers

-

setAantalVoiscVerwerkers

aantal (int)

isSyncGestart
startSync
stopSync
getAantalSyncVerwerkers

-

setAantalSyncVerwerkers

aantal (int)

isJbpmGestart

-

Applicatie afsluiten.
Geeft aan of leveringsberichten worden
ontvangen
Start met het ontvangen van leveringsberichten
Stop met het ontvangen van leveringsberichten
Geef het maximum aantal verwerkers voor
leveringsberichten
Zet het maximum aantal verwerkers voor
leveringsberichten
Geeft aan of VOISC berichten worden ontvangen
Start met het ontvangen van VOISC berichten
Stop met het ontvangen van VOISC berichten
Geef het maximum aantal verwerkers voor
VOISC berichten
Zet het maximum aantal verwerkers voor VOISC
berichten
Geeft aan of SYNC berichten worden ontvangen
Start met het ontvangen van SYNC berichten
Stop met het ontvangen van SYNC berichten
Geef het maximum aantal verwerkers voor SYNC
berichten
Zet het maximum aantal verwerkers voor SYNC
berichten
Geeft aan of geplande JBPM taken worden

Operatie BRP

Pagina 101 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

startJbpm
stopJbpm

-

uitgevoerd
Start het uitvoeren van geplande JBPM taken
Stop het uitvoeren van geplande JBPM taken

Class
Jmx
JmxImpl

6.2

Opschonen
nl.bzk.migratiebrp.isc:name=OPSCHONER
Operatie

Parameters

Omschrijving

opschonen

-

Opschoon actie uitvoeren

Class
OpschonerJmx
OpschonerJmxImpl

6.3

Tellingen
nl.bzk.migratiebrp.isc:name=TELLING
Operatie

Parameters

Omschrijving

bijwerkenTellingen

-

Telling actie uitvoeren

Class
TellingenJmx
TellingenJmxImpl

6.4

Register
Aangezien het ISC gebruik maakt van de algemene bibliotheek voor het gebruik van registers,
zijn de JMX interfaces hiervoor ook beschikbaar.
nl.bzk.migratiebrp.isc:name=AUTORISATIE
Operatie

Parameters

Omschrijving

refreshRegister
clearRegister

-

isGestart

-

start
stop

-

Register opnieuw opvragen
Cache legen (zodat bij het volgende gebruik het
register opnieuw wordt opgevraagd)
Geeft aan of register berichten worden
ontvangen
Start met het ontvangen van register berichten
Stop met het ontvangen van register berichten

nl.bzk.migratiebrp.isc:name=GEMEENTE
Operatie

Parameters

Omschrijving

refreshRegister

-

Register opnieuw opvragen

Operatie BRP

Pagina 102 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

clearRegister

-

isGestart

-

start
stop

-

Operatie BRP

Cache legen (zodat bij het volgende gebruik het
register opnieuw wordt opgevraagd)
Geeft aan of register berichten worden
ontvangen
Start met het ontvangen van register berichten
Stop met het ontvangen van register berichten

Pagina 103 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

7

Bijlage B: Configuratie

De volgende instellingen zijn beschikbaar in het configuratie bestand ‘isc-runtime.properties’:
Instelling

Standaard waarde

Omschrijving

routering.activemq.url

tcp://localhost:61616

URL om verbinding te maken met de
Routering module.

jbpm.hibernate.dialect

org.hibernate.dialect
.PostgreSQLDialect

Hibernate database dialect

jbpm.scheduler.autostart

true

Start de scheduler voor JBPM

jbpm.scheduler.instanceid

AUTO

Scheduler instanceid

jbpm.scheduler.idlewaittime

15000

Aantal milliseconden waarna Quartz
minimaal controleert voor opdrachten

jbpm.scheduler.driver

org.quartz.impl.jdbcj
obstore.StdJDBCDelega
te

Quartz database driver

jbpm.scheduler.threads

10

Aantal verwerkende threads voor
Quartz

isc.database.nonxa.driver

org.postgresql.Driver

Non XA driver voor ISC database

isc.database.nonxa.url

jdbc:postgresql://loc
alhost/isc

Non XA connectie voor ISC database

isc.database.nonxa.minpool

3

Non XA minimum pool

isc.database.nonxa.maxpool

20

Non XA maximum pool

isc.database.driver

org.postgresql.xa.PGX
ADataSource

XA driver voor ISC database

isc.database.host

localhost

XA host voor ISC database

isc.database.port

5432

XA port voor ISC database

isc.database.name

isc

XA name voor ISC database

isc.database.username

postgres

Username (Non XA en XA) voor ISC
database

isc.database.password

postgres

Wachtwoord (Non XA en XA) voor ISC
database

isc.database.minpool

3

XA minimum pool

isc.database.maxpool

20

XA maximum pool

isc.queue.sync.antwoord

sync.antwoord

Naam voor de sync.verzoek queue

isc.queue.sync.verzoek

sync.verzoek

Naam voor de sync.antwoord queue

isc.queue.voisc.ontvangst

voisc.ontvangst

Naam voor de voisc.ontvangst queue

isc.queue.voisc.verzenden

voisc.verzenden

Naam voor de voisc.verzenden queue

isc.queue.levering

levering

Naam voor de levering queue

isc.topic.gemeente

gemeente.register

Naam voor het gemeenteregister topic

isc.queue.gemeente

gemeente.verzoek

Naam voor de gemeenteregister

Operatie BRP

Pagina 104 van 105

Definitief | 2.8 | Technisch ontwerp ISC | 16-03-2017

Instelling

Standaard waarde

Omschrijving
verzoek queue

isc.topic.autorisatie

autorisatie.register

Naam voor het autorisatieregister
topic

isc.queue.autorisatie

autorisatie.verzoek

Naam voor de autorisatieregister
verzoek queue

atomikos.max.timeout

300

Maximale transactie timeout (in
seconden)

atomikos.default.timeout

10

Standaard transactie timeout (in
seconden)

atomikos.max.actives

50

Maximaal aantal transacties

atomikos.unique.name

isc-runtime

Unieke naam voor deze instantie

atomikos.base.dir

target/atomikos

Werk map voor Atomikos

isc.levering.autostart

true

Automatisch starten van het
ontvangen van leveringsberichten

isc.levering.minconsumers

1

Minimum aantal verwerkende threads

isc.levering.maxconsumers

30

Maximum aantal verwerkende threads

isc.sync.autostart

true

Automatisch starten van het
ontvangen van synchronisatie
antwoorden

isc.sync.minconsumers

1

Minimum aantal verwerkende threads

isc.sync.maxconsumers

10

Maximum aantal verwerkende threads

isc.voisc.autostart

true

Automatisch starten van het
ontvangen van VOISC berichten

isc.voisc.minconsumers

1

Minimum aantal verwerkende threads

isc.voisc.maxconsumers

10

Maximum aantal verwerkende threads

registerclient.afnemer.autostart

true

Automatisch starten van het
ontvangen van het afnemer register

registerclient.gemeente.autostart

true

Automatisch starten van het
ontvangen van het gemeente register

Operatie BRP

Pagina 105 van 105

